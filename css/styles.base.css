:root{
  /* Pro theme: black base + accents */
  --obsidian: #07080B;
  --cobalt: #121724;
  --amethyst: #8B5CF6;
  --ether: #22D3EE;
  --steel: #E8ECF4;

  --bg0: var(--obsidian);
  --panel: rgba(13,16,22,0.92);
  --panel2: rgba(18,23,36,0.86);

  --border: rgba(27,35,51,0.92);
  --borderSoft: rgba(27,35,51,0.70);

  --accent: rgba(34,211,238,1);
  --accentSoft: rgba(34,211,238,0.22);

  --gold: rgba(251,191,36,1);
  --goldSoft: rgba(251,191,36,0.14);

  --danger: rgba(248,113,113,1);
  --dangerBorder: rgba(248,113,113,0.30);
  --dangerBg: rgba(248,113,113,0.10);

  --stroke: var(--border);
  --stroke2: rgba(34,211,238,0.38);

  --text: rgba(232,236,244,0.96);
  --muted: rgba(154,166,191,0.84);

  --radius: 22px;
  --radius2: 16px;

  --shadow: 0 18px 60px rgba(0,0,0,0.66);
  --glow: 0 0 0 1px rgba(0,0,0,0.38) inset;

  --maxw: 1480px;
  --gap: 16px;

  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  color: var(--text);
  background: var(--bg0);
  overflow:hidden;
}

.app{
  height:100%;
  display:flex;
  flex-direction:column;
  padding: calc(10px + var(--safe-top)) calc(10px + var(--safe-right)) calc(10px + var(--safe-bottom)) calc(10px + var(--safe-left));
}

/* Topbar */
.topbar{
  position: relative;
  z-index: 20000;
  overflow: visible;

  min-height: 74px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 14px;
  padding: 10px 14px;
  border-radius: var(--radius);
  background: var(--panel);
  box-shadow: var(--shadow);
  border: 1px solid var(--borderSoft);
  backdrop-filter: none;
}
.topbar__left{ display:flex; align-items:center; gap: 12px; min-width: 320px; }
.topbar__right{ display:flex; align-items:center; gap: 10px; flex-wrap:wrap; justify-content:flex-end; }
.notifBtn{
  position:relative;
  height: 42px;
  min-width: 42px;
  padding: 0 12px;
  border-radius: 16px;
  border: 1px solid var(--borderSoft);
  background: rgba(0,0,0,0.20);
  color: rgba(220,220,230,0.96);
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  box-shadow: 0 10px 26px rgba(0,0,0,0.45);
}
.notifBtn:hover{ border-color: rgba(34,211,238,0.35); background: rgba(0,0,0,0.32); }

/* Compact variant (used inside ficha week card) */
.notifBtn--compact{
  height: 34px;
  padding: 0 12px;
  border-radius: 14px;
  font-size: 13px;
}

/* Title row with inline action on the right */
.subCard__titleRow{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}
.notifBadge{
  position:absolute;
  z-index:1;
  top: -6px;
  right: -6px;
  padding: 2px 6px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 900;
  letter-spacing: .2px;
  background: rgba(114,26,255,0.95);
  border: 1px solid rgba(0,210,255,0.30);
  color: rgba(220,220,230,0.98);
  box-shadow: 0 10px 26px rgba(0,0,0,0.45);
}
.topbar__menu{ display:none; }
/* Mobile-only: botón de trofeo para ir a Recompensas */
.topbar__trophyBtn{ display:none; }
.trophyIcon{ width:22px; height:22px; }
/* show hamburger only on small screens */
@media (min-width: 901px){ .topbar__menu{ display:none !important; } }
@media (max-width: 900px){ .topbar__menu{ display:flex !important; } }


/* Mobile: compact overflow menu for header actions */
.topbar__moreWrap{display:none;}
.topbar__moreBtn{
  display:none;
  width:42px; height:42px; border-radius:12px;
  align-items:center; justify-content:center;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(0,210,255,.18);
  color:#eae7df;
}
.topMoreMenu{
  position:absolute;
  top: calc(100% + 10px);
  left: 0;
  min-width: 220px;

  z-index: 20060;
  background: rgba(10,12,18,0.92);
  border: 1px solid rgba(0,210,255,0.26);
  border-radius: 16px;
  box-shadow: 0 18px 60px rgba(0,0,0,0.65);
  padding: 8px;
  backdrop-filter: blur(12px);
}
.topMoreMenu__item{
  width: 100%;
  display:flex;
  align-items:center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 12px;
  background: transparent;
  border: 1px solid transparent;
  color: var(--text);
  text-align:left;
  cursor:pointer;
  font-size: 14px;
}
.topMoreMenu__item:hover{
  background: rgba(255,255,255,0.05);
  border-color: rgba(0,210,255,0.12);
}
.topMoreMenu__item:active{ transform: translateY(1px); }
.topMoreMenu__item .emoji{ width: 18px; display:inline-block; opacity: .70; }

.brand{ display:flex; align-items:center; gap: 12px; }
.brand__logo{
  width: 44px; height: 44px;
  display:grid; place-items:center;
  border-radius: 14px;
  background: rgba(0,0,0,0.25);
  border: 1px solid var(--borderSoft);
  box-shadow: var(--glow);
}
.brand__title{ font-size: 12px; letter-spacing: 2.6px; opacity:.85; text-transform:uppercase; }
.brand__subtitle{ font-size: 12px; opacity:.55; margin-top: 3px; }

/* Pills */
.pill{
  border: 1px solid var(--borderSoft);
  background: rgba(255,255,255,0.03);
  color: var(--text);
  border-radius: 999px;
  padding: 10px 14px;
  font-size: 13px;
  cursor:pointer;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.35) inset;
  transition: transform .08s ease, background .15s ease, border-color .15s ease;
}
.pill:hover{ background: rgba(255,255,255,0.05); border-color: rgba(34,211,238,0.30); }
.pill:active{ transform: translateY(1px); }
.pill.is-active{ background: rgba(34,211,238,0.12); border-color: rgba(34,211,238,0.45); }
.pill--ghost{ border-color: rgba(255,255,255,0.14); }
.pill--danger{ color: var(--danger); border-color: var(--dangerBorder); background: var(--dangerBg); }
.pill--small{ padding: 8px 12px; font-size: 12px; }
.pill--icon{
  padding: 0;
  width: 34px;
  height: 34px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  border-radius: 12px;
}

.iconbtn{
  border: 1px solid var(--borderSoft);
  background: rgba(255,255,255,0.04);
  border-radius: 12px;
  width: 42px; height: 42px;
  color: var(--text);
  cursor:pointer;
}

/* Top nav */
.topnav{ display:flex; gap: 8px; align-items:center; justify-content:center; flex: 1; }

/* Dropdown */
.dropdown{ position:relative; z-index: 20040; }
.dropdown__menu{
  position:absolute;
  right:0;
  top: calc(100% + 10px);
  min-width: 240px;
  padding: 10px;
  border-radius: 14px;

  /* Opaque panel so it doesn't look "transparent" */
  background: rgba(10,12,18,0.92);
  border: 1px solid rgba(0,210,255,0.28);
  box-shadow: 0 18px 60px rgba(0,0,0,0.65);

  display:none;
  z-index: 20050;
}
.dropdown.is-open .dropdown__menu{ display:block; }
.dropdown__menu.is-portal{ right:auto !important; }
.challengeHintBadges{ display:flex; flex-wrap:wrap; gap:8px; margin-top:6px; }
.menuitem{
  width:100%;
  text-align:left;
  border:none;
  background: transparent;
  color: var(--text);
  padding: 10px 10px;
  border-radius: 10px;
  cursor:pointer;
}
.menuitem:hover{ background: rgba(255,255,255,0.06); }
.menudivider{ height:1px; background: rgba(255,255,255,0.10); margin: 8px 0; }

/* Shell layout */
.shell{
  position:relative;
  flex:1;
  display:grid;
  gap: var(--gap);
  padding-top: var(--gap);
  overflow:hidden;
  grid-template-columns: 320px minmax(0, 1fr);
  grid-template-areas: "sidebar content";
  max-width: var(--maxw);
  width:100%;
  margin: 0 auto;
  min-height: 0;
}

.sidebar, .content, .details{
  border-radius: var(--radius);
  background: var(--panel);
  border: 1px solid var(--borderSoft);
  box-shadow: var(--shadow);
  overflow:hidden;
  min-height: 0;
  display:flex;
  flex-direction:column;
}
.sidebar{ padding: 14px; grid-area: sidebar; }
.details{ padding: 14px; grid-area: details; }
.content{ padding: 14px; overflow:hidden; grid-area: content; }

.details{ display:none; }
.shell.is-details-open{
  grid-template-columns: 320px minmax(0, 1fr) 360px;
  grid-template-areas: "sidebar content details";
}
.shell.is-details-open .details{ display:flex; }

.pages{ overflow:auto; overflow-x:hidden; padding-right: 6px; scrollbar-gutter: stable; }
/* Sidebar bits */
.panelHeader{ display:flex; align-items:center; justify-content:space-between; padding: 2px 0 10px 0; }
.panelHeader__title{ letter-spacing: 2px; font-size: 13px; opacity: .85; }

/* Sidebar compact header: switches + "Nuevo" in one row */
.panelHeader--compact{ gap:10px; padding: 2px 0 12px 0; }
.panelHeader--compact .segmented{ margin-bottom: 0; }
.segmented--compact{ min-width: 0; }
.segmented--compact .segmented__btn{ padding: 10px 14px; font-size: 13px; }

.segmented{
  display:flex; gap: 6px; padding: 8px; border-radius: 999px;
  background: rgba(0,0,0,0.20);
  border: 1px solid rgba(0,210,255,0.10);
  margin-bottom: 10px;
}
.segmented__btn{
  flex:1; border:none; padding: 7px 8px; border-radius: 999px;
  display:flex; align-items:center; justify-content:center; line-height:1;
  background: transparent; color: rgba(255,255,255,0.55); cursor:pointer;
  font-size: 12px;
}
.segmented__btn.is-active{
  background: rgba(0,210,255,0.10);
  color: var(--text);
  border: 1px solid rgba(0,210,255,0.20);
}
.list{ overflow:auto; padding-right: 6px; }
.heroCard{
  width:100%;
  text-align:left;
  border-radius: 18px;
  padding: 12px 12px 10px;
  margin-bottom: 10px;
  border: 1px solid rgba(0,210,255,0.18);
  background:
    radial-gradient(120px 80px at 10% -20%, rgba(0,210,255,0.10), transparent 70%),
    rgba(255,255,255,0.035);
  cursor:pointer;
  display:flex;
  flex-direction:column;
  gap: 8px;
  transition: border-color .15s ease, background .2s ease, transform .08s ease;
}
.heroCard:hover{ border-color: rgba(0,210,255,0.28); }
.heroCard:active{ transform: translateY(1px); }
.heroCard.is-active{
  border-color: rgba(0,210,255,0.42);
  background:
    radial-gradient(160px 90px at 5% -30%, rgba(0,210,255,0.18), transparent 72%),
    rgba(0,210,255,0.08);
  box-shadow: 0 0 0 1px rgba(0,210,255,0.12) inset, var(--glow);
}
.heroCard__row{ display:flex; align-items:center; gap: 10px; }
.heroCard__thumb{
  width: 40px; height: 40px; min-width: 40px;
  border-radius: 50%;
  background-size: cover; background-position: center top;
  border: 2px solid rgba(0,210,255,0.25);
  box-shadow: 0 0 8px rgba(0,210,255,0.10);
}
.heroCard.is-active .heroCard__thumb{
  border-color: rgba(0,210,255,0.50);
  box-shadow: 0 0 12px rgba(0,210,255,0.20);
}
.heroCard__thumbEmpty{
  width: 40px; height: 40px; min-width: 40px;
  border-radius: 50%;
  background: rgba(255,255,255,0.06);
  border: 2px solid rgba(0,210,255,0.12);
}
.heroCard__info{ flex:1; min-width:0; }
.heroCard__name{ font-size: 14px; font-weight: 700; }
.heroCard__meta{ font-size: 12px; opacity:.72; margin-top:3px; }
.heroCard__badge{
  font-size: 11px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(0,210,255,0.28);
  background: rgba(0,0,0,0.35);
  color: rgba(255,235,190,0.95);
  white-space:nowrap;
}
.heroCard__progress{
  height: 8px;
  border-radius: 999px;
  border: 1px solid rgba(0,210,255,0.12);
  background: rgba(255,255,255,0.06);
  overflow:hidden;
}
.heroCard__fill{
  height:100%;
  background: linear-gradient(90deg, rgba(0,210,255,0.22), rgba(120,255,170,0.6));
}

/* Content header */
.contentHeader{ display:flex; align-items:center; justify-content:space-between; gap: 10px; padding: 0 0 6px 0; }
.contentHeader__left{ display:flex; align-items:center; gap: 12px; }
.h1{ margin:0; font-size: 14px; letter-spacing: 2px; font-weight: 800; opacity:.9; }

.tabs{
  display:flex; gap: 8px; padding: 6px; border-radius: 999px;
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(0,210,255,0.10);
}
.tab{
  border:none; background: transparent; color: rgba(255,255,255,0.55);
  padding: 10px 12px; border-radius: 999px; cursor:pointer; font-size: 13px;
}
.tab.is-active{ background: rgba(0,210,255,0.10); color: var(--text); border: 1px solid rgba(0,210,255,0.20); }
.tabs--single{ padding: 4px; background: transparent; border: none; }
.tabs--single .tab{ padding: 9px 14px; }

.page{ display:none; }
.page.is-active{ display:block; }

.cardGrid{
  display:grid;
  grid-template-columns: minmax(260px, 380px) minmax(0, 1fr);
  gap: var(--gap);
  padding-bottom: 14px;
}

.card{
  border-radius: var(--radius);
  background: rgba(13,16,22,0.88);
  border: 1px solid var(--borderSoft);
  box-shadow: 0 18px 60px rgba(0,0,0,0.55);
  padding: 14px;
}
.card--center{ display:flex; flex-direction:column; align-items:center; gap: 10px; }

.avatarBox{
  width: 260px;
  height: 260px;
  border-radius: 32px;
  border: 1px solid rgba(0,210,255,0.18);
  background: rgba(255,255,255,0.04);
  display:flex;
  align-items:center;
  justify-content:center;
  color: rgba(255,255,255,0.55);
  font-size: 20px;
}
.avatarBox img{
  width:100%;
  height:100%;
  object-fit: cover;
  border-radius: 32px;
  display:block;
}

.h2{ margin: 0 0 8px 0; font-size: 18px; }
.pageIntro{ padding: 4px 4px 14px 4px; }
.pageIntro__row{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.eventTabs{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
.eventTabs .pill{ padding-left:14px; padding-right:14px; }
.eventTabs .pill.is-active{ border-color: rgba(0,210,255,.45); box-shadow: 0 0 0 2px rgba(0,210,255,.12) inset; }

/* Eventos/Jefes: header sin título; tabs centrados */
.pageIntro--events .pageIntro__row{ justify-content:center; }
.pageIntro--events .eventTabs{ justify-content:center; }
.muted{ color: var(--muted); font-size: 13px; line-height: 1.4; }
.cardTitle{ font-size: 14px; letter-spacing: 1px; opacity: .9; margin-bottom: 10px; }
.avatar__frame{
  width: 200px; height: 200px;
  border-radius: 30px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(0,210,255,0.12);
  box-shadow: var(--glow);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  line-height: 1;
  margin-left:auto;
  margin-right:auto;
}

.avatar__frame img{ width:100%; height:100%; object-fit:cover; object-position:center; display:block; }
.avatar__placeholder{ opacity:.55; }

/* --- Avatar: contenedor con tamaño real (para que la imagen no se vaya a 0px) --- */
.avatar__frame{ position:relative; }
/* --- Avatar: parallax (solo móvil / pantallas con scroll) --- */
.avatarParallax{
  position:absolute;
  inset:0;
  z-index:0;
  overflow:hidden;
  pointer-events:none;
}
.avatarLayer{
  position:absolute;
  inset:-12%; /* margen para mover sin mostrar bordes */
  transform: translate3d(0,0,0);
  will-change: transform;
  opacity: 1;
}
.avatarLayer--bg{
  background:
    radial-gradient(120px 120px at 22% 18%, rgba(255,255,255,0.14), transparent 55%),
    radial-gradient(180px 180px at 68% 30%, rgba(0,210,255,0.14), transparent 60%),
    radial-gradient(220px 220px at 52% 78%, rgba(114,26,255,0.18), transparent 65%),
    linear-gradient(180deg, rgba(10,15,22,0.65), rgba(10,20,32,0.55));
}
.avatarLayer--mid{
  background:
    radial-gradient(240px 240px at 50% 45%, rgba(255,255,255,0.08), transparent 62%),
    radial-gradient(180px 180px at 52% 80%, rgba(0,210,255,0.10), transparent 70%);
  mix-blend-mode: screen;
  opacity: .75;
}

/* Asegura que la foto quede encima de las capas */
.avatar__box{ z-index:1; }

/* En escritorio: sin "marco" visible (solo la imagen) */
@media (min-width: 981px){
  .avatar__frame{
    background: transparent;
    border: none;
    box-shadow: none;
  }
}


@media (min-width: 981px){
  /* Desktop: two-column layout — scene can be tall */
  .heroScene{
    min-height: 580px;
    max-height: 82vh;
  }

  /* Photo: fill entire container, anchor character at bottom */
  .heroPhotoFill img{
    object-fit: cover;
    object-position: 50% 100%;
  }

  /* Nombre fuera de la cara (también en escritorio) */
  .heroName--overlay{
    left: 18px;
    top: 14px;
    transform: none;
    text-align: left;
    max-width: 70%;
  }

  /* Fade superior menos oscuro en escritorio */
  .heroSceneShade{
    background:
      radial-gradient(900px 620px at 50% 30%, rgba(0,210,255,0.10), rgba(0,0,0,0) 62%),
      radial-gradient(1200px 900px at 50% 50%, rgba(0,0,0,0.10), rgba(0,0,0,0.55) 78%),
      linear-gradient(180deg, rgba(0,0,0,0.28) 0%, rgba(0,0,0,0.00) 32%),
      linear-gradient(0deg, rgba(0,0,0,0.70) 0%, rgba(0,0,0,0.00) 46%);
  }
}


@media (prefers-reduced-motion: reduce){
  .avatarLayer{ transform:none !important; }
}

.avatar__box{
  position:absolute;
  z-index:1;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
}
.avatar__box img{
  width:100%;
  height:100%;
  object-fit:cover;
  object-position:center center;
  max-width:none;
  display:block;
}
.avatar__box .avatar__placeholder{ opacity:.55; }
.avatarEditBtn{
  position:absolute;
  top:10px;
  right:10px;
  width: 36px;
  height: 36px;
  border-radius: 12px;
  border: 1px solid rgba(0,210,255,0.28);
  background: rgba(25,42,86,0.72);
  color: rgba(220,220,230,0.95);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow: 0 10px 26px rgba(0,0,0,0.45);
  opacity: 0;
  transform: translateY(-4px);
  transition: opacity .14s ease, transform .14s ease, border-color .14s ease, background .14s ease;
  z-index: 5;
}
.avatar__frame:hover .avatarEditBtn{ opacity: 1; transform: translateY(0); }
.avatarEditBtn:hover{ border-color: rgba(0,210,255,0.55); background: rgba(25,42,86,0.86); }

/* Touch devices (iPad/iPhone): no hover -> keep the icon visible */
@media (hover: none){
  .avatarEditBtn{ opacity: 1; transform: none; }
}
.avatar__actions{ display:flex; gap: 10px; flex-wrap:nowrap; justify-content:center; width:100%; margin-top: 14px; }

/* Eddy pidió simplificar: ocultar "Poner" y "Quitar"; dejar solo "Editar" (que también abre el selector) */
.avatar__actions--secondary{ margin-top: -2px; }

.heroName{ font-size: 28px; letter-spacing: 4px; font-weight: 900; opacity: .92; }

/* Hero name overlay (encima del avatar, sin tocar la foto) */
.heroAvatarWrap{ position:relative; display:flex; justify-content:center; align-items:center; width: fit-content; margin: 0 auto; }
.heroName--overlay{
  position:absolute;
  left: 18px;
  top: 14px;
  transform: none;
  z-index: 6;
  pointer-events:none;
  max-width: 92%;
  text-align:left;

  /* Estilo "nombre flotando" (sin pastilla) */
  padding: 0;
  background: transparent;
  border: 0;
  border-radius: 0;
  backdrop-filter: none;

  color: rgba(245,248,255,0.92);
  font-weight: 900;
  letter-spacing: 4px;
  text-transform: uppercase;

  /* 3D / glow sutil */
  text-shadow:
    0 2px 0 rgba(0,0,0,0.55),
    0 6px 14px rgba(0,0,0,0.55),
    0 0 18px rgba(0,210,255,0.20);
  -webkit-text-stroke: 0.6px rgba(0,0,0,0.35);
}

@media (max-width: 520px){
  .heroName{ font-size: 22px; letter-spacing: 4px; }
  .heroName--overlay{ font-size: 22px; letter-spacing: 4px; top: 10px; left: 14px; }
}


/* Option C: move Meta/Descripción to the right panel */
.notesCard{
  background: rgba(0,0,0,0.22);
  border: 1px solid rgba(0,210,255,0.10);
  border-radius: 18px;
  padding: 12px;
  margin-top: 12px;
}
.notesCard .field label{ opacity: .70; }
.notesCard textarea{
  min-height: 74px;
}
@media (max-width: 980px){
  .notesCard{ margin-top: 10px; }
  .notesCard textarea{ min-height: 66px; }
}
.formCard{
  width:100%;
  border-radius: var(--radius);
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(0,210,255,0.12);
  padding: 12px;
}
.label{ display:block; font-size: 13px; opacity:.8; margin-bottom: 8px; letter-spacing: .5px;}
.labelSmall{ font-size: 12px; opacity:.7; margin-bottom: 6px;}
.input{
  width:100%;
  border-radius: 999px;
  padding: 12px 14px;
  border: 1px solid rgba(0,210,255,0.18);
  background: rgba(0,0,0,0.22);
  color: var(--text);
}
.input--select{
  -webkit-appearance: none;
  appearance: none;
  /* iOS/Safari: keep custom styling */
  background-color: rgba(0,0,0,0.22);
  color-scheme: dark;
  padding-right: 40px;
  cursor:pointer;
  position:relative;
  background-image:
    linear-gradient(45deg, transparent 50%, rgba(0,210,255,0.75) 50%),
    linear-gradient(135deg, rgba(0,210,255,0.75) 50%, transparent 50%);
  background-position:
    calc(100% - 20px) calc(50% - 3px),
    calc(100% - 14px) calc(50% - 3px);
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
}
.input--select::-ms-expand{ display:none; }
.input--select:focus{ outline: none; border-color: rgba(0,210,255,0.32); }
.textarea{
  width:100%;
  min-height: 94px;
  border-radius: 16px;
  padding: 12px 12px;
  border: 1px solid rgba(0,210,255,0.18);
  background: rgba(0,0,0,0.22);
  color: var(--text);
  resize: none;
  overflow-x: hidden;
  overflow: hidden;
}

/* Focus styles (keep modals consistent + avoid white default outline) */
.input:focus,
.input:focus-visible,
.textarea:focus,
.textarea:focus-visible,
.input--select:focus,
.input--select:focus-visible{
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 2px rgba(34,211,238,0.18);
}
.textarea--small{ min-height: 88px; }
.textarea--meta{ min-height: 72px; }
.textarea--desc{ min-height: 96px; }

.spacer{ height: 10px; }

.fields3{ display:grid; grid-template-columns: 1fr 90px 1fr; gap: 12px; margin-bottom: 12px; }
.fields3 .field{ min-width: 0; }

.stats{
  display:grid; grid-template-columns: 1fr 1fr; gap: 10px 14px;
  padding: 10px; border-radius: var(--radius);
  background: linear-gradient(180deg, rgba(255,255,255,0.035), rgba(255,255,255,0.015));
  border: 1px solid rgba(0,210,255,0.14);
  box-shadow: var(--glow);
  margin-bottom:10px;
}
.stat{ display:grid; grid-template-columns: 44px minmax(0, 1fr) 36px; align-items:center; gap: 10px; }
.stat--wide{ grid-column: 1 / -1; }
.badge{
  width: 40px; height: 28px; border-radius: 10px; display:grid; place-items:center;
  font-size: 12px; border: 1px solid rgba(0,210,255,0.22); background: rgba(0,210,255,0.12); box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
}
.stat__track{ position:relative; height: 6px; border-radius: 999px; background: rgba(255,255,255,0.10); border: 1px solid rgba(0,0,0,0.40); min-width:0; }
.stat__val{ text-align:right; font-weight: 700; }
.stat__dot{
  position:absolute; top: 50%; transform: translate(-50%, -50%);
  width: 14px; height: 14px; border-radius: 999px;
  background: rgba(255,225,160,0.92); border: 1px solid rgba(255,240,200,0.95);
  box-shadow: 0 0 0 4px rgba(0,210,255,0.14), 0 6px 14px rgba(0,0,0,0.35);
  z-index: 1;
}

/* Desktop: compact stats block so it doesn't eat too much vertical space */
@media (min-width: 901px){
  .stats{
    padding: 8px;
    gap: 6px 12px;
    margin-bottom: 8px;
  }
  .stat{ gap: 8px; }
  .badge{
    width: 38px;
    height: 24px;
    border-radius: 9px;
    font-size: 11px;
  }
  .stat__track{ height: 5px; }
  .stat__dot{ width: 12px; height: 12px; box-shadow: 0 0 0 3px rgba(0,210,255,0.14), 0 6px 14px rgba(0,0,0,0.35); }
  .stat__val{ font-size: 12px; }
}
.xpHeader{ display:flex; align-items:center; gap: 10px; flex-wrap:wrap; margin-top:24px; }
.xpLevel{ font-size: 22px; font-weight: 900; }
.xpText{ opacity:.75; }
.xpBtns{ margin-left:auto; display:flex; gap: 8px; flex-wrap:wrap; }
.xpBar{
  height: 14px; border-radius: 999px; background: rgba(255,255,255,0.07);
  border: 1px solid rgba(0,210,255,0.18); overflow:hidden; margin: 12px 0 14px 0;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.35) inset;
}
.xpFill{ height:100%; background: rgba(251,191,36,0.90); box-shadow: 0 0 20px rgba(251,191,36,0.14); }

.xpFooter{ display:grid; grid-template-columns: 1fr 220px; gap: 12px; margin-bottom: 12px; }
.subCard{
  border-radius: var(--radius2);
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(0,210,255,0.10);
  padding: 12px;
}
.subCard__val{ font-size: 18px; font-weight: 800; opacity:.9; }
.chipRow{ display:flex; gap: 10px; flex-wrap:wrap; }
.twoCols{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.cards2{ display:grid; grid-template-columns: 1fr 1fr; gap: var(--gap); padding-bottom: 14px; }

/* --- Desafíos: jerarquías visuales y motivación --- */
.cards2--ch{ grid-template-columns: minmax(0, 420px) minmax(0, 1fr); }
@media (max-width: 980px){
  .cards2--ch{ grid-template-columns: 1fr; }
}

.cardHead--ch{ margin-bottom: 8px; }
.cardHead--chDetail{ margin-bottom: 8px; }

.chProgressChips{ display:flex; flex-wrap:wrap; gap: 8px; justify-content:flex-end; align-items:center; }
.chProgressBar{
  height: 10px;
  border-radius: 999px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(0,210,255,0.14);
  overflow:hidden;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.35) inset;
}
.chProgressFill{
  height: 100%;
  background: linear-gradient(90deg, rgba(114,26,255,0.72), rgba(0,210,255,0.62));
  box-shadow: 0 0 18px rgba(114,26,255,0.18), 0 0 12px rgba(0,210,255,0.10);
}

.challengeList{ display:flex; flex-direction:column; gap: 10px; }

.challengeItem{
  position: relative;
  border-radius: 16px;
  border: 1px solid rgba(0,210,255,0.12);
  background: rgba(0,0,0,0.18);
  padding: 12px 12px 12px 14px;
  transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
}
.challengeItem::before{
  content:"";
  position:absolute;
  left:0; top:0; bottom:0;
  width: 4px;
  border-radius: 16px 0 0 16px;
  background: rgba(220,220,230,0.16);
  opacity: .95;
}
.challengeItem[data-diff="easy"]::before{ background: rgba(0,210,255,0.62); }
.challengeItem[data-diff="medium"]::before{ background: rgba(114,26,255,0.62); }
.challengeItem[data-diff="hard"]::before{ background: rgba(255,90,90,0.62); }

.challengeItem:hover{
  transform: translateY(-1px);
  border-color: rgba(0,210,255,0.20);
  box-shadow: 0 8px 22px rgba(0,0,0,0.25);
}
.challengeItem.is-selected{
  border-color: rgba(0,210,255,0.38);
  box-shadow: 0 0 0 1px rgba(0,210,255,0.18) inset, 0 10px 26px rgba(0,0,0,0.28);
}
.challengeItem.is-done{ border-color: rgba(114,26,255,0.35); box-shadow: 0 0 0 1px rgba(114,26,255,0.12) inset; }
.challengeItem.is-done .challengeName{ opacity:.72; text-decoration: line-through; }

.challengeName{ font-weight: 850; letter-spacing: .2px; }

.challengeDetailHead{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 12px;
  padding: 10px 0 10px 0;
  border-top: 1px solid rgba(255,255,255,0.06);
  border-bottom: 1px solid rgba(255,255,255,0.06);
  margin-top: 8px;
}
.challengeDetailMeta{ display:flex; flex-direction:column; gap: 6px; }
.challengeDetailActions{ display:flex; flex-wrap:wrap; gap: 8px; justify-content:flex-end; }

.chDetailBadges{ display:flex; flex-wrap:wrap; gap: 8px; justify-content:flex-end; align-items:center; }

.challengeBody{
  padding-top: 12px;
  line-height: 1.55;
}
.chBodyP{ margin: 0 0 10px 0; opacity: .95; }
.chBodyList{ margin: 0 0 12px 18px; padding: 0; }
.chBodyList li{ margin: 6px 0; }
.chCallout{
  border-radius: 14px;
  border: 1px solid rgba(0,210,255,0.14);
  background: rgba(0,210,255,0.06);
  padding: 10px 12px;
  margin: 10px 0 12px 0;
}
.chCallout .muted{ opacity:.80; }

/* Activities + Weekly XP row */
.heroRight__weekRow{ display:grid; grid-template-columns: 1fr 260px; gap: var(--gap); align-items:stretch; }
@media (max-width: 900px) and (orientation: portrait){
  .heroRight__weekRow{ grid-template-columns: 1fr; }
  #actChips{ flex-wrap: nowrap; justify-content:space-between; }
  #actChips .pill{ padding: 8px 10px; font-size: 12px; }
  #actChips .pill .i{ margin-right: 6px; }
}
.challengeRow{display:flex;flex-direction:column;gap:8px}
.challengeMetaRow{display:flex;flex-wrap:wrap;column-gap:10px;row-gap:10px;opacity:.95}
.badge{display:inline-flex;align-items:center;gap:6px;padding:5px 10px;border-radius:999px;font-size:12px;line-height:1;border:1px solid var(--borderSoft);background:rgba(255,255,255,0.03);color:var(--text,#e8ecf4);white-space:nowrap}
.badge--subj{border-color:rgba(0,210,255,0.20)}
.badge--pts{border-color:rgba(251,191,36,0.35);background:rgba(251,191,36,0.10);color:rgba(232,236,244,0.96)}
.badge--done{border-color:rgba(34,211,238,0.40);background:rgba(34,211,238,0.10)}
.badge--diff{border-color:rgba(220,220,230,0.18)}
.badge--easy{border-color:rgba(0,210,255,0.34); background: rgba(0,210,255,0.10); color: rgba(220,220,230,0.95); }
.badge--medium{border-color:rgba(114,26,255,0.36); background: rgba(114,26,255,0.12); color: rgba(220,220,230,0.95); }
.badge--hard{border-color:rgba(255,90,90,0.38); background: rgba(255,90,90,0.10); color: rgba(220,220,230,0.95); }

/* Bottom nav (solo móvil) */
.bottomNav{
  display:none;
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 10000;
  gap: 10px;

  /* Más visible sobre fondo negro */
  padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
  background: rgba(0,0,0,0.96);
  border-top: 1px solid rgba(34,211,238,0.22);
  box-shadow:
    0 -18px 48px rgba(0,0,0,0.88),
    0 -1px 0 rgba(34,211,238,0.16) inset;

  backdrop-filter: blur(12px);
  pointer-events:auto;
  touch-action:manipulation;
}

/* Línea/halo superior para separar el menú del contenido */
.bottomNav::before{
  content:"";
  position:absolute;
  left:0; right:0;
  top:-18px;
  height:18px;
  background: linear-gradient(to top, rgba(0,0,0,0), rgba(0,0,0,0.85));
  pointer-events:none;
}


.shell.is-drawer-open .bottomNav{ pointer-events: none; }
.bottomNav__btn{
  flex:1;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
  color: var(--text);
  border-radius: 18px;
  padding: 14px 10px;
  font-size: 13px;
  cursor:pointer;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

.bottomNav__btn.is-active{ background: rgba(34,211,238,0.14); border-color: rgba(34,211,238,0.55); box-shadow: 0 0 0 2px rgba(34,211,238,0.12) inset; }

/* Tablet */
@media (max-width: 1180px){
  :root{ --maxw: 1080px; }
  .shell{
    grid-template-columns: 320px 1fr;
    grid-template-areas: "sidebar content";
  }
  .details{ display:none; }
  .gridCards{ grid-template-columns: repeat(3, minmax(180px, 1fr)); }
  .cardGrid{ grid-template-columns: minmax(240px, 340px) minmax(0, 1fr); }
}

/* Drawer layouts */
@media (max-width: 980px){
  .brand__title{ display:none; }
  .topnav{ display:none; }

  .bottomNav{ display:flex; }
  .pages{ padding-bottom: 96px; }
  .topbar__right{ gap: 8px; overflow-x:auto; -webkit-overflow-scrolling: touch; scrollbar-width:none; }
  .topbar__right::-webkit-scrollbar{ display:none; }
  .topbar__right .pill, .topbar__right .dropdown__btn{ padding: 10px 12px; font-size: 12px; border-radius: 16px; }
  .topbar__menu{ display:inline-grid; place-items:center; }
  .shell{ grid-template-columns: 1fr; grid-template-areas: "content"; }
  .details{ display:none; }
  .gridCards{ grid-template-columns: repeat(3, minmax(180px, 1fr)); }
  .cardGrid{ grid-template-columns: minmax(220px, 45vw) minmax(0, 1fr); }
  .sidebar{
    position:absolute;
    left: 0; top: 0; height: 100%;
    width: min(360px, 86vw);
    z-index: 30;
    transform: translateX(-105%);
    transition: transform .18s ease;
  }
  .shell.is-drawer-open .sidebar{ transform: translateX(0); }
}

/* Mobile */
@media (max-width: 640px){
  :root{ --gap: 12px; }
  /* Mobile header: center brand, left hamburger, right trophy */
  /* Reduce header height on phones (override desktop min-height: 74px) */
  .topbar{
    display: grid;
    grid-template-columns: 46px 1fr 46px;
    align-items: center;
    gap: 10px;

    min-height: 56px;
    padding: 6px 10px;
    border-radius: 22px;
  }
  .topbar{ position: relative; }
  .topbar__left{ display: contents; padding-right: 0; width:auto; }
  /* Force everything onto the same row (iOS was auto-placing the brand on row 2) */
  #btnMenu{ grid-column:1; grid-row:1; justify-self:start; align-self:center; }
  .brand{ grid-column:2; grid-row:1; justify-self:center; align-self:center; }
  .topbar__right{ display: none; }
  .topbar__trophyBtn{
    display: inline-flex;
    width:38px; height:38px; border-radius:12px;
    align-items:center; justify-content:center;
    background:rgba(255,255,255,.04);
    border:1px solid rgba(0,210,255,.18);
    color:#eae7df;
    grid-column:3;
    grid-row:1;
    justify-self:end;
    align-self:center;
  }
  .trophyIcon{ width:22px; height:22px; }
  /* Slightly smaller logo to keep header compact */
  .brand__logo{ width:40px; height:40px; border-radius: 12px; }
  .brand__logo svg{ width:28px !important; height:28px !important; }
  .topbar__right .pill, .topbar__right .dropdown{ padding: 10px 10px; font-size: 12px; border-radius: 16px; }
  .brand__subtitle{ display:none; }
  .brand__text{ display:none; }
  .bottomNav{ display:flex; padding-bottom: calc(10px + var(--safe-bottom)); }

  .cardGrid{ grid-template-columns: 1fr; }
  .fields3{ grid-template-columns: 1fr 80px; }
  .fields3 .field:last-child{ grid-column: 1 / -1; }

  .stats{ grid-template-columns: 1fr; }
  .stat{ grid-template-columns: 44px minmax(0, 1fr) 36px; }

  .xpFooter{ grid-template-columns: 1fr; }
  .twoCols{ grid-template-columns: 1fr; }
  .cards2{ grid-template-columns: 1fr; }
  .gridCards{ grid-template-columns: repeat(2, minmax(150px, 1fr)); }

  .avatar__actions{ flex-wrap: wrap; }

  .modal{ place-items:end center; padding: 10px; }
  .modal__card{
    width: 100%;
    max-height: 82vh;
    border-radius: 18px 18px 12px 12px;
    padding: 14px;
  }
  .modal__header{
    position: sticky;
    top: 0;
    padding-bottom: 8px;
    margin-bottom: 8px;
    background: rgba(12,12,12,0.96);
    z-index: 1;
  }
}

/* 4K */
@media (min-width: 1800px){
  :root{ --maxw: 1660px; }
  .shell{ grid-template-columns: 340px minmax(0, 1fr); grid-template-areas: "sidebar content"; }
  .shell.is-details-open{ grid-template-columns: 340px minmax(0, 1fr) 380px; }
}

/* =========================
   v17 – Ajustes compactos
   ========================= */

/* Ocultar barras de scroll (sin desactivar scroll) */
body, .pages, .list{
  -ms-overflow-style: none; /* IE/Edge */
  scrollbar-width: none;    /* Firefox */
}
body::-webkit-scrollbar,
.pages::-webkit-scrollbar,
.list::-webkit-scrollbar{
  width: 0;
  height: 0;
}

/* Botón icono genérico (por defecto NO es absoluto; así no flota sobre otros UI) */
.card--avatar{
  position: relative;
  display:flex;
  flex-direction:column;
  align-items:stretch;
  gap: 10px;
  padding: 0; /* sin marco visible: la escena ocupa todo */
  background: transparent;
  border: none;
  box-shadow: none;
}

/* --- Fichas: escena grande por capas (parallax en móvil) --- */
.heroScene{
  position: relative;
  width: 100%;
  /* Use aspect-ratio as intrinsic sizing hint, min/max-height as guardrails */
  aspect-ratio: 3 / 4;
  min-height: 360px;
  max-height: 78vh;
  border-radius: calc(var(--radius) - 4px);
  overflow: hidden;
  background: radial-gradient(1200px 700px at 50% 30%, rgba(255,255,255,0.10), rgba(0,0,0,0) 60%),
              linear-gradient(180deg, rgba(9,14,22,0.92), rgba(6,10,18,0.92));
}

/* Fichas (desktop): estirar la imagen para alinear la base con la tarjeta de la derecha */
@media (min-width: 981px){
  .page[data-page="fichas"] .cardGrid{
    align-items: stretch;
  }

  .page[data-page="fichas"] .card--avatar{
    height: 100%;
  }

  .page[data-page="fichas"] .card--avatar .heroScene{
    height: 100%;
    min-height: 100%;
    max-height: none;
    aspect-ratio: auto;
  }
}

/* Short viewports (landscape or small laptops): cap the scene */
@media (max-height: 700px){
  .heroScene{
    aspect-ratio: auto;
    min-height: 320px;
    max-height: 58vh;
  }
}

.heroSceneLayer{
  position:absolute;
  /* BG necesita más margen para moverse; FG/MID tendrán su propio inset */
  inset: -28%;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  transform: translate3d(0,0,0);
  will-change: transform;
}

/* Capas */
.heroSceneLayer--bg{
  background-image: var(--heroLayerBg);
  filter: saturate(0.95) contrast(1.02);
}

.heroSceneLayer--mid{
  background-image: var(--heroLayerMid);
  opacity: .95;
  inset: -18%;
  background-position: 50% 65%;
}

.heroSceneLayer--fg{
  background-image: var(--heroLayerFg);
  opacity: .98;
  inset: -4%;
  background-size: cover;
  background-position: 50% 100%;
  filter: drop-shadow(0 16px 28px rgba(0,0,0,.35));
}

/* Fallback: cuando no existe imagen del héroe, usar silueta como fondo que cubre todo */
.heroScene.is-silhouette .heroSceneLayer--bg{
  inset: 0;
  background-size: cover;
  background-position: center;
  filter: none;
}

.heroScene.is-silhouette .heroSceneLayer--mid,
.heroScene.is-silhouette .heroSceneLayer--fg{
  display: none !important;
}


/* Foto (si existe) ocupa TODO el panel; si no, se oculta y se ven las capas */
.heroPhotoFill{
  position:absolute;
  inset: 0;
  z-index: 3;
  transform: translate3d(0,0,0);
  background: radial-gradient(900px 600px at 50% 20%, rgba(255,255,255,0.06), rgba(0,0,0,0) 60%),
              linear-gradient(180deg, rgba(8,12,20,0.35), rgba(0,0,0,0.55));
}
.heroPhotoFill.is-empty{
  /* Sin foto: ocultar esta capa para que se vean las capas de escena (parallax/demo). */
  display:none;
}

.heroPhotoFill img{
  width: 100%;
  height: 100%;
  object-fit: contain; /* mostrar casi toda la imagen */
  object-position: 50% 100%;
  display:block;
}

.heroSceneShade{
  position:absolute;
  inset: 0;
  z-index: 4;
  /* Fades para legibilidad (sin "tapar" tanto el arte) */
  background:
    radial-gradient(900px 620px at 50% 30%, rgba(0,210,255,0.10), rgba(0,0,0,0) 62%),
    radial-gradient(1200px 900px at 50% 50%, rgba(0,0,0,0.10), rgba(0,0,0,0.55) 78%),
    linear-gradient(180deg, rgba(0,0,0,0.55) 0%, rgba(0,0,0,0.00) 38%),
    linear-gradient(0deg, rgba(0,0,0,0.70) 0%, rgba(0,0,0,0.00) 46%);
  pointer-events:none;
}


/* Botones dentro de la escena */
.heroPhotoBtn{
  position:absolute;
  top: 12px;
  left: 12px;
  z-index: 6;
  border-color: rgba(0,210,255,0.24);
}

/* Notas como overlay, para que la imagen siga ocupando todo el bloque */
.heroNotesOverlay{
  position:absolute;
  left: 12px;
  right: 12px;
  bottom: 12px;
  z-index: 6;

  /* Dock: que no invada toda la ilustración */
  max-height: 34%;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  pointer-events: none; /* la rejilla vuelve a habilitarlo */
}

.heroNotesOverlay .noteGrid--overlay{
  pointer-events: auto;
  max-width: 560px;
  margin: 0 auto;
}

/* Overlay más "ligero" */
.noteGrid--overlay{
  margin-top: 0;
  gap: 10px;
}
.noteGrid--overlay .noteCol{
  background: rgba(12,14,20,.30);
  border: 1px solid rgba(0,210,255,.12);
  backdrop-filter: none;
  padding: 10px;
}
.noteGrid--overlay .noteTitle{
  font-size: 12px;
  opacity: .86;
}

/* Textareas más compactas en overlay */
.noteGrid--overlay .textarea--short{
  min-height: 54px;
  max-height: 96px;
}

/* Fila superior del cuadro de Descripción: título + botón de ocultar */
.noteTitleRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 8px;
}
.noteTitleRow .noteTitleTools{
  display:flex;
  align-items:center;
  justify-content:flex-end;
}

/* Botón de notas: por defecto (cuando está colapsado) va en esquina inferior derecha */
.heroNotesToggleBtn{
  position:absolute;
  right: 12px;
  bottom: 12px;
  z-index: 10050; /* arriba del bottomNav para que siempre detecte el click */
  width: 40px;
  height: 40px;
  border-radius: 14px;
  display:grid;
  place-items:center;
  background: rgba(10,12,16,0.30);
  border: 1px solid rgba(0,210,255,0.16);
  backdrop-filter: none;
  box-shadow: 0 10px 18px rgba(0,0,0,0.35), 0 0 14px rgba(0,210,255,0.12);
  cursor: pointer;
}
.heroNotesToggleBtn:hover{ background: rgba(10,12,16,0.40); }
.heroNotesToggleBtn:active{ transform: translateY(1px); }
.heroNotesToggleBtn:focus{ outline: 2px solid rgba(0,210,255,0.35); outline-offset: 2px; }

/* Cuando las notas están visibles, el botón se coloca dentro del título de 'Descripción rápida' */
.heroNotesToggleBtn.is-inline{
  position: relative;
  right: auto;
  bottom: auto;
  width: 34px;
  height: 34px;
  border-radius: 12px;
  z-index: 1;
}


@media (max-width: 980px){
  .heroScene{
    /* Full-width layout: use generous viewport-based height */
    aspect-ratio: auto;
    min-height: max(60svh, 460px);
    max-height: 76vh;
  }

  /* Show more body, less cropping on head */
  .heroSceneLayer--fg{
    inset: -4%;
    background-size: contain;
    background-position: 50% 100%;
    filter: drop-shadow(0 14px 24px rgba(0,0,0,.32));
  }

  /* Dock más compacto en móvil */
  .heroNotesOverlay{ max-height: 30%; }
  .heroNotesOverlay .noteGrid--overlay{ max-width: 92vw; }

  /* Nombre fuera de la cara */
  .heroName--overlay{
    left: 16px;
    top: 12px;
    transform: none;
    text-align: left;
    max-width: 72%;
    font-size: 22px;
    letter-spacing: 4px;
    padding: 0;
  }
}

@media (prefers-reduced-motion: reduce){
  .heroSceneLayer{ transform: none !important; }
}
.iconBtn{
  width: 40px; height: 40px;
  display:flex; align-items:center; justify-content:center;
  border-radius: 12px;
  border: 1px solid var(--dangerBorder);
  background: rgba(0,0,0,0.18);
  color: rgba(255,255,255,0.78);
  cursor: pointer;
  z-index: 5;
}
.iconBtn:hover{ background: rgba(0,0,0,0.28); border-color: var(--danger); }
.iconBtn:active{ transform: scale(0.98); }

.iconBtn--danger{
  /* Rojo más discreto */
  border-color: rgba(240, 104, 104, 0.32);
  background: rgba(60, 10, 10, 0.22);
}
.heroDeleteBtn{
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 6;
}

/* Cofre de recompensas (por ficha) */
.heroChestBtn{
  position: absolute;
  top: 12px;
  left: 12px;
  z-index: 6;
  border-color: rgba(0,210,255,0.24);
  background: rgba(0,0,0,0.18);
  color: rgba(220,220,230,0.92);
}
.heroChestBtn:hover{ border-color: rgba(0,210,255,0.52); }
.heroChestBtn.is-pending{ box-shadow: 0 0 0 2px rgba(0,210,255,0.10), 0 0 18px rgba(114,26,255,0.22); }
.chestIcon{ width:18px; height:18px; display:block; }
.iconBtn:hover{ background: rgba(26, 26, 26, 0.72); opacity: 1; }
.iconBtn:active{ transform: translateY(1px); }

/* Inline small icon buttons (e.g., reset weekly XP) */
.iconBtn--inline{
  width: 28px;
  height: 28px;
  border-radius: 10px;
  box-shadow: none;
  border: 1px solid rgba(0,210,255,0.18);
  background: rgba(22, 22, 22, 0.45);
}

/* Alias used by some HTML versions */
.btnIcon{ 
  position: static;
  top: auto; right: auto;
  width: 28px;
  height: 28px;
  padding: 0;
  border-radius: 10px;
  box-shadow: none;
  border: 1px solid rgba(0,210,255,0.18);
  background: rgba(22, 22, 22, 0.45);
  color: rgba(255,255,255,0.92);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.btnIcon:hover{ background: rgba(22, 22, 22, 0.60); }
.btnIcon:active{ transform: translateY(1px); }

.subCard__valRow{ display:flex; align-items:center; justify-content:space-between; gap:10px; }

/* Botones 2D/3D más compactos */
.segBtn{ padding: 9px 12px; font-size: 13px; display:flex; align-items:center; justify-content:center; line-height:1; }

/* Evitar que los valores de stats se salgan del contenedor */
.stats{ overflow-x: hidden;
  overflow: hidden; }
.stat{ min-width: 0; max-width: 100%; }
.stat__track{ min-width: 0; }
.segmented{ height: 40px; }


/* Mobile kebab (⋯) centering */
.kebab{display:block; font-size:22px; line-height:1; transform:translateY(0);}


/* Notes under avatar (desktop) */
.noteGrid{margin-top:14px; display:grid; grid-template-columns:1fr; gap:12px;}
.noteCol{background:rgba(0,0,0,.22); border:1px solid rgba(0,210,255,.12); border-radius:18px; padding:12px;}
.noteTitle{font-size:13px; opacity:.85; margin-bottom:8px;}
.textarea--short{min-height:72px; max-height:140px;}
@media (max-width:980px){
  .noteGrid{grid-template-columns:1fr; }
}

/* =========================
   v21 layout overrides
   ========================= */

.kebab{display:block;font-size:20px;line-height:1;transform:translateY(0);}

/* Notes under avatar: stack on desktop (we have space now) */
.noteGrid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px;}
.noteCol{background:rgba(0,0,0,.25);border:1px solid rgba(0,210,255,.12);border-radius:16px;padding:12px;}
.noteTitle{font-size:13px;color:rgba(234,231,223,.8);margin:0 0 8px 2px;letter-spacing:.02em;}
.textarea--short{min-height:72px; max-height:140px;}
.noteCol textarea{ scrollbar-width: none; }
.noteCol textarea::-webkit-scrollbar{ width:0; height:0; }
@media (max-width: 900px){
  .noteGrid{grid-template-columns:1fr;}
}

/* Weekly XP: make it more compact (desktop + mobile) */
.subCard--week .subCard__val{ font-size: 15px; }
.subCard--week .subCard__title{ font-size: 12px; opacity: .8; }

@media (min-width: 901px){
  .xpFooter{ grid-template-columns: 1fr 200px; }
  .subCard--week{ padding: 10px; }
  .subCard--week .iconBtn--tiny{ transform: scale(.95); }
}

/* Stats: force single column and add breathing room above XP */
.stats{grid-template-columns:1fr !important;margin-bottom:12px;}
.stat--wide{grid-column:auto !important;}
.xpHeader{margin-top:24px;}

/* Segmented 2D/3D label centering */
.segmented__btn{line-height:1;}

/* Bottom nav: ensure it's always on top and reliably clickable on iOS */
.bottomNav{z-index:10000;}
.bottomNav button{touch-action:manipulation;}

/* Hide scrollbars where possible */
.pages{scrollbar-width:none;}
.pages::-webkit-scrollbar{width:0;height:0;}
.sidebar{scrollbar-width:none;}
.sidebar::-webkit-scrollbar{width:0;height:0;}

/* iPad portrait/tablet: keep normal header actions, hide 3-dots */
@media (min-width: 641px) and (max-width: 900px){
  .topbar{flex-wrap:nowrap;}
  .topbar__left{flex:1; min-width:0;}
  .topbar__right{display:flex !important;}
  .topbar__right{flex-wrap:wrap; justify-content:flex-end; gap:8px;}
  .topbar__right .pill{padding:8px 12px; font-size:12px;}
  .topbar__moreBtn{display:none !important;}
  .topbar__moreWrap{display:none !important;}

  .fields3{ grid-template-columns: 1fr 86px 1fr; }
  .select{ max-width: 100%; text-overflow: ellipsis; }
}


/* PATCH v25: avatar + weekly reset + spacing */
.avatar__frame{ position:relative; }

/* Place the delete icon relative to the avatar frame (not the whole card) */
.iconBtn--inAvatar{ top:12px; right:12px; }

/* Photo buttons spacing */
.pillRow--photo{ margin-top:16px; }

/* Weekly reset button must be inline (iconBtn is absolute by default) */
#btnWeekReset{ position:static !important; inset:auto !important; transform:none !important; margin-left:8px; }

/* Give a bit more air between stats and XP section */
/* --- v29: hero delete button (subtle) --- */
#heroDeleteBtn{
  position:absolute;
  top:12px;
  right:12px;
  width:34px;
  height:34px;
  border-radius:12px;
  display:grid;
  place-items:center;
  background: var(--dangerBg);
  border:1px solid var(--dangerBorder);
  color: var(--textSoft);
  opacity:.75;
}
#heroDeleteBtn:hover{ background: var(--dangerBgHover); opacity:.9; }


/* --- v29: avatarWrap alignment --- */
.avatarWrap{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:10px;}


/* ---- CLEAN PASS v29: avatar centering + spacing ---- */
.avatar__frame{ margin: 0 auto; }
.avatar__box{ margin: 0 auto; }
.avatar__actions{ margin-top: 14px; gap: 10px; }
.avatar__actions .btn{ padding: 8px 12px; }
#heroDeleteBtn{ opacity: 0.72; }
#heroDeleteBtn:hover{ opacity: 0.95; }


/* Flash highlight for new hero in list */
.heroCard.flash{ outline:2px solid rgba(180,150,80,.55); box-shadow:0 0 0 6px rgba(180,150,80,.12); }

/* Fichas: simplify photo controls (keep only Edit) */
.confirmMsg{ white-space:pre-line; }

/* Hide scrollbars (keep scrolling) */
html, body{ scrollbar-width:none; }
html::-webkit-scrollbar, body::-webkit-scrollbar{ width:0; height:0; }
*{ scrollbar-width:none; }
*::-webkit-scrollbar{ width:0; height:0; }


/* Level Up modal */
.modal__card--levelup{
  max-width: 560px;
  position: relative;
  overflow-x: hidden;
  overflow: hidden;
  /* Special border for "wow" moments */
  border: 1px solid rgba(114,26,255,0.55);
  box-shadow:
    0 0 0 1px rgba(0,210,255,0.10) inset,
    0 22px 70px rgba(0,0,0,0.70),
    0 0 34px rgba(114,26,255,0.20);
}

.modal__card--levelup::before{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius: 18px;
  background: conic-gradient(from 180deg,
    rgba(114,26,255,0.0),
    rgba(114,26,255,0.65),
    rgba(0,210,255,0.45),
    rgba(114,26,255,0.65),
    rgba(114,26,255,0.0));
  filter: blur(0.2px);
  opacity: .75;
  z-index: 0;
  animation: lvlRing 2.2s linear infinite;
  pointer-events:none;
}
.modal__card--levelup::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius: 16px;
  background:
    radial-gradient(800px 220px at 50% 0%, rgba(114,26,255,0.22), transparent 60%),
    radial-gradient(600px 240px at 50% 100%, rgba(0,210,255,0.12), transparent 60%);
  opacity: .9;
  z-index: 0;
  pointer-events:none;
}
.modal__card--levelup > *{ position: relative; z-index: 1; }

@keyframes lvlRing{
  0%{ transform: rotate(0deg); }
  100%{ transform: rotate(360deg); }
}
#levelUpModal .modal__backdrop{
  background: radial-gradient(600px 380px at 50% 30%, rgba(114,26,255,0.20), rgba(0,0,0,0.72));
}
.levelUpBig__num{
  text-shadow: 0 0 22px rgba(114,26,255,0.30), 0 0 20px rgba(0,210,255,0.16);
}


/* Game-ish entry + subtle sparkle layer */
#levelUpModal.is-open .modal__card--levelup{
  animation: lvlCardIn .38s cubic-bezier(.2,1.2,.2,1) both;
}
@keyframes lvlCardIn{
  0%{ transform: translateY(10px) scale(.96); opacity: 0; }
  100%{ transform: translateY(0) scale(1); opacity: 1; }
}
.modal__card--levelup::before{
  content:'';
  position:absolute;
  inset:-120px;
  background:
    radial-gradient(closest-side at 30% 20%, rgba(114,26,255,0.22), transparent 60%),
    radial-gradient(closest-side at 70% 30%, rgba(0,210,255,0.18), transparent 60%),
    radial-gradient(closest-side at 50% 80%, rgba(114,26,255,0.14), transparent 65%);
  opacity: 0.9;
  pointer-events:none;
  transform: rotate(0deg);
  animation: lvlGlowDrift 3.8s ease-in-out infinite alternate;
}
@keyframes lvlGlowDrift{
  0%{ transform: translate3d(-6px,-6px,0) rotate(-2deg); }
  100%{ transform: translate3d(6px,6px,0) rotate(2deg); }
}
.modal__card--levelup > *{ position: relative; z-index: 1; }
.levelUpHeroLine{
  display:flex;
  gap:10px;
  align-items:baseline;
  margin-bottom:10px;
}
.levelUpHeroName{
  font-weight:700;
  letter-spacing:.2px;
}
.levelUpBig{
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  border-radius:18px;
  padding:14px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  margin: 10px auto 14px auto;
  width: min(360px, 100%);
}
.levelUpBig__label{
  opacity:.75;
  font-size:.95rem;
  margin-bottom:2px;
}
.levelUpBig__num{
  font-size: 78px;
  line-height: 1;
  font-weight: 900;
  letter-spacing: -2px;
  transform: translateZ(0);
}
.levelUpBig__num.is-anim{
  animation: lvlPop .75s cubic-bezier(.2,1.2,.2,1) both;
}
@keyframes lvlPop{
  0%{transform: translateY(10px) scale(0.88); opacity: 0.0;}
  55%{transform: translateY(-2px) scale(1.04); opacity: 1.0;}
  100%{transform: translateY(0) scale(1); opacity: 1.0;}
}
.levelUpPickTitle{
  font-weight:700;
  margin: 6px 0 10px 0;
}
.rewardPickGrid{
  display:grid;
  gap:10px;
  grid-template-columns: repeat(1, 1fr);
}
.rewardPickGrid.is-stat{
  grid-template-columns: repeat(3, 1fr);
}
@media (min-width: 520px){
  .rewardPickGrid{ grid-template-columns: repeat(2, 1fr); }
  .rewardPickGrid.is-stat{ grid-template-columns: repeat(5, minmax(0, 1fr)); }
}
.rewardPick{
  border:1px solid rgba(0,210,255,0.16);
  background: rgba(25,42,86,0.40);
  border-radius:14px;
  padding:12px;
  cursor:pointer;
  transition: transform .12s ease, border-color .12s ease, background .12s ease;
}
.rewardPick__row{
  display:flex;
  gap:12px;
  align-items:flex-start;
}
.rewardPick__icon{
  width:38px;
  height:38px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:12px;
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(0,210,255,0.18);
  box-shadow: inset 0 0 0 1px rgba(0,210,255,0.06);
  font-size:18px;
}
.rewardPick__main{ flex:1; min-width: 0; }
.rewardPick:hover{
  transform: translateY(-1px);
  border-color: rgba(0,210,255,0.30);
  background: rgba(25,42,86,0.52);
  box-shadow: 0 0 18px rgba(0,210,255,0.10), 0 0 18px rgba(114,26,255,0.08);
}
.rewardPick__title{
  font-weight:800;
  margin-bottom:4px;
}
.rewardPick__desc{
  opacity:.82;
  font-size:.95rem;
}
.rewardPick__meta{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-top:6px;
}
.rewardPick__plus{
  font-weight:900;
  letter-spacing: 0.6px;
  color: rgba(0,210,255,0.92);
  text-shadow: 0 0 14px rgba(0,210,255,0.22);
}
.rewardPick--stat{
  padding: 8px 10px;
  display:flex;
  flex-direction:row;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  min-height: 52px;
}
.rewardPick--stat .rewardPick__title{
  font-weight: 900;
  letter-spacing: .6px;
}
.rewardPick--stat .rewardPick__meta{
  margin-top: 0;
  gap:8px;
}

.levelUpStatHead{
  grid-column: 1 / -1;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  margin-bottom: 2px;
}
.levelUpStatHead__title{
  font-weight: 900;
  letter-spacing: .6px;
}
.levelUpHint{ margin-top: 10px; }

/* Reward history in ficha */
.heroRewardsBox{
  margin-top: 12px;
  width: 100%;
}
.rewardHistory{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-top: 8px;
}
.rewardItem{
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.03);
  border-radius:12px;
  padding:10px 12px;
  display:flex;
  gap:10px;
  align-items:flex-start;
  justify-content:space-between;
}
.rewardItem__left{ min-width: 0; }
.rewardItem__title{ font-weight:800; }
.rewardItem__meta{ opacity:.75; font-size:.9rem; margin-top:2px; }
.rewardItem__badge{
  font-size:.85rem;
  opacity:.9;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.05);
  border-radius: 999px;
  padding: 4px 10px;
  white-space:nowrap;
}



/* Stats sliders (Fichas) */
.statRow{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:10px 10px;
  border:1px solid rgba(0,210,255,.18);
  background: rgba(0,0,0,.22);
  border-radius:14px;
  box-shadow: 0 0 0 1px rgba(0,210,255,0.06), 0 18px 50px rgba(0,0,0,0.35) inset;
}
.statRow__label{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.statRow__val{
  font-weight:800;
  opacity:.9;
}
.statRow__bar{
  position:relative;
  height:14px;
  border-radius:999px;
  background: rgba(0,0,0,0.28);
  border: 1px solid rgba(0,210,255,0.14);
  overflow:hidden;
}
.statRow__fill{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, rgba(114,26,255,0.70), rgba(0,210,255,0.60));
  box-shadow: 0 0 18px rgba(0,210,255,0.12);
}
.statRow__range{
  position:absolute;
  inset: -6px 0 -6px 0;
  width:100%;
  opacity:0;
  cursor:pointer;
}

/* --- Recompensas (layout) --- */
.pageIntro{ margin: 0 0 14px 0; }
.rewardsGrid{ display: grid; grid-template-columns: 1.25fr 1fr; gap: 14px; }
.cardHead{ display: flex; align-items: baseline; justify-content: space-between; gap: 12px; margin-bottom: 10px; }
.cardHead .muted{ font-size: 12px; opacity: .75; }

@media (max-width: 980px){
  .rewardsGrid{ grid-template-columns: 1fr; }
}

.rewardGeneralItem .rewardItem__badge{ opacity: .85; }


/* --- Stats: segmentos (compacto) --- */
.statLine{
  display:flex;
  align-items:center;
  gap:12px;
  margin:10px 0;
}
.statBadge{
  min-width:54px;
  text-align:center;
}
.statMeter{
  position:relative;
  flex:1;
  height:18px;
  border-radius:999px;
  padding:4px;
  background: rgba(0,0,0,0.30);
  border: 1px solid rgba(0,210,255,0.18);
  box-shadow: inset 0 0 0 1px rgba(0,210,255,0.06);
}
.statSegs{
  display:grid;
  grid-template-columns: repeat(20, 1fr);
  gap:3px;
  height:100%;
}
.statSeg{
  border-radius:3px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(0,210,255,0.12);
}
.statSeg.locked{
  opacity: 0.28;
  filter: saturate(0.7);
}
.statSeg.on.locked{
  opacity: 0.28;
  box-shadow: none;
}
.statSeg.on{
  background: linear-gradient(180deg, rgba(114,26,255,0.70), rgba(0,210,255,0.52));
  border-color: rgba(0,210,255,0.30);
  box-shadow: 0 0 10px rgba(114,26,255,0.14);
}
.statRange{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  opacity:0;
  cursor:pointer;
  touch-action: pan-x;
}
.statNum{
  min-width: 34px;
  text-align:center;
  font-weight: 1000;
  font-size: 12px;
  line-height: 1.05;
  font-variant-numeric: tabular-nums;
  letter-spacing: 0.2px;
  color: rgba(250,250,255,0.98);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

  /* Sin "pill": más limpio */
  background: transparent;
  border: none;
  border-radius: 0;

  /* Más visible sin crecer layout: escala por transform */
  transform: translateZ(0) scale(1.12);
  -webkit-text-stroke: 0.7px rgba(0,0,0,0.45);

  /* Efecto 3D (extrusión) + glow */
  text-shadow:
    0 1px 0 rgba(0,0,0,0.60),
    0 2px 0 rgba(0,0,0,0.55),
    0 3px 0 rgba(0,0,0,0.45),
    0 6px 14px rgba(0,0,0,0.55),
    0 0 16px rgba(0,210,255,0.22);
}


.statNum.is-pop{ animation: statPop .18s ease-out both; }
@keyframes statPop{
  0%{ transform: scale(0.92); filter: brightness(0.9); }
  100%{ transform: scale(1); filter: brightness(1); }
}

/* --- Rewards list (derecha): más detalle --- */
.rewardItem__titleRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.rewardItem__kind{
  font-size:12px;
  padding:4px 8px;
  border-radius:999px;
  background:rgba(0,0,0,0.25);
  border:1px solid rgba(0,210,255,0.14);
  color:rgba(240,240,240,0.85);
  white-space:nowrap;
}
.rewardItem__desc{
  margin-top:6px;
  color:rgba(230,230,230,0.80);
}
.rewardItem__details{
  margin-top:6px;
  font-size:12px;
  color:rgba(230,230,230,0.66);
  line-height:1.35;
}
.rewardsSectionTitle{
  margin:10px 2px 6px;
  font-weight:700;
  letter-spacing:0.6px;
  color:rgba(240,240,240,0.80);
}


/* Make notes fill available width inside centered card (desktop) */
.card--center .noteGrid{ width:100%; align-self:stretch; }
.card--center .noteCol{ width:100%; }

/* Edit button visibility & contrast */
#btnEdicion{
  border-color: rgba(0,210,255,0.28);
  color: rgb(220,220,230);
}
#btnEdicion.is-active{
  border-color: rgba(114,26,255,0.55);
  box-shadow: 0 0 0 1px rgba(114,26,255,0.20), 0 10px 26px rgba(114,26,255,0.12);
}
#btnEdicion.pill--danger{ /* keep danger class but make it subtle (locked state) */
  background: rgba(0,0,0,0.20);
  border-color: rgba(0,210,255,0.28);
  color: rgba(220,220,230,0.85);
}

/* Locked state visual hints */
body.is-view-locked .pill[data-xp],
body.is-view-locked #btnXpM5,
body.is-view-locked #btnXpM1,
body.is-view-locked #btnXpP1,
body.is-view-locked #btnXpP5,
body.is-view-locked #btnWeekReset,
body.is-view-locked #btnNuevoHeroe,
body.is-view-locked #btnEliminar,
.rewardPickGrid.is-claiming{ opacity:.65; pointer-events:none; }

/* Confirm modal: cleaner + centered */
#confirmModal .modal__card{
  max-width: 420px;
  text-align: center;
}
#confirmModal .modal__header{
  justify-content: center;
}
#confirmModal #confirmMessage{
  font-size: 14px;
  line-height: 1.35;
  opacity: .92;
}
#confirmModal .modal__body > div[style*="justify-content:flex-end"]{
  justify-content: center !important;
}

/* PATCH v16: iPhone header smaller + better hamburger icon alignment */
@media (max-width: 640px){
  /* Reduce overall top padding so the header doesn't feel like a banner */
  .app{
    padding: calc(6px + var(--safe-top)) calc(8px + var(--safe-right)) calc(10px + var(--safe-bottom)) calc(8px + var(--safe-left));
  }

  /* Force compact header (override any later layout overrides) */
  .topbar{
    min-height: 52px !important;
    padding: 4px 8px !important;
    gap: 8px !important;
    border-radius: 18px !important;
    background: rgba(10,12,18,0.88) !important;
    backdrop-filter: blur(8px);
  }

  /* Make icon buttons slightly smaller and perfectly centered */
  .iconbtn{
    width: 38px !important;
    height: 38px !important;
    border-radius: 12px !important;
    display: grid !important;
    place-items: center !important;
  }
  #btnMenu{
    font-size: 22px !important;
    line-height: 1 !important;
    transform: translateY(-1px);
    grid-row: 1 !important;
    align-self: center !important;
  }

  .topbar__trophyBtn{
    width: 38px !important;
    height: 38px !important;
    border-radius: 12px !important;
    grid-row: 1 !important;
    align-self: center !important;
  }
  .trophyIcon{ width: 20px !important; height: 20px !important; }

  /* Smaller logo so it doesn't inflate perceived header height */
  .brand__logo{ width: 36px !important; height: 36px !important; border-radius: 12px !important; }
  .brand__logo svg{ width: 26px !important; height: 26px !important; }
}

@media (min-width: 981px){
  .heroNotesOverlay .noteGrid--overlay{ max-width: 520px; }
}





/* --- Notes toggle button: esquina inferior derecha de la foto --- */
/* Al colapsar: ocultar COMPLETO Descripción/Meta (los dos cuadros) */
.heroScene.notesCollapsed .heroNotesOverlay{
  display: none !important;
}

/* Parallax 2 capas: esconder capa mid si existe */
.heroSceneLayer--mid{ display:none !important; }

/* Quitar el oscurecido extra encima de la imagen (mantener legibilidad con shade suave) */
.heroPhotoFill{
  background: none !important;
}
.heroSceneShade{
  opacity: .50; /* menos oscuro */
}


/* =============================
   Level Up modal (más épico)
   ============================= */

.modal__card--levelup{
  position: relative;
  overflow-x: hidden;
  overflow: hidden;
}

/* Fondo con destellos sutiles (reduce banding percibido) */
.modal__card--levelup::before{
  content:"";
  position:absolute; inset:-2px;
  background:
    radial-gradient(800px 520px at 50% 20%, rgba(0, 200, 255, .10), transparent 62%),
    radial-gradient(700px 520px at 12% 92%, rgba(140, 80, 255, .08), transparent 60%),
    radial-gradient(520px 420px at 86% 86%, rgba(255, 210, 80, .07), transparent 58%),
    radial-gradient(2px 2px at 15% 35%, rgba(255,255,255,.10) 0, rgba(255,255,255,0) 65%),
    radial-gradient(2px 2px at 72% 28%, rgba(255,255,255,.08) 0, rgba(255,255,255,0) 65%),
    radial-gradient(2px 2px at 58% 78%, rgba(255,255,255,.06) 0, rgba(255,255,255,0) 65%);
  filter: blur(0.1px);
  opacity: .95;
  pointer-events:none;
}

.modal__card--levelup::after{
  /* “rays” muy sutiles detrás del badge */
  content:"";
  position:absolute;
  left:50%; top:190px;
  width:520px; height:520px;
  transform: translate(-50%, -50%);
  background: conic-gradient(from 0deg,
    rgba(255, 210, 80, .00) 0deg,
    rgba(255, 210, 80, .12) 10deg,
    rgba(255, 210, 80, .00) 22deg,
    rgba(0, 200, 255, .10) 55deg,
    rgba(0, 200, 255, .00) 74deg,
    rgba(140, 80, 255, .10) 120deg,
    rgba(140, 80, 255, .00) 144deg,
    rgba(255, 255, 255, .06) 180deg,
    rgba(255, 255, 255, .00) 210deg,
    rgba(0, 200, 255, .10) 260deg,
    rgba(0, 200, 255, .00) 310deg);
  filter: blur(8px);
  opacity: .35;
  pointer-events:none;
}

.lvlHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 12px 18px 10px;
  border-bottom: 1px solid rgba(255,255,255,.06);
}

.lvlHeader__left{
  display:flex;
  align-items:center;
  gap: 12px;
  min-width: 0;
}

.lvlBurst{
  width: 38px;
  height: 38px;
  border-radius: 14px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(0, 200, 255, .25);
  box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
  font-size: 18px;
  animation: lvlPulse 1.4s ease-in-out infinite;
}

.lvlHeaderMeta{
  display:flex;
  align-items:baseline;
  gap: 10px;
}

.lvlHeroNameInline{
  color: rgba(255,255,255,.92);
  font-weight: 700;
  font-size: 16px;
  letter-spacing: .01em;
  white-space: nowrap;
  overflow-x: hidden;
  overflow: hidden;
  text-overflow: ellipsis;
}

@keyframes lvlPulse{
  0%,100%{ transform: translateY(0); filter: drop-shadow(0 0 0 rgba(0,200,255,0)); }
  50%{ transform: translateY(-1px); filter: drop-shadow(0 0 12px rgba(0,200,255,.25)); }
}

.modal__card--levelup .modal__body{
  position: relative;
  z-index: 2;
}

.lvlCenter{
  display:flex;
  justify-content:center;
  padding: 10px 0 6px;
}

.lvlBadge{
  width: min(520px, 100%);
  border-radius: 26px;
  padding: 22px 18px;
  text-align:center;
  background: rgba(0,0,0,.22);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow:
    0 18px 60px rgba(0,0,0,.45),
    0 0 0 1px rgba(0,0,0,.35) inset;
  position: relative;
  overflow-x: hidden;
  overflow: hidden;
}

.lvlBadge::before{
  content:"";
  position:absolute; inset:-2px;
  background: radial-gradient(300px 130px at 50% 0%, rgba(255, 210, 80, .22), transparent 62%);
  opacity: .65;
  pointer-events:none;
}

.lvlBadge__label{
  font-size: 14px;
  letter-spacing: .18em;
  text-transform: uppercase;
  color: rgba(255,255,255,.70);
}

.modal__card--levelup .levelUpBig__num{
  font-size: clamp(68px, 11vw, 120px);
  font-weight: 900;
  letter-spacing: .02em;
  margin-top: 6px;
  line-height: 1;
  text-shadow: 0 18px 40px rgba(0,0,0,.55);
  animation: lvlPop .55s cubic-bezier(.2, .8, .2, 1) both;
}

@keyframes lvlPop{
  0%{ transform: translateY(10px) scale(.92); opacity: .0; }
  100%{ transform: translateY(0) scale(1); opacity: 1; }
}

.modal__card--levelup .levelUpPickTitle{
  margin-top: 10px;
  text-align: center;
  font-size: 16px;
  font-weight: 800;
  letter-spacing: .01em;
}

.modal__card--levelup .rewardPickGrid{
  margin-top: 12px;
}


/* Reward card reveal (staggered via inline --d) */
.modal__card--levelup .rewardPick{
  opacity: 0;
  transform: translateY(12px);
}
.modal__card--levelup.lvlAnim .rewardPick{
  opacity: 1;
  transform: translateY(0);
  animation: lvlReveal .42s ease-out forwards;
  animation-delay: var(--d, 0s);
  will-change: transform, opacity;
}


@keyframes lvlReveal{
  to{ transform: translateY(0); opacity: 1; }
}

/* Mejor “tap feel” */
.modal__card--levelup .rewardPick:active{
  transform: translateY(1px) scale(.995);
}

/* Accesibilidad: si el usuario desactiva animaciones */
@media (prefers-reduced-motion: reduce){
  .lvlBurst,
  .modal__card--levelup .levelUpBig__num,
  .modal__card--levelup .rewardPick{
    animation: none !important;
    transform: none !important;
    opacity: 1 !important;
  }
}

/* =========================================================
   LEVEL UP MODAL — CLEAN + PRO (v51)
   - Window: opaque, no background bleed
   - Stage: 2-column "victory screen" (hero + medal)
   - Single source of truth (replaces v41–v50d overrides)
   ========================================================= */

/* Card + body */
#levelUpModal .modal__card--levelup{
  width: min(1040px, calc(100vw - 24px));
  max-width: 1040px;
  max-height: min(92vh, 860px);
  display: flex;
  flex-direction: column;
  border-radius: 22px;
  overflow: hidden;
  background: #0b0d12; /* opaque */
  border: 1px solid rgba(45,220,255,.16);
  box-shadow: 0 28px 90px rgba(0,0,0,.62);
}
#levelUpModal .modal__body--levelup{
  padding: 12px 16px 16px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  overflow: hidden; /* no inner scroll on desktop */
  background: #0b0d12; /* opaque */
}
@media (max-width: 760px){
  #levelUpModal .modal__card--levelup{ max-height: 92vh; }
  #levelUpModal .modal__body--levelup{ overflow: auto; }
}

/* Header */
#levelUpModal .lvlHeader{
  position: relative;
  z-index: 5;
  padding: 10px 12px 12px;
  border-bottom: 1px solid rgba(255,255,255,.06);
  background:
    linear-gradient(90deg, rgba(45,220,255,.16), rgba(125,80,255,.12), rgba(255,195,0,.08));
  justify-content: center;
}
#levelUpModal .lvlHeader__center{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap: 4px;
  min-width: 0;
}
#levelUpModal .lvlHeader__kicker{
  font-size: 12px;
  letter-spacing: .32em;
  text-transform: uppercase;
  opacity: .9;
}
#levelUpModal .lvlHeroNameBig{
  font-size: 34px;
  line-height: 1.05;
  font-weight: 900;
  letter-spacing: .4px;
  text-shadow: 0 16px 28px rgba(0,0,0,.55);
  max-width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
@media (max-width: 560px){
  #levelUpModal .lvlHeroNameBig{ font-size: 26px; }
}

/* Stage (victory screen) */
#levelUpModal .lvlStage{
  height: clamp(240px, 32vh, 300px);
  border-radius: 22px;
  overflow: hidden;
  position: relative;
  display: grid;
  grid-template-columns: 1.25fr .75fr;
  align-items: stretch;
  border: 1px solid rgba(45,220,255,.14);
  background:
    radial-gradient(760px 340px at 70% 30%, rgba(114,26,255,.22), transparent 60%),
    radial-gradient(620px 300px at 25% 75%, rgba(0,210,255,.18), transparent 60%),
    linear-gradient(180deg, rgba(14,16,20,1), rgba(10,12,16,1));
  box-shadow: 0 18px 60px rgba(0,0,0,.55);
}

#levelUpModal .lvlParticles{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:0;
  background:
    radial-gradient(420px 240px at 30% 65%, rgba(255,255,255,.06), transparent 62%),
    radial-gradient(520px 300px at 70% 35%, rgba(45,220,255,.10), transparent 62%);
  mix-blend-mode: screen;
  opacity:.85;
}

#levelUpModal .lvlStage::before{
  content:"";
  position:absolute;
  inset:-140px -220px;
  background:
    repeating-conic-gradient(from 210deg,
      rgba(255,255,255,.06) 0 7deg,
      rgba(255,255,255,0) 7deg 15deg);
  opacity:.34;
  filter: blur(2px);
  transform: rotate(-10deg);
  pointer-events:none;
  animation: lvlBurstSpin 12s linear infinite;
  transform-origin: center;
}
#levelUpModal .lvlStage::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(520px 320px at 60% 45%, rgba(255,223,120,.10), transparent 62%),
    radial-gradient(620px 360px at 55% 55%, rgba(45,220,255,.10), transparent 68%);
  opacity: .95;
  pointer-events:none;
  animation: lvlBurstPulse 2.8s ease-in-out infinite;
}
@keyframes lvlBurstSpin{ 0%{ transform: rotate(-10deg);} 100%{ transform: rotate(350deg);} }
@keyframes lvlBurstPulse{ 0%,100%{ opacity: .82;} 50%{ opacity: 1;} }

/* Left: hero */
#levelUpModal .lvlHeroPanel{
  position: relative;
  overflow: hidden;
  background:
    radial-gradient(520px 360px at 35% 45%, rgba(255,255,255,.06), transparent 62%),
    linear-gradient(90deg, rgba(0,0,0,.55), rgba(0,0,0,.10) 62%, rgba(0,0,0,0));

  grid-column: 1;
  grid-row: 1;
  z-index: 1;
}
#levelUpModal .lvlHeroArt{
  position:absolute;
  inset:0;
  overflow:hidden;
  transform: translateZ(0);
  z-index: 1;
}

/* Parallax layers */
#levelUpModal .lvlHeroLayer{
  position:absolute;
  inset:0;
  background-repeat:no-repeat;
  background-size: cover;
  pointer-events:none;
  transform: translateZ(0);
}
#levelUpModal .lvlHeroBg{
  background-position: 55% 30%;
  filter: blur(0px) saturate(1.05);
  z-index: 0;
}
#levelUpModal .lvlHeroFg{
  inset: -40px -22px -80px -22px;
  background-position: 48% 18%;
  z-index: 2;
  filter: drop-shadow(0 18px 26px rgba(0,0,0,.55));
  will-change: transform;
}

/* "Bailar" (subtle bob + sway) */
#levelUpModal .lvlHeroFg.has-art{
  animation: lvlFloat 2.6s ease-in-out infinite;
}
@keyframes lvlFloat{
  0%,100%{ transform: translateY(4px) rotate(-0.25deg); }
  50%{ transform: translateY(-6px) rotate(0.25deg); }
}
@media (prefers-reduced-motion: reduce){
  #levelUpModal .lvlHeroFg.has-art{ animation:none !important; transform:none !important; }
}

/* =========================================================
   MOBILE SAFARI FIXES (iPhone)
   - Fichas: anclar FG al piso (evitar que "suba" y se corte abajo)
   - LevelUp: en móvil ocultar arte y mostrar solo medalla + recompensas
   ========================================================= */

@media (max-width: 560px){
  /* (heroScene rules consolidated — see "Responsive hero scene" section below) */

  /* --- LevelUp: móvil compacto (sin arte) --- */
  #levelUpModal .lvlStage{
    grid-template-columns: 1fr;
    height: auto;
    padding: 14px 12px;
  }
  #levelUpModal .lvlHeroPanel{ display:none; }
  #levelUpModal .lvlBadgeWrap{
    grid-column: 1;
    padding: 8px;
  }
  #levelUpModal .lvlBadgeWrap::before{ inset: 10px; }
  #levelUpModal .lvlBadge{
  width: 196px;
  height: 196px;
  border-radius: 999px;
  position: relative;
  display: grid;
  place-items: center;
  background: radial-gradient(circle at 35% 30%, rgba(255,255,255,.10), rgba(255,255,255,.03) 42%, rgba(0,0,0,.0) 70%);
  border: 1px solid rgba(45,220,255,.18);
  box-shadow: 0 18px 52px rgba(0,0,0,.55);
}

  #levelUpModal .lvlHeroNameBig{ font-size: 28px; }
}


/* Soft shade to keep text readable */
#levelUpModal .lvlHeroShade{
  position:absolute;
  inset:0;
  background: linear-gradient(180deg, rgba(0,0,0,.08) 0%, rgba(0,0,0,.55) 78%, rgba(0,0,0,.70) 100%);
  pointer-events:none;
  z-index: 3;
}

/* Diagonal cut divider */
#levelUpModal .lvlHeroCut{
  width: 92px;
  background: linear-gradient(180deg, rgba(45,220,255,.18), rgba(15,16,18,0));
  opacity: .95;

  position:absolute;
  top:0; right:0; height:100%;
  pointer-events:none;
}

/* Right: badge wrap */
#levelUpModal .lvlBadgeWrap{
  position: relative;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 16px;

  grid-column: 2;
  grid-row: 1;
  z-index: 2;
}
#levelUpModal .lvlBadgeWrap::before{
  content:"";
  position:absolute;
  inset: 14px 18px;
  border-radius: 22px;
  background: linear-gradient(135deg, rgba(255,255,255,.05), rgba(255,255,255,.00));
  border: 1px solid rgba(255,255,255,.06);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.25);
  pointer-events:none;
  opacity:.95;
}

/* Circular medal */
#levelUpModal .lvlBadge{
  width: 196px;
  height: 196px;
  border-radius: 999px;
  display:flex;
  flex-direction: column;
  align-items:center;
  justify-content:center;
  gap: 8px;
  position: relative;
  background: radial-gradient(circle at 35% 30%, rgba(255,255,255,.10), rgba(255,255,255,.03) 42%, rgba(0,0,0,.0) 70%);
  border: 1px solid rgba(45,220,255,.18);
  box-shadow: 0 18px 52px rgba(0,0,0,.55);
}
#levelUpModal .lvlBadge::before{
  content:"";
  position:absolute;
  inset:-10px;
  border-radius:999px;
  background: conic-gradient(from 120deg, rgba(45,220,255,.0), rgba(45,220,255,.22), rgba(255,195,0,.12), rgba(125,80,255,.18), rgba(45,220,255,.0));
  filter: blur(1px);
  opacity:.9;
  animation: lvlRingSpin 5.4s linear infinite;
  pointer-events:none;
}
#levelUpModal .lvlBadge::after{
  content:"";
  position:absolute;
  inset:-18px;
  border-radius:999px;
  background: radial-gradient(circle, rgba(45,220,255,.16), rgba(45,220,255,0) 62%);
  opacity:.85;
  animation: lvlAuraPulse 2.2s ease-in-out infinite;
  pointer-events:none;
}
@keyframes lvlRingSpin{ to{ transform: rotate(360deg);} }
@keyframes lvlAuraPulse{ 0%,100%{ transform: scale(.98); opacity:.7;} 50%{ transform: scale(1.02); opacity: 1;} }

#levelUpModal .lvlBadgeLabel{
  z-index: 3;

  position: absolute;
  top: 26px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  font-weight: 900;
  letter-spacing: .34em;
  opacity: 1;
  text-shadow: 0 10px 22px rgba(0,0,0,.7);
}

#levelUpModal .lvlBadgeNumber{
  z-index: 3;

  position: relative;
  font-size: 112px;
  line-height: 0.95;
  letter-spacing: -0.04em;
  text-shadow:
    0 22px 52px rgba(0,0,0,.55),
    0 0 26px rgba(45,220,255,.10);
  display:flex;
  align-items:center;
  justify-content:center;
  width: 100%;
}


/* Reward title + cards */
#levelUpModal .levelUpPickTitle{
  margin-top: 6px;
  text-align:center;
  font-size: 18px;
  font-weight: 900;
  letter-spacing: .10em;
  text-transform: uppercase;
  opacity: .95;
}
#levelUpModal .rewardPickGrid{
  margin-top: 8px;
  position: relative;
  z-index: 5;
}
#levelUpModal .rewardPick{
  border-radius: 16px;
  overflow: hidden;
}
#levelUpModal .rewardPick::after{
  content:"";
  position:absolute;
  inset:0;
  border: 1px solid rgba(255,255,255,.07);
  border-radius: 16px;
  pointer-events:none;
}

/* Modal animation polish */
#levelUpModal .lvlAnim .lvlHeroPanel{ animation: lvlSlideIn .55s cubic-bezier(.2,.8,.2,1) both; }
#levelUpModal .lvlAnim .lvlBadge{ animation: lvlPop .62s cubic-bezier(.2,.9,.2,1) both; }
#levelUpModal .lvlAnim .levelUpPickTitle{ animation: lvlRise .45s ease-out both; animation-delay: .12s; }
@keyframes lvlSlideIn{ from{ opacity:0; transform: translateX(-26px);} to{ opacity:1; transform: translateX(0);} }
@keyframes lvlPop{ 0%{ opacity:0; transform: translateY(10px) scale(.86);} 60%{ opacity:1; transform: translateY(0) scale(1.06);} 100%{ opacity:1; transform: translateY(0) scale(1);} }
@keyframes lvlRise{ from{ opacity:0; transform: translateY(14px);} to{ opacity:1; transform: translateY(0);} }

/* Responsiveness */
@media (max-width: 900px){
  #levelUpModal .lvlStage{ grid-template-columns: 1.15fr .85fr; }
  #levelUpModal .lvlBadge{ width: 176px; height: 176px; }
  #levelUpModal .lvlBadgeNumber{ font-size: 96px; }
}
@media (max-width: 560px){
  #levelUpModal .lvlStage{ height: 240px; grid-template-columns: 1fr; }
  #levelUpModal .lvlHeroCut{ display:none; }
  #levelUpModal .lvlBadgeWrap{ position:absolute; right: 10px; bottom: 10px; padding: 0; }
  #levelUpModal .lvlBadgeWrap::before{ display:none; }
  #levelUpModal .lvlBadge{ width: 150px; height: 150px; }
  #levelUpModal .lvlBadgeNumber{ font-size: 78px; }
}

/* --- Mobile framing fixes (iPhone): keep FG aligned to bottom --- */
@media (max-width: 560px){
  /* (heroScene FG rules consolidated — see "Responsive hero scene" section below) */
  /* LevelUp modal: ensure FG is visible + bottom-aligned */
  #levelUpModal .lvlHeroFg{
    background-position: 50% 100% !important;
    background-size: contain !important;
  }
  #levelUpModal .lvlHeroBg{
    background-position: 55% 35% !important;
  }
  /* Make the stage feel "present" on mobile and keep the badge readable */
  #levelUpModal .lvlStage{
    height: 300px !important; /* taller than default 240 */
  }
  #levelUpModal .lvlBadgeWrap{
    left: 50% !important;
    right: auto !important;
    bottom: 10px !important;
    transform: translateX(-50%) !important;
  }
}




/* --- Hard hide for elements using the HTML `hidden` attribute (author CSS must not override) --- */
[hidden]{ display:none !important; }



/* =========================================================
   MOBILE HOTFIX (iPhone): Hero FG bottom + LevelUp compact
   ========================================================= */
@media (max-width: 560px){
  /* (heroScene FG rules consolidated — see "Responsive hero scene" section below) */

  /* --- Level Up modal: modo compacto (sin fotos) --- */
  #levelUpModal .lvlStage{
    grid-template-columns: 1fr !important;
    height: auto !important;
    min-height: 160px;
  }
  #levelUpModal .lvlHeroPanel{ display:none !important; }
  #levelUpModal .lvlBadgeWrap{
    grid-column: 1 !important;
    grid-row: 1 !important;
    justify-content: center !important;
    align-items: center !important;
    padding: 18px 14px !important;
  }

  /* Asegura scroll en el cuerpo del modal */
  #levelUpModal .modal__body{
    overflow: auto !important;
    -webkit-overflow-scrolling: touch;
    max-height: calc(100svh - 140px);
  }
}



/* =========================================================
   FINAL iPhone tuning (v50.10): hero card framing + LevelUp centering
   ========================================================= */
@media (max-width: 560px){
  /* (heroScene rules consolidated — see "Responsive hero scene" section below) */

  /* Modal Level Up: centrar mejor el header */
  #levelUpModal .lvlHeader{
    justify-content: center !important;
    text-align: center !important;
    padding: 14px 12px 12px !important;
  }
  #levelUpModal .lvlHeader__center{
    width: 100% !important;
    text-align: center !important;
    margin: 0 auto !important;
  }
  #levelUpModal .lvlHeader__kicker{
    letter-spacing: 5px !important;
    opacity: .9 !important;
  }
  #levelUpModal .lvlHeroNameBig{
    margin-top: 2px !important;
    line-height: 1.05 !important;
  }

  /* Modal Level Up: stage y medalla centrados, menos “aplastados” */
  #levelUpModal .lvlStage{
    padding: 14px 12px 8px !important;
  }
  #levelUpModal .lvlBadgeWrap{
    padding: 16px 12px !important;
  }
}


/* === LevelUp modal: fixed stage + scroll rewards, centered badge, subtle glint === */
#levelUpModal .modal__body--levelup{
  display:flex;
  flex-direction:column;
  gap: 12px;
}

/* Keep the stage (badge/scene) steady; rewards scroll independently */
#levelUpModal .lvlStage{ flex: 0 0 auto; }
#levelUpModal .levelUpScrollArea{
  flex: 1 1 auto;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 12px;
}

/* Title size (less shouty) */
#levelUpModal .levelUpPickTitle{
  font-size: 16px;
  letter-spacing: .08em;
}

/* Use the dedicated badge classes (label + number) */
#levelUpModal .lvlBadge{
  padding-top: 10px;
  gap: 6px;
}
#levelUpModal .lvlBadgeLabel{
  font-size: 13px;
  font-weight: 950;
  letter-spacing: .38em;
  text-transform: uppercase;
  opacity: .95;
  transform: translateY(6px);
}
#levelUpModal .lvlBadgeNumber{
  display:flex;
  align-items:center;
  justify-content:center;
  width: 100%;
  line-height: .92;
  transform: translateY(2px);
}

/* Micro shine sweep on the medal */
#levelUpModal .lvlBadgeGlint{
  z-index: 2;

  position:absolute;
  inset: -18px;
  border-radius: 999px;
  pointer-events:none;
  background: linear-gradient(115deg,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,.10) 18%,
    rgba(0,210,255,.18) 28%,
    rgba(255,255,255,.06) 40%,
    rgba(255,255,255,0) 55%);
  transform: translateX(-140%) rotate(12deg);
  opacity: .28;
  mix-blend-mode: screen;
  filter: blur(.2px);
  animation: lvlGlintSweep 5.6s ease-in-out infinite;
}
@keyframes lvlGlintSweep{
  0%,55%{ transform: translateX(-140%) rotate(12deg); opacity: 0; }
  62%{ opacity: .22; }
  78%{ opacity: .30; }
  100%{ transform: translateX(140%) rotate(12deg); opacity: 0; }
}

@media (max-width: 560px){
  #levelUpModal .levelUpPickTitle{ font-size: 15px; }
  #levelUpModal .modal__card--levelup{ max-height: 92svh; }
  #levelUpModal .modal__body--levelup{ max-height: calc(92svh - 96px); } /* header space */
}



/* === Mobile/Modal polish overrides (v50 patch) === */

#levelUpModal .lvlBadgeWrap{display:flex;align-items:center;justify-content:center;flex-direction:column;padding:0;}
#levelUpModal .lvlBadge{display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;}
#levelUpModal .lvlBadgeLabel{position:static;transform:none;margin:0 0 10px 0;font-weight:800;letter-spacing:6px;opacity:.9;}
#levelUpModal .lvlBadgeNum{margin:0;line-height:1;}
#levelUpModal #levelUpTitle{font-size:22px;letter-spacing:3px;}
@media (min-width: 900px){
  #levelUpModal .lvlHeader{padding:16px 22px 14px;}
  #levelUpModal .lvlHeaderName{font-size:40px;}
  #levelUpModal .lvlHeaderKicker{font-size:12px;}
}

/* Medal micro-glint */
.rewardPick--medal .rewardPick__icon{position:relative;overflow:hidden;}
.rewardPick--medal .rewardPick__icon::after{content:'';position:absolute;top:-20%;left:-60%;width:40%;height:140%;transform:skewX(-20deg);background:linear-gradient(90deg, transparent, rgba(255,255,255,.55), transparent);opacity:.0;animation:medalGlint 2.6s ease-in-out infinite;}
@keyframes medalGlint{0%,55%{left:-60%;opacity:0;}60%{opacity:.0;}65%{opacity:.55;}75%{left:140%;opacity:0;}100%{left:140%;opacity:0;}}

/* === v50_mobilefix6_overrides === */


/* Level Up modal: tighter header + centered badge */
#levelUpModal .lvlHeader{
  padding: 14px 16px;
}
#levelUpModal .lvlHeaderInner{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:6px;
}
#levelUpModal .lvlTitle{
  text-align:center;
}
#levelUpModal .lvlName{
  text-align:center;
}

#levelUpModal .lvlBadgeWrap{
  display:flex;
  align-items:center;
  justify-content:center;
}
#levelUpModal .lvlBadge{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  position:relative;
}
#levelUpModal .lvlBadgeLabel{
  position:static !important;
  transform:none !important;
  margin:0 0 10px 0;
  font-weight:800;
  letter-spacing:0.28em;
  opacity:.92;
}
#levelUpModal .lvlBadgeNumber{
  line-height:1;
  margin:0;
}

/* Smaller section title */
#levelUpModal #levelUpTitle{
  font-size: 1.05rem;
  letter-spacing: 0.20em;
}

/* Medal micro shimmer */
.rewardPick--medal .rewardPick__icon{
  position:relative;
  overflow:hidden;
}
.rewardPick--medal .rewardPick__icon::after{
  content:"";
  position:absolute;
  inset:-60% -120%;
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.55) 45%, rgba(255,255,255,0) 70%);
  transform: translateX(-60%) rotate(25deg);
  animation: medalSweep 3.3s ease-in-out infinite;
  opacity: .65;
  pointer-events:none;
  mix-blend-mode: screen;
}
@keyframes medalSweep{
  0%{ transform: translateX(-80%) rotate(25deg); opacity:0; }
  18%{ opacity:.65; }
  45%{ transform: translateX(80%) rotate(25deg); opacity:0; }
  100%{ transform: translateX(80%) rotate(25deg); opacity:0; }
}

/* =========================================================
   RESPONSIVE HERO SCENE (consolidated)
   Replaces the old scattered hotfix blocks.
   Cascade: base → ≥981 (desktop) → ≤980 (tablet) → ≤640 (mobile) → ≤430 (phone, in styles.mobile.css)
   ========================================================= */

/* Mobile (≤640px): single column, use explicit height for predictable sizing */
@media (max-width: 640px){
  .heroScene{
    height: max(380px, 58vh);
    min-height: 0;            /* let height control */
    max-height: 74vh;
  }

  /* FG: contain to show full character, anchored at bottom */
  .heroSceneLayer--fg{
    inset: 0;
    background-size: contain;
    background-position: 50% 100%;
  }

  /* BG: cover the full scene */
  .heroSceneLayer--bg{
    inset: 0;
    background-size: cover;
    background-position: center;
  }
}

/* Small phones (≤560px) */
@media (max-width: 560px){
  .heroScene{
    height: max(360px, 55vh);
    max-height: 70vh;
  }
}

/* Desktop: slightly reduce header height */
@media (min-width: 901px){
  #levelUpModal .lvlHeader{
    padding: 12px 18px;
  }
}

/* --- Patch: remove NIVEL label and center badge --- */
.lvlBadgeLabel { display: none !important; }
.lvlBadge { padding-top: 0 !important; }
.lvlBadgeCircle { display:flex !important; align-items:center !important; justify-content:center !important; }
.lvlBadgeNumber { position: relative !important; top: 0 !important; left: 0 !important; transform: none !important; }

/* === v50: LevelUp cinematic (opción 2) === */

/* Hide redundant NIVEL label everywhere */
#levelUpModal .lvlBadgeLabel{ display:none !important; }

/* Perfect centering for the badge and number */
#levelUpModal .lvlBadgeWrap{ display:grid; place-items:center; padding:0 !important; }
#levelUpModal .lvlBadge{
  display:grid !important;
  place-items:center !important;
}
#levelUpModal .lvlBadgeNumber{
  display:flex !important;
  align-items:center !important;
  justify-content:center !important;
  line-height:1 !important;
  transform: translateY(1px);
}

/* Remove bottom hint text (redundant) */
#levelUpModal .lvlFooter{ display:none !important; }

/* Reduce header height a bit so the stage has more protagonism */
#levelUpModal .modal__header--levelup{ padding: 14px 18px !important; }
#levelUpModal .modal__headerTitle--levelup{ font-size: 34px !important; }

/* Cinematic: show the level first (badge in foreground), then reveal rewards */
#levelUpModal .lvlHeroPanel,
#levelUpModal .lvlBadgeWrap,
#levelUpModal .lvlRewardTitle,
#levelUpModal .lvlRewardArea{ transition: opacity .45s ease, transform .45s ease, filter .45s ease; }

#levelUpModal.is-cine:not(.cine-done) .lvlHeroPanel{
  opacity: 0.25;
  filter: blur(3px) saturate(.85);
}
#levelUpModal.is-cine:not(.cine-done) .lvlBadgeWrap{
  grid-column: 1 / -1;
  transform: scale(1.15);
  opacity: 1;
}
#levelUpModal.is-cine:not(.cine-done) .lvlRewardTitle,
#levelUpModal.is-cine:not(.cine-done) .lvlRewardArea{
  opacity: 0;
  transform: translateY(14px);
  pointer-events: none;
}
#levelUpModal.cine-done .lvlBadgeWrap{
  transform: scale(1);
}
#levelUpModal.cine-done .lvlHeroPanel{
  opacity: 1;
  filter: none;
}
#levelUpModal.cine-done .lvlRewardTitle,
#levelUpModal.cine-done .lvlRewardArea{
  opacity: 1;
  transform: none;
  pointer-events: auto;
}

/* Make title slightly smaller */
#levelUpModal .lvlRewardTitle{ font-size: 15px !important; letter-spacing: .12em; }


/* === v50: LevelUp cinematic (opción 2) === */

/* Hide redundant NIVEL label everywhere */
#levelUpModal .lvlBadgeLabel{ display:none !important; }

/* Perfect centering for the badge and number */
#levelUpModal .lvlBadgeWrap{ display:grid; place-items:center; padding:0 !important; }
#levelUpModal .lvlBadge{
  display:grid !important;
  place-items:center !important;
}
#levelUpModal .lvlBadgeNumber{
  display:flex;
  align-items:center;
  justify-content:center;
  line-height:1;
  width:100%;
}

/* Remove bottom hint text (not needed) */
#levelUpModal .lvlFooter{ display:none !important; }

/* Smooth transitions */
#levelUpModal .lvlHeroPanel,
#levelUpModal .lvlBadgeWrap,
#levelUpModal .lvlRewardArea{
  transition: opacity .45s ease, transform .45s ease, filter .45s ease;
}

/* Cinematic: first show the level in foreground, then reveal rewards */
#levelUpModal.is-cine .lvlStage{ position:relative; overflow:hidden; }

#levelUpModal.is-cine:not(.cine-done) .lvlHeroPanel{
  opacity:0.35;
  filter: blur(3px) saturate(.85);
  transform: scale(1.01);
}

#levelUpModal.is-cine:not(.cine-done) .lvlBadgeWrap{
  grid-column:1 / -1;
  justify-self:center;
  align-self:center;
  transform: scale(1.12);
  z-index:3;
}

#levelUpModal.is-cine:not(.cine-done) .lvlRewardArea{
  opacity:0;
  transform: translateY(14px);
  pointer-events:none;
}

#levelUpModal.is-cine.cine-done .lvlBadgeWrap{
  transform: none;
}

#levelUpModal.is-cine.cine-done .lvlHeroPanel{
  opacity:1;
  filter:none;
  transform:none;
}

#levelUpModal.is-cine.cine-done .lvlRewardArea{
  opacity:1;
  transform:none;
  pointer-events:auto;
}

/* Reduce dead space in the header */
#levelUpModal .modal__cardHeader{ padding: 14px 16px 12px !important; }
#levelUpModal .lvlTitle{ margin-top: 0 !important; }

/* On very small screens, keep the badge section compact and let rewards scroll */
@media (max-width: 520px){
  #levelUpModal .lvlStage{ min-height: 240px !important; }
  #levelUpModal .lvlRewardTitle{ font-size: 18px !important; letter-spacing: 0.08em !important; }
  #levelUpModal .lvlRewardArea{ max-height: 52vh !important; overflow:auto !important; }
}

/* === v50: LevelUp cinematic (opción 2) === */

/* Hide redundant NIVEL label everywhere */
#levelUpModal .lvlBadgeLabel{ display:none !important; }

/* Perfect centering for the badge and number */
#levelUpModal .lvlBadgeWrap{ display:grid; place-items:center; padding:0 !important; }
#levelUpModal .lvlBadge{
  display:grid !important;
  place-items:center !important;
}
#levelUpModal .lvlBadgeNumber{
  display:flex;
  align-items:center;
  justify-content:center;
  line-height:1;
  margin:0;
  padding:0;
}

/* Remove tiny helper line at bottom (not needed) */
#levelUpModal .lvlFooter,
#levelUpModal .lvlPendingHint{ display:none !important; }

/* Make reward title a bit smaller */
#levelUpModal .lvlRewardTitle{ font-size:16px !important; letter-spacing:0.12em; }

/* Make rewards area the only scrollable part */
#levelUpModal .lvlRewardArea{
  max-height: min(48vh, 420px);
  overflow:auto;
  -webkit-overflow-scrolling: touch;
}

@media (max-width: 720px){
  #levelUpModal .lvlRewardArea{
    max-height: calc(100vh - 380px);
  }
}

/* Cinematic: show the level first, then reveal rewards */
#levelUpModal .lvlHeroPanel,
#levelUpModal .lvlBadgeWrap,
#levelUpModal .lvlRewardArea{
  transition: opacity .45s ease, transform .45s ease, filter .45s ease;
}

#levelUpModal.is-cine:not(.cine-done) .lvlStage{
  grid-template-columns: 1fr !important;
}

#levelUpModal.is-cine:not(.cine-done) .lvlStageHero{ display:none !important; }

#levelUpModal.is-cine:not(.cine-done) .lvlHeroPanel{
  opacity: .28;
  filter: blur(4px) saturate(.85);
}

#levelUpModal.is-cine:not(.cine-done) .lvlBadgeWrap{
  grid-column: 1 / -1;
  transform: scale(1.15);
  z-index: 3;
}

#levelUpModal.is-cine:not(.cine-done) .lvlRewardArea{
  opacity: 0;
  transform: translateY(18px);
  pointer-events: none;
}

#levelUpModal.cine-done .lvlRewardArea{
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}
#levelUpModal .lvlBadgeNumber{
  display:flex !important;
  align-items:center !important;
  justify-content:center !important;
  line-height: 1 !important;
  margin:0 !important;
}
#levelUpModal .lvlStageBadge{ display:grid; place-items:center; }

/* Reduce title size a bit */
#levelUpModal .lvlRewardTitle{ font-size: 16px !important; letter-spacing: 0.12em; }

/* Remove bottom helper text in the modal */
#levelUpModal .lvlFooter{ display:none !important; }

/* Make only rewards scroll (badge stays fixed) */
#levelUpModal .lvlRewardArea{ max-height: min(48vh, 420px); overflow:auto; }

#levelUpModal .lvlHeroPanel,
#levelUpModal .lvlBadgeWrap,
#levelUpModal .lvlRewardArea{
  transition: opacity .45s ease, transform .45s ease, filter .45s ease;
}

/* Cinematic sequence: show big level first */
#levelUpModal.is-cine:not(.cine-done) .lvlStage{
  grid-template-columns: 1fr !important;
}
#levelUpModal.is-cine:not(.cine-done) .lvlStageHero{ display:none !important; }
#levelUpModal.is-cine:not(.cine-done) .lvlHeroPanel{
  opacity: 0.22;
  filter: blur(4px) saturate(0.8);
}
#levelUpModal.is-cine:not(.cine-done) .lvlBadgeWrap{
  grid-column: 1 / -1;
  transform: scale(1.15);
  z-index: 3;
}
#levelUpModal.is-cine:not(.cine-done) .lvlRewardArea{
  opacity: 0;
  transform: translateY(18px);
  pointer-events: none;
}
#levelUpModal.is-cine.cine-done .lvlBadgeWrap{
  transform: none;
}
#levelUpModal.is-cine.cine-done .lvlHeroPanel{
  opacity: 1;
  filter: none;
}
#levelUpModal.is-cine.cine-done .lvlRewardArea{
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

@media (max-width: 720px){
  #levelUpModal .lvlRewardArea{ max-height: calc(100vh - 360px); }
}

/* =========================================================
   LEVEL UP MODAL — Cinematic BG-only (v2)
   - Sin header superior
   - BG del parallax como fondo
   - Número centrado con look 3D
   - Vignette oscura + rays
   - Rewards con scroll (especialmente en móvil)
   ========================================================= */

#levelUpModal .lvlHeader{display:none !important;}

#levelUpModal .lvlStage{
  position: relative;
  overflow: hidden;
  border-radius: 18px;
  padding: 18px 18px 22px;
  min-height: 250px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

#levelUpModal .lvlStageBg{
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  transform: scale(1.03);
  filter: saturate(1.05) contrast(1.05);
}

#levelUpModal .lvlStageVignette{
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 50% 45%, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.65) 55%, rgba(0,0,0,0.88) 100%),
    linear-gradient(180deg, rgba(0,0,0,0.55) 0%, rgba(0,0,0,0.35) 35%, rgba(0,0,0,0.75) 100%);
  opacity: 1;
}

#levelUpModal .lvlStageRays{
  position: absolute;
  left: 50%;
  top: 50%;
  width: 140vmax;
  height: 140vmax;
  transform: translate(-50%, -50%) rotate(0deg);
  opacity: 0.22;
  filter: blur(1px);
  background:
    conic-gradient(from 0deg,
      rgba(255,255,255,0.00) 0deg,
      rgba(255,255,255,0.13) 16deg,
      rgba(255,255,255,0.00) 34deg,
      rgba(255,255,255,0.10) 52deg,
      rgba(255,255,255,0.00) 70deg,
      rgba(255,255,255,0.12) 92deg,
      rgba(255,255,255,0.00) 110deg,
      rgba(255,255,255,0.10) 136deg,
      rgba(255,255,255,0.00) 160deg,
      rgba(255,255,255,0.14) 182deg,
      rgba(255,255,255,0.00) 210deg,
      rgba(255,255,255,0.10) 236deg,
      rgba(255,255,255,0.00) 260deg,
      rgba(255,255,255,0.12) 286deg,
      rgba(255,255,255,0.00) 310deg,
      rgba(255,255,255,0.13) 336deg,
      rgba(255,255,255,0.00) 360deg);
  animation: lvlRaysSpin 10s linear infinite;
}

@keyframes lvlRaysSpin{
  0%{transform: translate3d(-50%,-50%,0) rotate(0deg);} 
  100%{transform: translate3d(-50%,-50%,0) rotate(360deg);} 
}
#levelUpModal .lvlStageText{
  position: relative;
  z-index: 2;
  text-align: center;
  max-width: 560px;
}

#levelUpModal .lvlStageName{
  font-weight: 800;
  line-height: 1.05;
  letter-spacing: -0.02em;
  font-size: clamp(20px, 4.6vw, 38px);
  text-shadow: 0 8px 22px rgba(0,0,0,0.55);
}

#levelUpModal .lvlStageCongrats{
  margin-top: 6px;
  font-weight: 650;
  opacity: 0.9;
  font-size: clamp(13px, 2.7vw, 18px);
  text-shadow: 0 8px 22px rgba(0,0,0,0.55);
}

#levelUpModal .lvlBadgeWrap{
  position: relative;
  z-index: 2;
  width: min(58vw, 330px);
  aspect-ratio: 1 / 1;
  display: grid;
  place-items: center;
  margin-top: 4px;
}

#levelUpModal .lvlBadgeCircle{
  position: absolute;
  inset: 0;
  border-radius: 999px;
  background: radial-gradient(circle at 30% 28%, rgba(255,255,255,0.14) 0%, rgba(255,255,255,0.06) 35%, rgba(0,0,0,0.00) 70%),
              radial-gradient(circle at 55% 60%, rgba(80,180,255,0.20) 0%, rgba(80,180,255,0.00) 55%),
              linear-gradient(135deg, rgba(92,120,255,0.25) 0%, rgba(20,18,40,0.25) 50%, rgba(255,190,80,0.10) 100%);
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow:
    0 18px 46px rgba(0,0,0,0.62),
    inset 0 0 0 2px rgba(255,255,255,0.06),
    inset 0 -24px 60px rgba(0,0,0,0.35);
}

#levelUpModal .lvlBadgeNumber{
  font-weight: 900;
  letter-spacing: -0.04em;
  font-size: clamp(68px, 12vw, 142px);
  color: #eef6ff;
  line-height: 1;
  transform: translateZ(0);
  text-shadow:
    0 2px 0 rgba(0,0,0,0.45),
    0 10px 28px rgba(0,0,0,0.70),
    0 0 18px rgba(120,200,255,0.18);
  filter: drop-shadow(0 22px 34px rgba(0,0,0,0.55));
}

/* Cinemática: el número entra primero y se queda un poco más */
#levelUpModal.is-cine .lvlBadgeWrap{
  transform: scale(0.75);
  opacity: 0;
  filter: none;
}
#levelUpModal.is-cine.cine-done .lvlBadgeWrap{
  transform: scale(1);
  opacity: 1;
  filter: blur(0);
  transition: transform 820ms cubic-bezier(.16,1,.3,1), opacity 820ms, filter 820ms;
}

#levelUpModal.is-cine .lvlStageRays{opacity: 0.0;}
#levelUpModal.is-cine.cine-done .lvlStageRays{opacity: 0.22; transition: opacity 900ms;}

/* Título de recompensas más pequeño */
#levelUpModal .lvlTitle{
  font-size: clamp(16px, 3.8vw, 22px) !important;
  letter-spacing: 0.12em;
}

/* Scroll SOLO en recompensas (modal completo fijo) */
#levelUpModal .lvlRewards{
  max-height: 44vh;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}

@media (max-width: 720px){
  #levelUpModal .lvlModalContent{
    max-height: min(90vh, 820px);
  }
  #levelUpModal .lvlStage{
    min-height: 220px;
    padding: 16px 14px 18px;
  }
  #levelUpModal .lvlRewards{max-height: 42vh;}
}

/* Micro brillo en la medalla/iconos (sutil) */
#levelUpModal .rewardCardIcon{
  position: relative;
  overflow: hidden;
}
#levelUpModal .rewardCardIcon::after{
  content: "";
  position: absolute;
  inset: -30%;
  background: linear-gradient(120deg, rgba(255,255,255,0) 35%, rgba(255,255,255,0.18) 50%, rgba(255,255,255,0) 65%);
  transform: translateX(-120%) rotate(12deg);
  opacity: 0.7;
  animation: lvlIconShine 5.8s ease-in-out infinite;
  pointer-events: none;
}
@keyframes lvlIconShine{
  0%, 55%{transform: translateX(-120%) rotate(12deg); opacity: 0.0;}
  60%{opacity: 0.75;}
  72%{transform: translateX(120%) rotate(12deg); opacity: 0.0;}
  100%{transform: translateX(120%) rotate(12deg); opacity: 0.0;}
}


/* ===== LevelUp Modal: final layout + crisp number ===== */
#levelUpModal .lvlStage{
  --lvlPad: 18px;
  --lvlHeroH: clamp(220px, 44vh, 340px);
  display: grid;
  grid-template-rows: var(--lvlHeroH) auto;
  gap: 14px;
  padding: var(--lvlPad);
  align-content: start;
  justify-items: stretch;
}

/* Darken rewards area so hero stays dramatic */
#levelUpModal .lvlStage::after{
  content: "";
  position: absolute;
  left: 0; right: 0; bottom: 0;
  top: calc(var(--lvlPad) + var(--lvlHeroH) - 6px);
  background: linear-gradient(180deg, rgba(0,0,0,0.05), rgba(0,0,0,0.75) 30%, rgba(0,0,0,0.88) 100%);
  z-index: 1;
  border-radius: inherit;
  pointer-events: none;
}

/* Place hero text + number inside hero row, independent of rewards */
#levelUpModal .lvlStageText{
  grid-row: 1;
  align-self: start;
  justify-self: center;
  margin-top: 10px;
}
#levelUpModal .lvlBadgeWrap{
  grid-row: 1;
  align-self: center;
  justify-self: center;
}
#levelUpModal .lvlTitle{
  grid-row: 2;
  margin-top: 0;
}
#levelUpModal .lvlRewards{
  grid-row: 2;
}

/* Keep BG + vignette + rays focused, but not affecting layout */
#levelUpModal .lvlStageBg,
#levelUpModal .lvlVignette,
#levelUpModal .lvlRays{
  inset: var(--lvlPad);
  height: var(--lvlHeroH);
  bottom: auto;
  border-radius: 16px;
}

/* Make badge truly center itself in the hero container */
#levelUpModal .lvlBadgeWrap{
  position: relative;
  width: min(62vw, 360px);
  aspect-ratio: 1 / 1;
}
#levelUpModal .lvlBadge{
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  filter: none;
  -webkit-font-smoothing: antialiased;
  text-rendering: geometricPrecision;
}
#levelUpModal #levelUpNum{
  will-change: transform;
  transform: translateZ(0);
}

/* Cleaner pop without blur */
@keyframes lvlPop{
  0%{transform: translate3d(-50%,-50%,0) scale(0.90); opacity:0;}
  55%{transform: translate3d(-50%,-50%,0) scale(1.06); opacity:1;}
  100%{transform: translate3d(-50%,-50%,0) scale(1.00); opacity:1;}
}

/* Rays: keep square + GPU translate so it doesn't look like it warps on rotation */
#levelUpModal .lvlRays{
  width: 180vmax;
  height: 180vmax;
  left: 50%;
  top: calc(var(--lvlPad) + (var(--lvlHeroH) / 2));
  transform: translate3d(-50%,-50%,0);
  transform-origin: center center;
  backface-visibility: hidden;
}
@keyframes lvlRaysSpin{
  0%{transform: translate3d(-50%,-50%,0) rotate(0deg);}
  100%{transform: translate3d(-50%,-50%,0) rotate(360deg);}
}

@media (max-width: 560px){
  #levelUpModal .lvlStage{
    --lvlPad: 14px;
    --lvlHeroH: clamp(260px, 46vh, 420px);
    gap: 12px;
  }
  #levelUpModal .lvlBadgeWrap{ width: min(72vw, 320px); }
}

/* ===============================
   Historial de desafíos
   =============================== */
#historyModal .modal__card{ max-width: 900px; }
.historyList{ display:flex; flex-direction:column; gap:10px; }
.historyRow{ display:grid; grid-template-columns: 1.1fr .8fr 2fr 1fr; gap:10px; align-items:center;
  padding:10px 12px;
  border:1px solid rgba(80,170,255,.22);
  border-radius:14px;
  background:rgba(16,25,44,.55);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
}
.historyRow .muted{ opacity:.78; }
.historyRow .pillMini{ display:inline-flex; align-items:center; justify-content:center; padding:2px 8px; border-radius:999px;
  border:1px solid rgba(80,170,255,.25);
  background:rgba(10,18,34,.55);
  font-size:12px; letter-spacing:.02em;
}
@media (max-width: 640px){
  .historyRow{ grid-template-columns: 1fr; gap:6px; align-items:start; }
}

/* ===============================
   LevelUp modal: mantener badge centrado
   =============================== */
#levelUpModal .lvlStage{ grid-template-columns: 1fr !important; }
#levelUpModal .lvlStageBadge{ justify-self:center !important; align-self:center !important; width:100% !important; }
#levelUpModal .lvlBadgeWrap{ left:50% !important; top:50% !important; transform: translate(-50%,-50%) scale(1) !important; }
#levelUpModal.cine-done .lvlBadgeWrap{ left:50% !important; top:50% !important; transform: translate(-50%,-50%) scale(1) !important; }
#levelUpModal .lvlNum{ transform: translateZ(0); -webkit-font-smoothing: antialiased; text-rendering: geometricPrecision; }

/* =========================================================
   LEVEL UP MODAL — Center lock + tidy rewards (v060f)
   ========================================================= */

/* Keep LevelUp modal centered (don't behave like bottom-sheet on mobile) */
#levelUpModal{
  place-items: center !important;
  padding: calc(12px + env(safe-area-inset-top)) calc(12px + env(safe-area-inset-right)) calc(12px + env(safe-area-inset-bottom)) calc(12px + env(safe-area-inset-left)) !important;
}

#levelUpModal .modal__card--levelup{
  width: min(1040px, calc(100vw - 24px)) !important;
  max-height: min(90vh, 940px) !important;
  overflow: hidden !important;
}

/* Make the cine layout breathe vertically */
#levelUpModal .levelUpCine{
  display: grid !important;
  grid-template-rows: auto 1fr !important;
  gap: 12px !important;
}

#levelUpModal .lvlStage{
  height: clamp(220px, 30vh, 340px) !important;
}

/* Choices area */
#levelUpModal .levelUpScrollArea{
  overflow: visible !important;
}

#levelUpModal .levelUpPickTitle{
  text-align: center !important;
  margin: 2px 0 10px 0 !important;
}

/* Main rewards: 3 arriba + 1 centrada abajo */
#levelUpModal .rewardPickGrid--levelupMain{
  display: grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 12px !important;
  align-items: stretch !important;
}

#levelUpModal .rewardPickGrid--levelupMain .rewardPick:nth-child(4){
  grid-column: 2 !important;
}

/* Hide any description remnants (belt & suspenders) */
#levelUpModal .rewardPick__desc{ display: none !important; }

/* Stat choices: 5 stats -> 3 arriba, 2 abajo centradas (mismo tamaño) */
#levelUpModal .rewardPickGrid--levelupStat{
  display: grid !important;
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
  gap: 12px !important;
}

#levelUpModal .rewardPickGrid--levelupStat .rewardPick:nth-child(4){
  grid-column: 1 !important;
}
#levelUpModal .rewardPickGrid--levelupStat .rewardPick:nth-child(5){
  grid-column: 3 !important;
}

@media (max-width: 700px){
  #levelUpModal .rewardPickGrid--levelupMain{
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }
  #levelUpModal .rewardPickGrid--levelupMain .rewardPick:nth-child(4){
    grid-column: 1 / -1 !important;
    justify-self: center !important;
    width: min(520px, 100%) !important;
  }
  #levelUpModal .rewardPickGrid--levelupStat{
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }
  /* In 2-col mode, keep them balanced */
  #levelUpModal .rewardPickGrid--levelupStat .rewardPick:nth-child(5){
    grid-column: 2 !important;
  }
}


/* =========================================================
   LevelUp Modal (RESET v060g) — rebuilt from zero
   ========================================================= */
#levelUpModal.luModal{
  position: fixed !important;
  inset: 0 !important;
  width: 100vw !important;
  height: 100dvh !important;
  z-index: 9999 !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  padding: clamp(10px, 2vw, 18px) !important;
}
#levelUpModal[hidden]{ display:none !important; }

/* Lock page scroll when LevelUp modal is open */
body.is-levelup-open{ overflow:hidden !important; }

#levelUpModal .modal__backdrop{
  position:absolute !important;
  inset:0 !important;
}

/* Card */
#levelUpModal .luCard{
  width: min(980px, 100%) !important;
  max-height: min(calc(100dvh - 24px - env(safe-area-inset-top) - env(safe-area-inset-bottom)), 920px) !important;
  overflow: hidden !important;
  padding: 14px !important;
  border-radius: 22px !important;
  display: grid !important;
  grid-template-rows: auto 1fr !important;
  gap: 12px !important;
  margin: 0 !important;
}

/* Stage */
#levelUpModal .luStage{
  position: relative !important;
  height: clamp(210px, 30vh, 340px) !important;
  border-radius: 18px !important;
  overflow: hidden !important;
  display: grid !important;
  align-items: center !important;
  justify-items: center !important;
}
#levelUpModal .luStageBg{
  position:absolute !important;
  inset:0 !important;
  background-size: cover !important;
  background-position: center !important;
  filter: saturate(1.05) contrast(1.02);
}
#levelUpModal .luStageShade{
  position:absolute !important;
  inset:0 !important;
  background: radial-gradient(closest-side, rgba(0,0,0,.0), rgba(0,0,0,.45));
}
#levelUpModal .luStageText{
  position:absolute !important;
  top: 10px !important;
  left: 12px !important;
  right: 12px !important;
  text-align:center !important;
  padding: 10px 12px !important;
  z-index: 4 !important;
  border-radius: 14px !important;
  background: linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.18));
  border: 1px solid rgba(255,255,255,.08);
  backdrop-filter: blur(8px);
  pointer-events: none;
}
#levelUpModal .luKicker{
  opacity: .98;
  letter-spacing: .14em;
  font-size: 14px;
  text-shadow: 0 2px 18px rgba(0,0,0,.75);
}
/* No mostramos nombre del personaje en este modal */
#levelUpModal .luName{ display:none !important; }

#levelUpModal .luBadgeWrap{
  position:absolute !important;
  inset:0 !important;
  display:grid !important;
  place-items:center !important;
  z-index:2 !important;
}
#levelUpModal .luBadge{
  /* Un poco más compacto para que el stage respire */
  width: clamp(120px, 16vw, 220px) !important;
  aspect-ratio: 1 / 1 !important;
  border-radius: 999px !important;
  display:grid !important;
  place-items:center !important;
  background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.18), rgba(255,255,255,.06) 40%, rgba(0,0,0,.12));
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 18px 40px rgba(0,0,0,.45);
  backdrop-filter: blur(7px);
}
#levelUpModal .luNum{
  font-size: clamp(56px, 7vw, 110px) !important;
  font-weight: 950;
  line-height: 1;
}

/* Open animations (impact) */
@keyframes luBadgePop{
  0%{ transform: scale(.88); filter: brightness(.9); }
  60%{ transform: scale(1.04); filter: brightness(1.08); }
  100%{ transform: scale(1); filter: brightness(1); }
}
@keyframes luBgSlowZoom{
  0%{ transform: scale(1.02); }
  100%{ transform: scale(1.06); }
}
#levelUpModal.is-open .luBadge{ animation: luBadgePop .46s cubic-bezier(.2,.9,.2,1) both; }
#levelUpModal.is-open .luStageBg{ animation: luBgSlowZoom 2.2s ease-out both; }

/* Body */
#levelUpModal .luBody{
  overflow: auto !important;
  padding: 6px 6px 8px !important;
  display: flex !important;
  flex-direction: column !important;
}
#levelUpModal .luPickTitle{
  text-align:center !important;
  font-weight: 900 !important;
  letter-spacing: .14em !important;
  opacity: .95;
  margin: 2px 0 10px !important;
}

/* Choices container */
#levelUpModal .luChoices{
  display: grid !important;
  gap: 12px !important;
  /* Con pocas opciones se ve centrado y balanceado */
  align-content: start !important;
  justify-items: stretch !important;
  flex: 1 1 auto !important;
  padding-bottom: 6px !important;
}

/* Main rewards (4) => 3 + 1 centered */
#levelUpModal .luChoices[data-mode="main"]{
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
}
#levelUpModal .luChoices[data-mode="main"] .luPick:nth-child(4){
  grid-column: 2 !important;
}

/* Stat picks (5) => 3 + 2 centered */
#levelUpModal .luChoices[data-mode="autoStat"]{
  grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
}
#levelUpModal .luChoices[data-mode="autoStat"] .luPick:nth-child(4){
  grid-column: 1 / span 1 !important;
}
#levelUpModal .luChoices[data-mode="autoStat"] .luPick:nth-child(5){
  grid-column: 2 / span 1 !important;
}

/* Pick card */
#levelUpModal .luPick{
  min-height: 84px !important;
  border-radius: 16px !important;
  padding: 12px 14px !important;
  display: grid !important;
  grid-template-columns: 44px 1fr 72px !important;
  align-items: center !important;
  gap: 12px !important;
  background: rgba(255,255,255,.03);
  border: 1px solid rgba(0,210,255,.16);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
}
#levelUpModal .luPickIcon{
  width: 34px; height: 34px;
  border-radius: 12px;
  display:grid; place-items:center;
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.10);
}
#levelUpModal .luPickTitleText{
  font-weight: 900;
  font-size: 16px;
  text-align: center;
}
#levelUpModal .luPickMeta{
  opacity:.85;
  font-weight: 800;
  text-align: right;
}

/* Mobile: 2 columns + last spans */
@media (max-width: 700px){
  #levelUpModal.luModal{ padding: 10px !important; }
  #levelUpModal .luCard{ max-height: 92svh !important; }

  #levelUpModal .luStage{ height: clamp(240px, 34vh, 360px) !important; }

  #levelUpModal .luChoices[data-mode="main"],
  #levelUpModal .luChoices[data-mode="autoStat"]{
    grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
  }
  #levelUpModal .luChoices[data-mode="main"] .luPick:nth-child(4),
  #levelUpModal .luChoices[data-mode="autoStat"] .luPick:nth-child(5){
    grid-column: 1 / -1 !important;
    justify-self: center !important;
    width: min(560px, 100%) !important;
  }

/* Extra small phones: 1 column + safer header + badge spacing */
@media (max-width: 560px){
  #levelUpModal .luCard{ padding: 12px !important; gap: 10px !important; }
  #levelUpModal .luStage{ height: clamp(300px, 42vh, 420px) !important; }
  #levelUpModal .luBadge{ width: clamp(120px, 40vw, 190px) !important; }
  #levelUpModal .luBadgeWrap{ transform: translateY(18px) !important; }
  #levelUpModal .luStageText{ top: 8px !important; left: 10px !important; right: 10px !important; padding: 10px 10px !important; }
  #levelUpModal .luKicker{ font-size: 13px !important; }
  #levelUpModal .luChoices[data-mode="main"],
  #levelUpModal .luChoices[data-mode="autoStat"]{
    grid-template-columns: 1fr !important;
  }
  #levelUpModal .luChoices .luPick{
    grid-template-columns: 44px 1fr 64px !important;
  }
  #levelUpModal .luPickTitleText{ font-size: 15px !important; }
}

}

/* =========================================================
   LevelUp — Medallas en ficha (read-only) + refinamiento modal (v060i)
   ========================================================= */

/* Ficha: compactar inputs y agregar contador de medallas arriba a la derecha */
.fields3{
  display: grid;
  grid-template-columns: 1.35fr .65fr 1.35fr .75fr;
  gap: 12px;
  align-items: end;
}

.field--small .input{ text-align:center; }

.field--medals .labelSmall{
  display:flex;
  align-items:center;
  gap: 8px;
}

/* Ficha: medallas con el mismo lenguaje visual que Tienda (SVG + contador) */
.medalBadgeSmall{
  height: 44px;
  border-radius: 999px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
  padding: 0 14px;
  font-weight: 950;
  font-size: 18px;
  letter-spacing: .02em;
  background: rgba(255,255,255,.03);
  border: 1px solid rgba(0,210,255,.18);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
  user-select:none;
}
.medalBadgeSmall .medalCount{ line-height:1; color: rgba(245,245,255,0.95); text-shadow: 0 1px 0 rgba(0,0,0,.65), 0 0 10px rgba(0,0,0,.35); }
.medalSvg{
  width: 22px;
  height: 22px;
  display:block;
  filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
  opacity: .95;
}

.medalIcon{ 
  filter: drop-shadow(0 2px 6px rgba(0,0,0,.35)); 
  display: inline-block;
  vertical-align: middle;
  line-height: 1;
  margin: 0;
  transform: translateY(1px);
}

/* Legacy: se mantiene por compatibilidad (por si algún layout aún lo usa) */
.medalsPill{
  height: 44px;
  border-radius: 999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight: 950;
  font-size: 18px;
  letter-spacing: .02em;
  background: rgba(255,255,255,.03);
  border: 1px solid rgba(0,210,255,.18);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
  user-select:none;
}

@media (max-width: 720px){
  .fields3{
    grid-template-columns: 1fr .8fr;
  }
  .field--medals{ justify-self: end; width: 100%; }
  .field--medals .medalsPill{ width: 110px; }
}

/* Modal: nota fuera de la grilla para que no rompa tamaños */
#levelUpModal .luNote{
  margin: 0 0 10px 0;
  opacity: .88;
  font-size: 13px;
  line-height: 1.25;
  text-align: left;
}

/* Iconos del modal: estilo consistente tipo UI */
#levelUpModal .luPickIcon{
  background: rgba(0,0,0,.22);
}

#levelUpModal .luPickIcon svg{
  width: 18px;
  height: 18px;
  display:block;
}


/* =========================
   LEVEL UP MODAL WOW (opaco + tarjetas)
   (override seguro)
   ========================= */
#levelUpModal{
  position: fixed;
  inset:0;
  display:grid;
  place-items:center;
  padding: clamp(10px, 2vw, 18px);
  z-index: 9999;
}
#levelUpModal[hidden]{ display:none !important; }
#levelUpModal .modal__backdrop{
  background: rgba(0,0,0,.65);
  backdrop-filter: blur(3px);
}
#levelUpModal .modal__card--levelup{
  width: min(980px, calc(100vw - 24px));
  max-height: min(92dvh, 880px);
  overflow: hidden;
  background: rgba(10,12,16,1) !important;
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 24px;
  box-shadow: 0 26px 90px rgba(0,0,0,.65);
  backdrop-filter: none !important;
}

#levelUpModal .levelUpCine{
  display:grid;
  grid-template-rows: auto 1fr;
  gap: 12px;
}

#levelUpModal .lvlStage{
  height: clamp(260px, 36vh, 340px);
  border-radius: 22px;
  overflow:hidden;
  position: relative;
  background: linear-gradient(180deg, rgba(14,16,22,1), rgba(10,12,16,1));
  border: 1px solid rgba(255,255,255,.06);
}
#levelUpModal .lvlStageBg{
  position:absolute;
  inset:0;
  background-size: cover;
  background-position: center;
  filter: saturate(1.05) contrast(1.05);
}
#levelUpModal .lvlStageVignette{
  position:absolute; inset:0;
  background: radial-gradient(closest-side at 50% 45%, rgba(0,0,0,.0), rgba(0,0,0,.55));
}
#levelUpModal .lvlStageRays{
  position:absolute; inset:-140px -240px;
  background:
    repeating-conic-gradient(from 200deg,
      rgba(255,255,255,.06) 0 8deg,
      rgba(255,255,255,0) 8deg 16deg);
  opacity:.30;
  filter: blur(2px);
  animation: luRaysSpin 10s linear infinite;
  pointer-events:none;
}
@keyframes luRaysSpin{ from{ transform: rotate(0deg);} to{ transform: rotate(360deg);} }

#levelUpModal .lvlStageCopy{
  position:absolute;
  top: 14px;
  left: 14px;
  right: 14px;
  display:flex;
  justify-content:center;
  z-index: 3;
}
#levelUpModal .lvlStageKicker{
  padding: 10px 14px;
  border-radius: 16px;
  background: rgba(0,0,0,.55);
  border: 1px solid rgba(255,255,255,.10);
  text-align:center;
  font-weight: 900;
  letter-spacing: .12em;
  text-transform: uppercase;
}

#levelUpModal .lvlBadgeWrap{
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  z-index: 3;
}
#levelUpModal .lvlBadge{
  width: clamp(150px, 18vw, 240px);
  aspect-ratio: 1/1;
  border-radius: 999px;
  display:grid;
  place-items:center;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.12), rgba(255,255,255,.04));
  border: 1px solid rgba(255,255,255,.18);
  box-shadow: 0 18px 60px rgba(0,0,0,.60), inset 0 0 0 1px rgba(255,255,255,.06);
  animation: luBadgePop .55s cubic-bezier(.2,1.2,.2,1);
}
@keyframes luBadgePop{ 0%{ transform: scale(.65); filter: blur(1px);} 80%{ transform: scale(1.06);} 100%{ transform: scale(1);} }

#levelUpModal .lvlBadgeNumber{
  font-size: clamp(64px, 8vw, 120px);
  font-weight: 950;
  line-height: 1;
  text-shadow:
    0 2px 0 rgba(0,0,0,.55),
    0 12px 28px rgba(0,0,0,.65),
    0 0 18px rgba(120,200,255,.18);
}

#levelUpModal .levelUpScrollArea{
  padding: 4px 14px 16px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  max-height: calc(92dvh - 360px);
}
#levelUpModal .levelUpPickTitle{
  text-align:center;
  font-weight: 900;
  letter-spacing: .14em;
  margin: 8px 0 12px;
  text-transform: uppercase;
}

#levelUpModal .luChoicesGrid{
  display:grid;
  gap: 12px;
  justify-content:center;
}
#levelUpModal .luChoicesGrid--rewards{
  grid-template-columns: repeat(2, minmax(0, 1fr));
}
#levelUpModal .luChoicesGrid--stats{
  grid-template-columns: repeat(6, 1fr);
}
#levelUpModal .luChoicesGrid--stats .rewardPick{
  grid-column: span 2;
}
#levelUpModal .luChoicesGrid--stats .rewardPick:nth-of-type(4){
  grid-column: 2 / span 2;
}
#levelUpModal .luChoicesGrid--stats .rewardPick:nth-of-type(5){
  grid-column: 4 / span 2;
}

#levelUpModal .rewardPick--card{
  border-radius: 18px;
  background: linear-gradient(180deg, rgba(16,18,24,1), rgba(10,12,16,1));
  border: 2px solid rgba(255,255,255,.10);
  box-shadow: 0 14px 40px rgba(0,0,0,.45);
  padding: 14px 12px;
  min-height: 120px;
  display:flex;
  flex-direction: column;
  align-items:center;
  justify-content:center;
  gap: 10px;
  cursor:pointer;
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
}
#levelUpModal .rewardPick--card:hover{
  transform: translateY(-2px) scale(1.01);
  box-shadow: 0 18px 54px rgba(0,0,0,.55);
}
#levelUpModal .rewardPick__iconBig{
  width: 66px;
  height: 66px;
  display:grid;
  place-items:center;
  border-radius: 18px;
  background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.10), rgba(255,255,255,.04));
  border: 1px solid rgba(255,255,255,.14);
}
#levelUpModal .rewardPick__iconBig svg{
  width: 40px;
  height: 40px;
}
#levelUpModal .rewardPick__titleSmall{
  font-weight: 900;
  text-align:center;
  letter-spacing: .02em;
}
#levelUpModal .rewardPick__metaLine{
  opacity: .78;
  font-size: 12px;
}
#levelUpModal .rewardPick__plus{
  margin-left: 6px;
  font-weight: 900;
  opacity: .92;
}

/* Colored borders (only border) */
#levelUpModal .rewardPick--xp{ border-color: rgba(45,220,255,.55); }
#levelUpModal .rewardPick--stat{ border-color: rgba(168,120,255,.55); }
#levelUpModal .rewardPick--medal{ border-color: rgba(255,206,120,.60); }
#levelUpModal .rewardPick--x2{ border-color: rgba(110,255,176,.55); }

@media (max-width: 520px){
  #levelUpModal .rewardPick__iconBig{ width: 58px; height: 58px; }
  #levelUpModal .rewardPick__iconBig svg{ width: 34px; height: 34px; }
  #levelUpModal .rewardPick--card{ min-height: 112px; padding: 12px 10px; }
  #levelUpModal .lvlBadge{ width: 160px; }
}

/* =========================
   LEVEL UP MODAL WOW (opaco + tarjetas)
   Override seguro para centrar, quitar transparencias y hacer recompensas más "wow".
   ========================= */

#levelUpModal{
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  padding: clamp(10px, 2vw, 18px);
  z-index: 9999;
}
#levelUpModal[hidden]{ display:none !important; }

#levelUpModal .modal__backdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,.70);
  backdrop-filter: blur(10px) saturate(130%);
}

.modal__card--levelup{
  position: relative;
  width: min(980px, 96vw);
  max-height: min(86vh, 820px);
  overflow: auto;
  border-radius: 22px;
  background: #111720; /* OPACO */
  border: 1px solid rgba(90,200,255,.25);
  box-shadow: 0 28px 70px rgba(0,0,0,.55);
}

.lvlStage{
  position: relative;
  border-radius: 18px;
  overflow: hidden;
  background: #0d131b; /* OPACO */
  border: 1px solid rgba(90,200,255,.18);
}

.lvlStage__bg{
  position:absolute;
  inset:0;
  background-size: cover;
  background-position: center;
  filter: saturate(1.05) contrast(1.05);
  transform: scale(1.02);
}

.lvlStage__shade{
  position:absolute;
  inset:0;
  background: linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.72));
}

.lvlStage__topline{
  position:absolute;
  left: 16px;
  right: 16px;
  top: 12px;
  text-align:center;
  color: rgba(255,255,255,.9);
  font-weight: 800;
  letter-spacing: .22em;
  text-transform: uppercase;
  font-size: 12px;
  text-shadow: 0 6px 16px rgba(0,0,0,.65);
}

.lvlBadge{
  position: relative;
  margin: 52px auto 14px;
  width: 158px;
  aspect-ratio: 1/1;
  border-radius: 999px;
  display:grid;
  place-items:center;
  background: #0f1620; /* OPACO */
  border: 1px solid rgba(255,255,255,.18);
  box-shadow: 0 18px 40px rgba(0,0,0,.55);
}

.lvlBadge::before{
  content:"";
  position:absolute;
  inset:-22px;
  background:
    radial-gradient(circle at 50% 50%, rgba(255,214,90,.25) 0, rgba(255,214,90,0) 60%),
    radial-gradient(circle at 50% 50%, rgba(126,231,255,.20) 0, rgba(126,231,255,0) 62%);
  filter: blur(2px);
  opacity: .9;
}

.levelUpBig__num{
  position: relative;
  z-index: 1;
  font-size: clamp(56px, 8vw, 86px);
  font-weight: 1000;
  letter-spacing: -0.03em;
  color: rgba(255,255,255,.92);
  text-shadow:
    0 10px 24px rgba(0,0,0,.65),
    0 2px 0 rgba(0,0,0,.35);
}

.levelUpTitle{
  text-align:center;
  font-size: 20px;
  font-weight: 1000;
  letter-spacing: .12em;
  text-transform: uppercase;
  color: rgba(255,255,255,.92);
  margin: 6px 0 14px;
}

/* Grid de recompensas */
.rewardGrid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  padding: 0 18px 18px;
}

.rewardPick{
  appearance:none;
  border: 1px solid rgba(90,200,255,.22);
  background: #121a24; /* OPACO */
  border-radius: 18px;
  padding: 14px 12px 12px;
  cursor:pointer;
  display:flex;
  flex-direction: column;
  align-items:center;
  justify-content:center;
  gap: 10px;
  min-height: 140px;
  position: relative;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 12px 26px rgba(0,0,0,.38);
}

.rewardPick::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius: 18px;
  border: 2px solid var(--reward-accent, rgba(90,200,255,.0));
  opacity: .9;
  pointer-events:none;
}

.rewardPick:hover{ transform: translateY(-2px); }
.rewardPick:active{ transform: translateY(0px) scale(.99); }

.rewardPick__iconBig{
  width: 56px;
  height: 56px;
  display:grid;
  place-items:center;
  border-radius: 16px;
  background: rgba(255,255,255,.04);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
}

.rewardPick__titleSmall{
  font-weight: 900;
  color: rgba(255,255,255,.92);
  text-align:center;
}

.rewardPick__sub{
  font-size: 12px;
  color: rgba(210,230,255,.78);
  text-align:center;
  line-height: 1.2;
}

.rewardPick--stat{ --reward-accent: rgba(90,200,255,.50); }
.rewardPick--xp{ --reward-accent: rgba(255,214,90,.55); }
.rewardPick--medal{ --reward-accent: rgba(255,110,184,.55); }
.rewardPick--double{ --reward-accent: rgba(155,125,255,.55); }

/* Paso 1: stats (obligatorio) */
.statGrid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  padding: 0 18px 10px;
}

.statPick{
  border: 1px solid rgba(90,200,255,.22);
  background: #121a24;
  border-radius: 18px;
  padding: 12px 12px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 12px;
  min-height: 76px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06), 0 12px 26px rgba(0,0,0,.34);
}

.statPick__left{ display:flex; align-items:center; gap: 10px; }

.statPick__icon{
  width: 46px;
  height: 46px;
  display:grid;
  place-items:center;
  border-radius: 14px;
  background: rgba(255,255,255,.04);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
}

.statPick__code{ font-weight: 1000; letter-spacing: .08em; }

@media (max-width: 760px){
  .modal__card--levelup{ width: min(540px, 96vw); }
  .rewardGrid{ grid-template-columns: repeat(2, 1fr); }
  .statGrid{ grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 420px){
  .lvlBadge{ width: 142px; }
  .rewardPick{ min-height: 132px; }
}

/* =========================
   LEVEL UP MODAL WOW (opaco + tarjetas)
   Override seguro para centrar, quitar transparencias y hacer recompensas más "wow".
   ========================= */

#levelUpModal{
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  padding: clamp(10px, 2vw, 18px);
  z-index: 9999;
}
#levelUpModal[hidden]{ display:none !important; }
#levelUpModal .modal__backdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,.65);
  backdrop-filter: blur(10px);
}
#levelUpModal .modal__card--levelup{
  position: relative;
  width: min(980px, 100%);
  border-radius: 24px;
  overflow: hidden;
  border: 1px solid rgba(64, 155, 255, .28);
  background: #141a22; /* opaco */
  box-shadow: 0 24px 80px rgba(0,0,0,.55);
}

#levelUpModal .lvlStage{
  position: relative;
  display: grid;
  grid-template-columns: 1.2fr .8fr;
  gap: 18px;
  padding: 16px 18px 12px;
  background: linear-gradient(180deg, #121823 0%, #141a22 40%, #141a22 100%);
}
#levelUpModal .lvlStage__bg{
  position:absolute;
  inset:0;
  background: radial-gradient(1200px 300px at 50% 0%, rgba(150,90,255,.22), transparent 60%);
  pointer-events:none;
}

#levelUpModal .lvlBadge{
  position: relative;
  border-radius: 18px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,.08);
  background: #0f141c; /* opaco */
}
#levelUpModal .lvlBadge__img{
  position:absolute;
  inset:0;
  background-position: center;
  background-size: cover;
  filter: saturate(1.05) contrast(1.02);
}
#levelUpModal .lvlBadge__img::after{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(180deg, rgba(0,0,0,.05), rgba(0,0,0,.60));
}
#levelUpModal .lvlBadge__glow{
  position:absolute;
  inset:-40%;
  background: radial-gradient(circle at 50% 50%, rgba(255,210,120,.30), transparent 55%);
  filter: blur(22px);
  pointer-events:none;
}
#levelUpModal .levelUpBig{
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
}
#levelUpModal .levelUpBig__num{
  font-size: clamp(86px, 11vw, 128px);
  font-weight: 900;
  letter-spacing: .02em;
  color: rgba(255,255,255,.95);
  text-shadow: 0 10px 26px rgba(0,0,0,.65), 0 2px 0 rgba(0,0,0,.35);
  filter: drop-shadow(0 18px 32px rgba(0,0,0,.35));
}

#levelUpModal .lvlStage__headline{
  display:flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 0 6px;
  color: rgba(255,255,255,.86);
  text-transform: uppercase;
  letter-spacing: .16em;
  font-size: 12px;
}
#levelUpModal .lvlStage__headline b{
  font-size: 13px;
  letter-spacing: .14em;
}
#levelUpModal .lvlStage__content{
  position: relative;
  z-index: 1;
}

#levelUpModal .levelUpBody{
  padding: 12px 18px 18px;
}
#levelUpModal .levelUpTitle{
  margin: 0;
  font-size: 18px;
  font-weight: 800;
  letter-spacing: .12em;
  text-transform: uppercase;
  text-align: center;
  color: rgba(255,255,255,.9);
}
#levelUpModal .levelUpHint{
  margin: 8px 0 12px;
  font-size: 13px;
  color: rgba(255,255,255,.70);
  display:flex;
  gap: 10px;
  align-items: flex-start;
}
#levelUpModal .levelUpHint .emoji{ line-height: 1.1; }

#levelUpModal .rewardGrid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-top: 10px;
}
#levelUpModal .rewardGrid--twoRows{
  grid-template-columns: repeat(2, 1fr);
}

#levelUpModal .rewardPick{
  border-radius: 16px;
  background: #0f141c;
  border: 1px solid rgba(255,255,255,.08);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.25);
  padding: 14px 12px 12px;
  display:flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 10px;
  min-height: 126px;
  cursor: pointer;
  transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
}
#levelUpModal .rewardPick:hover{
  transform: translateY(-2px);
  box-shadow: 0 16px 38px rgba(0,0,0,.45), inset 0 0 0 1px rgba(0,0,0,.18);
}
#levelUpModal .rewardPick:active{ transform: translateY(0); }

#levelUpModal .rewardPick--card{ border-color: rgba(70,170,255,.30); box-shadow: inset 0 0 0 1px rgba(70,170,255,.12); }
#levelUpModal .rewardPick--xp{ border-color: rgba(255,210,120,.30); box-shadow: inset 0 0 0 1px rgba(255,210,120,.10); }
#levelUpModal .rewardPick--medal{ border-color: rgba(120,255,220,.28); box-shadow: inset 0 0 0 1px rgba(120,255,220,.10); }
#levelUpModal .rewardPick--double{ border-color: rgba(190,120,255,.28); box-shadow: inset 0 0 0 1px rgba(190,120,255,.10); }

#levelUpModal .rewardPick__iconBig{
  width: 58px;
  height: 58px;
  border-radius: 14px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: 0 10px 20px rgba(0,0,0,.28);
}
#levelUpModal .rewardPick__iconBig svg{ width: 34px; height: 34px; }
#levelUpModal .rewardPick__titleSmall{
  font-size: 13px;
  font-weight: 800;
  color: rgba(255,255,255,.88);
  letter-spacing: .06em;
  text-transform: uppercase;
  text-align: center;
}
#levelUpModal .rewardPick__sub{
  font-size: 12px;
  color: rgba(255,255,255,.64);
  text-align: center;
  margin-top: -6px;
}

#levelUpModal .statGrid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}
#levelUpModal .statPick{
  border-radius: 16px;
  background: #0f141c;
  border: 1px solid rgba(255,255,255,.08);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.25);
  padding: 12px 12px;
  display:flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  min-height: 78px;
  cursor: pointer;
  transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease;
}
#levelUpModal .statPick:hover{
  transform: translateY(-1px);
  box-shadow: 0 14px 34px rgba(0,0,0,.42), inset 0 0 0 1px rgba(0,0,0,.18);
}
#levelUpModal .statPick__left{ display:flex; align-items:center; gap: 10px; }
#levelUpModal .statPick__icon{
  width: 44px;
  height: 44px;
  border-radius: 12px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
}
#levelUpModal .statPick__label{ font-size: 16px; font-weight: 900; letter-spacing: .08em; }
#levelUpModal .statPick__right{ display:flex; align-items:center; gap: 10px; }
#levelUpModal .statPick__cur{
  width: 44px;
  height: 34px;
  border-radius: 999px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.05);
  border: 1px solid rgba(255,255,255,.10);
  color: rgba(255,255,255,.80);
  font-weight: 800;
}
#levelUpModal .statPick__plus{
  font-size: 16px;
  font-weight: 900;
  color: rgba(120,210,255,.95);
}

@media (max-width: 560px){
  #levelUpModal{ padding: 10px; }
  #levelUpModal .modal__card--levelup{ border-radius: 20px; }
  #levelUpModal .lvlStage{ grid-template-columns: 1fr; }
  #levelUpModal .lvlBadge{ border-radius: 16px; }
  #levelUpModal .rewardGrid{ grid-template-columns: repeat(2, 1fr); }
  #levelUpModal .statGrid{ grid-template-columns: repeat(2, 1fr); }
  #levelUpModal .levelUpHint{ font-size: 12.5px; }
}
