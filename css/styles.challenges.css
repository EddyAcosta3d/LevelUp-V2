/* Desafíos: pesos visuales */
.challengeName{ font-weight: 900; letter-spacing: .2px; }
.challengeItem{ position:relative; overflow:hidden; }
.challengeItem::before{ content:""; position:absolute; left:0; top:0; bottom:0; width:4px; background: rgba(220,220,230,0.08); }
.challengeItem[data-diff="easy"]::before{ background: rgba(0,210,255,0.75); box-shadow: 0 0 14px rgba(0,210,255,0.22); }
.challengeItem[data-diff="medium"]::before{ background: rgba(114,26,255,0.80); box-shadow: 0 0 14px rgba(114,26,255,0.22); }
.challengeItem[data-diff="hard"]::before{ background: rgba(255,90,90,0.80); box-shadow: 0 0 14px rgba(255,90,90,0.18); }

.challengeBody{ min-height: 220px; font-size: 15px; line-height: 1.35; color: rgba(220,220,230,0.94); white-space: pre-wrap; }

/* ===== Desafíos: hacer la vista más "game-like" y evitar redundancias ===== */
/* Header del listado: que el bloque de progreso no se encime con el título */
.cardHead--ch{ align-items:flex-start; }
.cardHead--ch > div:first-child{ min-width:0; }
.chProgressChips{
  max-width: 290px;
  display:grid;
  gap: 6px;
  justify-items:end;
}

.chProgItem{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap: 8px;
  font-size: 12px;
  color: var(--muted);
}
.chProgItem b{ color: var(--text); font-weight: 900; }
.chProgIcon{ width: 18px; text-align:center; opacity: .95; }
@media (max-width: 540px){
  .chProgressChips{ max-width: none; display:flex; justify-content:flex-start; }
}

/* Tarjetas: un poco más de contraste y brillo sutil */
.cards2--ch .card{
  background: rgba(13,16,22,0.88);
  border-color: var(--borderSoft);
  box-shadow: 0 18px 60px rgba(0,0,0,0.55);
}
.cards2--ch .card:hover{ border-color: rgba(34,211,238,0.28); }

/* XP como "recompensa" (dorado) solo en Desafíos */
.page[data-page="desafios"] .badge--pts{
  border-color: rgba(251,191,36,0.34);
  background: rgba(251,191,36,0.10);
}

/* Pendiente: que destaque sin duplicar información */
.badge--pending{
  border-color: rgba(251,191,36,0.22);
  background: rgba(251,191,36,0.06);
  color: rgba(240,235,220,0.92);
}

/* Lista: selección más clara y estilo de "misión" */
.challengeItem{ background: rgba(0,0,0,0.16); }
.challengeItem:hover{ transform: translateY(-1px); border-color: rgba(0,210,255,0.22); box-shadow: 0 12px 26px rgba(0,0,0,0.28); }
.challengeItem.is-selected{ border-color: rgba(0,210,255,0.42); box-shadow: 0 0 0 2px rgba(0,210,255,0.12) inset, 0 20px 50px rgba(0,0,0,0.35); }
.challengeItem.is-done{ opacity: .78; }

/* Detalle: badges solo en header (evitar duplicados en el cuerpo) */
.challengeDetailMeta{ padding-top: 2px; }

/* Pills de dificultad: colorear el activo */
.diffPills .pill{ border-color: rgba(220,220,230,0.14); }
.diffPills .pill.is-active{ border-color: rgba(0,210,255,0.40); background: rgba(0,210,255,0.10); }
.diffPills .pill.is-active[data-diff="easy"]{ border-color: rgba(0,210,255,0.55); background: rgba(0,210,255,0.12); }
.diffPills .pill.is-active[data-diff="medium"]{ border-color: rgba(114,26,255,0.55); background: rgba(114,26,255,0.12); }
.diffPills .pill.is-active[data-diff="hard"]{ border-color: rgba(255,90,90,0.55); background: rgba(255,90,90,0.12); }

/* Acciones por-item (editar / borrar) viven en la tarjeta del listado */
.chItemActions{
  position:absolute;
  top: 10px;
  right: 10px;
  display:flex;
  gap: 8px;
  opacity: 0;
  pointer-events: none;
  transform: translateY(-2px);
  transition: opacity .16s ease, transform .16s ease;
  z-index: 30;
}
html.is-edit .chItemActions{
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
}
.chIconBtn{
  width: 34px;
  height: 34px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(0,0,0,0.22);
  color: var(--text, #dcdce6);
  cursor:pointer;
  display:grid;
  place-items:center;
}
.chIconBtn:hover{ border-color: rgba(0,210,255,0.32); background: rgba(0,210,255,0.08); }
.chIconBtn--danger:hover{ border-color: rgba(255,90,90,0.45); background: rgba(255,90,90,0.10); }

/* Materias modal */
.subjectsList{ display:grid; gap: 10px; }
.subjectRow{ display:flex; align-items:center; justify-content:space-between; gap: 10px; padding: 10px 12px; border-radius: 14px; border: 1px solid var(--borderSoft); background: rgba(0,0,0,0.18); }
.subjectRow__name{ font-weight: 800; }
.subjectRow__actions{ display:flex; gap: 8px; flex-wrap:wrap; }
.ddItem{width:100%;text-align:left;padding:10px 10px;border:0;background:transparent;color:var(--text,#dcdce6);cursor:pointer}
.ddItem:hover{background:rgba(0,210,255,0.08)}

.ghostBox{
  margin-top: 10px; border-radius: 14px; height: 110px;
  border: 1px dashed rgba(0,210,255,0.18); background: rgba(255,255,255,0.02);
  display:flex; align-items:center; justify-content:center;
  color: rgba(255,255,255,0.35);
}

.modal{
  position: fixed;
  inset: 0;
  z-index: 100000;
  display:grid;
  place-items:center;
  padding: 20px;
}

/* Ensure confirmation modal always appears on top of other open modals */
#confirmModal{ z-index: 110000; }
.modal[hidden]{ display:none; }
/* When a modal is open, force header dropdowns behind the overlay */
body.is-modal-open .dropdown,
body.is-modal-open .dropdown__menu{
  z-index: 1 !important;
}
.modal__backdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,0.74);
  backdrop-filter: none;
}
.modal__card{
  position:relative;
  width: min(720px, 96vw);
  max-height: min(78vh, 760px);
  overflow:auto;
  border-radius: var(--radius);
  padding: 16px;
  background: var(--panel);
  border: 1px solid var(--borderSoft);
  box-shadow: 0 22px 80px rgba(0,0,0,0.70);
}
.modal__header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  margin-bottom: 10px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--borderSoft);
}
.roleList{ display:grid; gap: 10px; }
.roleItem{
  text-align:left;
  border-radius: 16px;
  padding: 12px 14px;
  border: 1px solid var(--borderSoft);
  background: rgba(0,0,0,0.18);
  cursor:pointer;
  display:grid;
  gap: 4px;
}
.roleItem:hover{ border-color: rgba(0,210,255,0.32); background: rgba(0,210,255,0.08); }
.roleItem__name{ font-weight: 800; letter-spacing: .4px; }
.roleItem__desc{ font-size: 13px; color: var(--muted); }

.gridCards{ display:grid; grid-template-columns: repeat(4, minmax(190px, 1fr)); gap: var(--gap); padding-bottom: 14px; }
.tile{ border-radius: 18px; border: 1px solid rgba(0,210,255,0.14); background: rgba(0,0,0,0.18); padding: 12px; display:flex; flex-direction:column; gap: 10px; }
.tile__img{ height: 180px; border-radius: 14px; border: 1px solid rgba(0,210,255,0.10); background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.22)); position:relative; overflow:hidden; }
.tile.locked .tile__img::after{ content:""; position:absolute; inset:0; background: radial-gradient(200px 200px at 50% 40%, rgba(0,0,0,0.20), rgba(0,0,0,0.75)); }
.tile__img--unlocked{ background: linear-gradient(180deg, rgba(120,255,180,0.10), rgba(0,0,0,0.22)); }
.tile__name{ font-weight: 900; letter-spacing: 1px; }
.tile.locked .tile__name{ letter-spacing: 3px; opacity:.7; }
.tile__req{ opacity:.65; font-size: 12px; }

.table{ border-radius: 14px; overflow:hidden; border: 1px solid rgba(0,210,255,0.10); }
.tr{ display:grid; grid-template-columns: 1fr 80px 120px 120px; gap: 10px; padding: 10px 12px; background: rgba(0,0,0,0.18); }
.tr:nth-child(even){ background: rgba(0,0,0,0.10); }
.th{ font-weight: 800; background: rgba(0,210,255,0.06); }

.kv{ display:grid; grid-template-columns: 90px 1fr; gap: 8px 10px; font-size: 13px; }
.k{ opacity:.7; }
.v{ opacity:.9; font-weight: 650; }

.overlay{
  position:absolute; inset:0;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(2px);
  z-index: 20;
}
.overlay[hidden]{ display:none !important; pointer-events: none !important; }

/* --- Desafíos (nuevo header + detalle) --- */
.challengeTop{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin:6px 0 12px}
.challengeTop .dropdown{position:relative}
#subjectMenu{min-width:220px}
.diffPills{display:flex;gap:8px;flex-wrap:wrap}
.challengeDetailHead{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:6px 0 10px}
.challengeDetailActions{display:flex;gap:8px;flex-wrap:wrap}
.challengeDetailMeta{
  color:var(--text, #dcdce6);
  opacity:.95;
  display:flex;
  flex-wrap:wrap;
  column-gap:10px;
  row-gap:10px;
  align-items:center;
}
.challengeBody{min-height:140px;white-space:pre-wrap;border:1px solid var(--borderSoft);background:rgba(0,0,0,0.22);border-radius:16px;padding:12px;color:var(--text, #dcdce6)}
@media (max-width:640px){
  .challengeBody{min-height:180px}
}



/* ===== LevelUP_V2_00.029 — Ajustes Desafíos (legibilidad y chips) ===== */
/* Evita encimado de badges (ej. "Tecnología" + "Difícil") en el encabezado de detalle */
.challengeDetailMeta{ align-items:flex-start; }

.challengeHintBadges{
  display:flex !important;
  flex-wrap:wrap;
  gap:10px !important;
  align-items:center;
  margin-top:6px;
}

.challengeHintBadges .badge{
  margin:0 !important;
  white-space:nowrap;
}

/* Respaldo extra: aunque el layout falle, que nunca se encimen */
.challengeHintBadges .badge + .badge{ margin-left: 0 !important; }

/* Lista: un poco más de aire entre título y chips */
.challengeRow{ gap:10px; }
.challengeMetaRow{ gap:8px; }

/* Detail: que el bloque de badges no se comprima raro */
.challengeDetailMeta > .challengeHintBadges{ min-width: 0; }

/* =============================
   LevelUP_V2_00.030 overrides
   ============================= */

/* Evita que los paneles flex se "aplasten" por alturas implícitas */
.main,
.mainContent,
.page,
.card,
.cardBody{ min-height: 0; }

/* Desafíos: cuerpo con un poquito más de aire en escritorio */
.challengeBody{ min-height: 180px; }
@media (max-width: 768px){
  .challengeBody{ min-height: 150px; }
}

/* Badges: separación y lectura consistente */
.challengeHintBadges{ gap:10px !important; flex-wrap:wrap; }
.challengeHintBadges .badge{ padding:6px 10px; border-radius: 999px; }

/* Modales: z-index base 30000 (sobre topbar 20000 y bossBattle 25000).
   luModal tiene 50000, confirmModal tiene 110000 — ver sus propios archivos. */
.modal{ z-index: 30000; }

/* Splash: logo más grande + brillo menos invasivo (evita barra blanca) */
.splash__inner{ max-width: 560px; }
/* clamp original usaba 320px como mínimo = 100% del viewport en teléfonos ≤320px.
   Con 70vw el logo escala fluidamente y nunca toca los bordes en pantallas pequeñas. */
.splash__logo{ width: clamp(200px, 70vw, 620px); }
.splash__shine{
  opacity: 0.25;
  filter: blur(1.2px);
  mix-blend-mode: soft-light;
}


/* Hide edit-only controls in Solo ver */
html:not(.is-edit) [data-edit-only="1"]{ display:none !important; }


/* Themed selects (modals) */
.modal select, .panel select{
  appearance:none;
  -webkit-appearance:none;
  background-image: linear-gradient(45deg, transparent 50%, rgba(220,220,230,.85) 50%),
                    linear-gradient(135deg, rgba(220,220,230,.85) 50%, transparent 50%);
  background-position: calc(100% - 18px) 50%, calc(100% - 12px) 50%;
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
  padding-right: 34px;
}


/* Difficulty buttons (modal) */
.diffButtons{ display:flex; gap:10px; }
.diffButtons .pill{ flex:1; }
.pill{ border:1px solid rgba(0,210,255,.18); background: rgba(0,0,0,.18); color: rgba(220,220,230,.92); padding:10px 12px; border-radius:999px; cursor:pointer; }
.pill.is-active{ border-color: rgba(0,210,255,.55); box-shadow: 0 0 0 2px rgba(0,210,255,.10) inset, 0 0 18px rgba(0,210,255,.12); }
.pill--easy.is-active{ border-color: rgba(0,210,255,.65); }
.pill--medium.is-active{ border-color: rgba(114,26,255,.55); }
.pill--hard.is-active{ border-color: rgba(255,90,90,.55); }


/* Events / Bosses — redesigned layout (V2.068) */
/* Goals:
   - Clean, ordered hierarchy
   - Card looks intentional (title integrated with artwork)
   - Locked state feels like silhouette / mystery
   - Single requirement line visible (unlock OR eligibility)
   - Modal feels premium + readable on all resolutions
*/

:root{
  --evCardBg: rgba(0,0,0,.22);
  --evCardBorder: rgba(0,210,255,.16);
  --evCardBorderHover: rgba(0,210,255,.32);
  --evInk: rgba(240,245,255,.94);
  --evMuted: rgba(220,220,230,.72);
}

.gridCards--events{
  align-items: stretch;
}

/* ===== Cards ===== */
.evCard{
  position:relative;
  display:flex;
  flex-direction:column;
  text-align:left;
  padding:12px;
  border-radius:20px;
  border:1px solid var(--evCardBorder);
  background: var(--evCardBg);
  box-shadow: 0 18px 50px rgba(0,0,0,.38);
  cursor:pointer;
  gap:10px;
  min-height: 0;
  transition: transform .08s ease, border-color .15s ease, box-shadow .15s ease;
}
.evCard:hover{
  border-color: var(--evCardBorderHover);
  box-shadow: 0 18px 55px rgba(0,0,0,.42);
}
.evCard:active{ transform: translateY(1px); }
.evCard:focus-visible{
  outline: none;
  box-shadow: 0 0 0 2px rgba(0,210,255,.22), 0 18px 55px rgba(0,0,0,.42);
}

/* Artwork area */
.evCard__media{
  position:relative;
  width:100%;
  border-radius:16px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.06);
  background: rgba(0,0,0,.26);
}
.evCard__img{
  width:100%;
  aspect-ratio: 3/4;
  background:
    radial-gradient(260px 220px at 40% 28%, rgba(0,210,255,.12), rgba(0,0,0,0) 60%),
    rgba(0,0,0,.22);
  background-size: cover;
  background-position: center;
  transform: scale(1.02);
}

/* Overlay and title integrated on artwork */
.evCard__overlay{
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    linear-gradient(to top, rgba(0,0,0,.88), rgba(0,0,0,.35) 55%, rgba(0,0,0,.10));
}
.evCard__titleOnArt{
  position:absolute;
  left:12px;
  right:12px;
  bottom:12px;
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:10px;
  pointer-events:none;
}
.evCard__title{
  font-weight: 950;
  letter-spacing:.3px;
  color: var(--evInk);
  line-height:1.05;
  text-shadow: 0 12px 30px rgba(0,0,0,.55);
  max-width: 80%;
}
.evCard__chev{
  width:30px;
  height:30px;
  border-radius:999px;
  display:grid;
  place-items:center;
  border:1px solid rgba(0,210,255,.18);
  background: rgba(0,0,0,.20);
  color: rgba(240,245,255,.90);
  box-shadow: 0 10px 24px rgba(0,0,0,.35);
}

/* Pills */
.evCard__pills{
  position:absolute;
  left:10px;
  right:10px;
  top:10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  pointer-events:none;
}
.evPill{
  display:inline-flex;
  align-items:center;
  height:28px;
  padding:0 12px;
  border-radius:999px;
  font-size:12px;
  letter-spacing:.8px;
  text-transform:uppercase;
  border:1px solid rgba(0,210,255,.22);
  background: rgba(0,0,0,.30);
  color: rgba(240,245,255,.92);
  backdrop-filter: blur(8px);
}
.evPill--kind{ border-color: rgba(255,215,120,.22); }
.evCard.is-locked .evPill--state{ border-color: rgba(255,90,90,.20); }
.evCard.is-unlocked .evPill--state{ border-color: rgba(120,255,180,.18); }
.evCard.is-eligible .evPill--state{ box-shadow: 0 0 0 2px rgba(255,200,80,.10) inset; }

/* Requirement line */
.evCard__req{
  display:flex;
  gap:10px;
  align-items:flex-start;
  padding:2px 2px 0;
  min-height: 0;
}
.evReqIcon{
  width:26px;
  height:26px;
  flex:0 0 auto;
  border-radius:10px;
  display:grid;
  place-items:center;
  border:1px solid rgba(0,210,255,.14);
  background: rgba(0,0,0,.18);
  color: rgba(240,245,255,.82);
}
.evReqText{
  color: var(--evMuted);
  font-size: 13px;
  line-height: 1.25;
  margin-top: 3px;
}

/* Locked “mystery” treatment */
.evCard.is-locked .evCard__img{
  filter: grayscale(1) contrast(1.22) brightness(.62);
}
.evCard.is-locked .evCard__overlay{
  background:
    radial-gradient(260px 200px at 50% 30%, rgba(0,0,0,0), rgba(0,0,0,.55)),
    linear-gradient(to top, rgba(0,0,0,.92), rgba(0,0,0,.50) 55%, rgba(0,0,0,.20));
}
.evCard.is-locked .evCard__title{
  letter-spacing: 2.6px;
  opacity: .78;
}

/* ===== Modal (premium + ordered) ===== */
.modal__card--event{
  max-width: 1040px;
  width: min(1040px, calc(100vw - 24px));
  max-height: min(92vh, 860px);
  overflow: hidden;
}

/* Header */
.evModalHead{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:14px;
  padding: 16px 18px 12px;
  border-bottom: 1px solid rgba(255,255,255,.06);
  background:
    radial-gradient(900px 260px at 20% -30%, rgba(0,210,255,.12), transparent 55%),
    rgba(10,12,18,.88);
  backdrop-filter: blur(10px);
}
.evModalHead__left{ min-width: 0; display:flex; flex-direction:column; gap:8px; }
.evModalKickerRow{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:8px;
}
.evTag{
  display:inline-flex;
  align-items:center;
  height:28px;
  padding:0 12px;
  border-radius:999px;
  font-size:12px;
  letter-spacing:.9px;
  text-transform:uppercase;
  border:1px solid rgba(255,215,120,.22);
  background: rgba(0,0,0,.24);
  color: rgba(240,245,255,.92);
}
.evChip{
  display:inline-flex;
  align-items:center;
  height:28px;
  padding:0 12px;
  border-radius:999px;
  font-size:12px;
  letter-spacing:.9px;
  text-transform:uppercase;
  border:1px solid rgba(0,210,255,.22);
  background: rgba(0,0,0,.24);
  color: rgba(240,245,255,.92);
}
.evChip--state{ opacity:.95; }
.evChip--elig{ border-color: rgba(255,200,80,.18); }

#eventModalTitle{
  margin:0;
  font-size: 28px;
  line-height: 1.05;
  letter-spacing: .2px;
}
.evModalSubtitle{
  color: rgba(220,220,230,.70);
  font-size: 13px;
  line-height: 1.25;
  max-width: 70ch;
}

/* Close button */
#btnEventClose.iconBtn{
  width: 42px;
  height: 42px;
  border-radius: 14px;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(0,0,0,.24);
  color: rgba(240,245,255,.92);
}
#btnEventClose.iconBtn:hover{ border-color: rgba(0,210,255,.28); }

/* Body grid */
.eventModalGrid{
  display:grid;
  grid-template-columns: minmax(300px, 380px) 1fr;
  gap: 18px;
  padding: 16px 18px 18px;
  align-items: stretch;
}

/* Artwork */
.eventModalImgWrap{
  position:relative;
  border-radius:22px;
  border:1px solid rgba(255,255,255,.07);
  overflow:hidden;
  background: rgba(0,0,0,.28);
  min-height: 360px;
}
.eventModalImg{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  transform: scale(1.03);
}
.eventModalImg.is-locked{ filter: grayscale(1) contrast(1.15) brightness(.70); }

.eventModalImgShade{
  position:absolute;
  inset:0;
  background:
    radial-gradient(80% 70% at 50% 28%, rgba(0,210,255,.12), transparent 55%),
    linear-gradient(to top, rgba(0,0,0,.88), rgba(0,0,0,.30) 55%, rgba(0,0,0,.10));
}
.eventModalImgStamp{
  position:absolute;
  left:14px;
  bottom:14px;
  padding:10px 12px;
  border-radius:16px;
  border:1px solid rgba(0,210,255,.16);
  background: rgba(0,0,0,.30);
  font-weight: 950;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: rgba(240,245,255,.92);
  backdrop-filter: blur(10px);
}

/* Right panel */
.eventModalInfo{
  min-width: 0;
  display:flex;
  flex-direction:column;
  gap: 12px;
}
.eventModalReqGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.eventModalReqBox{
  border:1px solid rgba(255,255,255,.07);
  background: rgba(0,0,0,.18);
  border-radius:18px;
  padding: 14px;
}
.eventModalReqTitle{
  font-weight: 900;
  font-size: 12px;
  letter-spacing: 1.1px;
  text-transform: uppercase;
  color: rgba(240,245,255,.90);
}
.eventModalReqText{
  margin-top: 8px;
  color: rgba(220,220,230,.78);
  font-size: 13px;
  line-height: 1.35;
}
.eventModalMini{
  margin-top:10px;
  font-size:12px;
  color: rgba(220,220,230,.64);
}
.miniMeter{
  margin-top:10px;
  height:10px;
  border-radius:999px;
  overflow:hidden;
  border:1px solid rgba(0,210,255,.14);
  background: rgba(0,0,0,.22);
}
.miniMeter__fill{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, rgba(0,210,255,.85), rgba(255,255,255,.35));
}

/* Actions */
.eventModalActions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  padding-top: 2px;
}
.eventModalActions .btn{
  border-radius: 14px;
}
.eventModalActions .btnPrimary{
  min-width: 180px;
}
.eventModalFoot{
  margin-top:auto;
  color: rgba(220,220,230,.58);
  font-size: 12px;
}

/* Responsive */
@media (max-width: 920px){
  .eventModalGrid{ grid-template-columns: 1fr; }
  .eventModalImgWrap{ min-height: 260px; }
  .eventModalReqGrid{ grid-template-columns: 1fr; }
  .evModalSubtitle{ max-width: 100%; }
}
@media (max-width: 560px){
  .modal__card--event{
    width: 100%;
    height: 100vh;
    height: 100dvh;
    max-height: 100vh;
    max-height: 100dvh;
    border-radius: 0;
  }
  .evModalHead{
    position: sticky;
    top: 0;
    z-index: 3;
  }
  .eventModalActions{
    position: sticky;
    bottom: 0;
    z-index: 3;
    padding: 10px 0 8px;
    background: linear-gradient(to top, rgba(10,12,18,.94), rgba(10,12,18,.62), transparent);
    backdrop-filter: blur(10px);
  }
}
@media (max-width: 420px){
  .evCard{ padding:10px; border-radius:18px; }
  .evCard__media{ border-radius:14px; }
  .evPill, .evTag, .evChip{ height:26px; padding:0 10px; font-size:11px; }
  #eventModalTitle{ font-size: 24px; }
}

/* --- V2.00.031 additions --- */
html:not(.is-edit) [data-edit-only="1"]{
  display:none !important;
}

.input--select{
  -webkit-appearance:none;
  appearance:none;
  padding-right:34px;
  background-image: linear-gradient(45deg, transparent 50%, rgba(0,210,255,.9) 50%),
                    linear-gradient(135deg, rgba(0,210,255,.9) 50%, transparent 50%);
  background-position: calc(100% - 18px) calc(50% - 3px), calc(100% - 13px) calc(50% - 3px);
  background-size: 6px 6px, 6px 6px;
  background-repeat:no-repeat;
  background-color: #121724;
}

.diffPick{
  display:flex;
  gap:8px;
  align-items:center;
}
.diffPick .pill{
  flex:1;
  justify-content:center;
  border-color: var(--borderSoft);
  background: rgba(255,255,255,0.03);
  color: var(--text);
}
.diffPick .pill.is-active{
  font-weight: 700;
  box-shadow: 0 0 0 2px rgba(255,255,255,0.06);
}
.diffPick .pill[data-diff="easy"].is-active{
  border-color: var(--accent);
  background: rgba(34,211,238,0.22);
  color: rgba(232,236,244,0.96);
  box-shadow: 0 0 0 2px rgba(34,211,238,0.18), 0 0 18px rgba(34,211,238,0.18);
}
.diffPick .pill[data-diff="medium"].is-active{
  border-color: rgba(251,191,36,0.80);
  background: rgba(251,191,36,0.22);
  color: rgba(232,236,244,0.96);
  box-shadow: 0 0 0 2px rgba(251,191,36,0.14), 0 0 18px rgba(251,191,36,0.18);
}
.diffPick .pill[data-diff="hard"].is-active{
  border-color: var(--danger);
  background: rgba(248,113,113,0.22);
  color: rgba(232,236,244,0.96);
  box-shadow: 0 0 0 2px rgba(248,113,113,0.14), 0 0 18px rgba(248,113,113,0.14);
}

/* Asegura contraste en el modal (evita texto oscuro al activar dificultad) */
#challengeModal .diffPick .pill.is-active{ color: rgba(232,236,244,0.96) !important; }

.badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  line-height:1;
}


/* --- V2_00.032 fixes: Challenges readability + chips spacing --- */
.challengeItem .chips, .challengeItem .challengeChips, .challengeMeta, .challengeDetailMeta{
  display:flex !important;
  flex-wrap:wrap;
  gap:8px !important;
  align-items:center;
}
.badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:4px 10px;
  min-height:26px;
  line-height:1;
  border-radius:999px;
  white-space:nowrap;
}
/* modal selects */
.input--select, select.input{
  -webkit-appearance:none;
  appearance:none;
  background: rgba(0,0,0,0.22);
  border: 1px solid rgba(255,255,255,0.12);
  color: rgb(232,236,244);
  border-radius: 12px;
  padding-right: 34px;
}
.selectWrap{ position:relative; }
.selectWrap::after{
  content:"▾";
  position:absolute;
  right:12px; top:50%;
  transform: translateY(-50%);
  color: rgba(0,210,255,.8);
  pointer-events:none;
}




/* =============================
   v23 — Detalle de desafío más claro y atractivo
   ============================= */

/* Caja de estado (derecha) en el encabezado */
/* Caja de estado (derecha) en el encabezado: más compacta (sin ocupar media tarjeta) */
#challengeDetailBadges{ display:flex; align-items:center; justify-content:flex-end; gap:8px; }


/* Pills del detalle (más "tarjeta", menos elipse) */

/* Pills dentro de la tarjeta de desafío (columna central) */
.challengeMetaRow{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
.challengeMetaRow .chPill{ padding:6px 9px; border-radius: 13px; font-size: 12px; }
.challengeItem.is-selected .challengeMetaRow .chPill{ filter: brightness(1.08); }

.chPill{
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 7px 10px;
  border-radius: 14px;
  font-size: 12.5px;
  line-height: 1;
  font-weight: 900;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.03);
  color: var(--text, #e8ecf4);
  white-space: nowrap;
}
.chPill .i{ width: 18px; text-align:center; opacity: .95; }
.chPill--easy{ border-color: rgba(34,211,238,0.55); background: rgba(34,211,238,0.12); }
.chPill--medium{ border-color: rgba(114,26,255,0.55); background: rgba(114,26,255,0.12); }
.chPill--hard{ border-color: rgba(255,90,90,0.55); background: rgba(255,90,90,0.12); }
.chPill--xp{ border-color: rgba(251,191,36,0.42); background: rgba(251,191,36,0.14); }
.chPill--status{ border-color: rgba(255,255,255,0.10); background: rgba(255,255,255,0.03); }
.chPill--status.is-done{ border-color: rgba(34,211,238,0.40); background: rgba(34,211,238,0.10); }

/* Botón de estado (Pendiente / Completado) — solo edición */
.pill--status{ border-color: rgba(255,255,255,0.10) !important; background: rgba(255,255,255,0.03) !important; }
.pill--status.is-done,
.pill--status.is-active{ border-color: rgba(34,211,238,0.42) !important; background: rgba(34,211,238,0.12) !important; }

/* Acciones por desafío en la lista (editar/borrar), sin robar espacio al detalle */
.chItemActions{
  position:absolute;
  top: 10px;
  right: 10px;
  display:flex;
  gap: 8px;
  z-index: 30;
  opacity: 0;
  pointer-events:none;
  transform: translateY(-2px);
  transition: opacity .14s ease, transform .14s ease;
}
html.is-edit .chItemActions{ opacity: 1; pointer-events:auto; transform: translateY(0); }

.chIconBtn{
  width: 34px;
  height: 34px;
  border-radius: 12px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(0,0,0,0.22);
  color: rgba(232,236,244,0.92);
  cursor:pointer;
}
.chIconBtn:hover{ border-color: rgba(34,211,238,0.35); background: rgba(34,211,238,0.08); }
.chIconBtn--danger:hover{ border-color: rgba(255,90,90,0.45); background: rgba(255,90,90,0.10); }

/* Modal: formulario de desafío sin encimados */
.challengeFormGrid{
  display:grid;
  grid-template-columns: 220px 1fr 150px;
  gap: 12px;
  align-items:end;
}

/* Modal: materia dropdown like main */
.challengeFormGrid #chModalSubjectDropdown{ width:100%; }
.challengeFormGrid #btnChModalSubject{ width:100%; justify-content:space-between; }
.challengeFormGrid #chModalSubjectMenu{ left:0; right:auto; width:100%; min-width:unset; max-height:260px; overflow:auto; }

@media (max-width: 720px){
  .challengeFormGrid{ grid-template-columns: 1fr; }
  .challengeFormGrid .field--diff .diffPick{ width:100%; }
}

.challengeFormGrid__diff{ grid-column: 1 / -1; }
@media (max-width: 640px){
  .challengeFormGrid{ grid-template-columns: 1fr; }
  .challengeFormGrid__diff{ grid-column: 1; }
}

/* Instrucciones: más legibles y con acento lateral */
.page[data-page="desafios"] .challengeBody{
  position: relative;
  background: rgba(0,0,0,0.34);
  border-color: rgba(255,255,255,0.10);
  padding: 16px 16px 16px 18px;
  font-size: 16px;
  line-height: 1.5;
  box-shadow: 0 14px 44px rgba(0,0,0,0.50);
}
.page[data-page="desafios"] .challengeBody::before{
  content:"";
  position:absolute;
  left:0; top:0; bottom:0;
  width: 4px;
  border-radius: 16px 0 0 16px;
  background: rgba(34,211,238,0.65);
  box-shadow: 0 0 18px rgba(34,211,238,0.18);
}
.chInstrLabel{
  font-size: 12px;
  letter-spacing: 1.6px;
  text-transform: uppercase;
  color: rgba(232,236,244,0.62);
  margin-bottom: 10px;
}
.chBodyP{ margin: 0 0 10px; }
.chBodyList{ margin: 0 0 10px 18px; }


/* ===== Modal (Nuevo/Editar desafío) — look like Desafíos cards ===== */
#challengeModal .modal__card{
  background: rgba(13,16,22,0.96);
  border: 1px solid rgba(255,255,255,0.12);
  box-shadow: 0 28px 90px rgba(0,0,0,0.70);
}
#challengeModal .modal__header .cardTitle{ font-weight: 900; letter-spacing: .4px; }
#challengeModal .field{ display:grid; gap: 6px; }
#challengeModal .label{ color: rgba(232,236,244,0.72); font-size: 12px; letter-spacing: 1.2px; text-transform: uppercase; }
#challengeModal .input, #challengeModal .textarea, #challengeModal select.input, #challengeModal .input--select{
  background: rgba(0,0,0,0.26);
  border: 1px solid rgba(255,255,255,0.12);
  color: rgba(232,236,244,0.94);
}
#challengeModal .input:focus, #challengeModal .textarea:focus, #challengeModal select:focus{
  outline: none;
  border-color: rgba(34,211,238,0.42);
  box-shadow: 0 0 0 2px rgba(34,211,238,0.12);
}
#challengeModal .diffPick .pill{ border-color: rgba(255,255,255,0.14); background: rgba(0,0,0,0.16); }
#challengeModal .diffPick .pill.is-active{
  font-weight: 700;
  /* El color final lo define el data-diff (easy/medium/hard) más abajo */
  box-shadow: 0 0 0 2px rgba(255,255,255,0.06);
}

/* Evita que el dropdown de materias quede visible mientras hay un modal */
.is-modal-open #subjectDropdown .dropdown__menu{ display:none !important; }

/* Modal fields: match page look */
.modal .input,
.modal .textarea,
.modal select.input{
  background: #121724;
  border: 1px solid #1B2333;
  color: var(--text);
}

/* Fuerza tema oscuro también en dropdowns nativos (cuando el navegador lo soporta) */
.modal{ color-scheme: dark; }
.modal select.input{ color-scheme: dark; }
.modal select.input option{
  background: #0D1016;
  color: rgb(232,236,244);
}
.modal select.input option:checked{
  background: rgba(34,211,238,0.18);
  color: rgb(232,236,244);
}
.modal .input:focus,
.modal .textarea:focus,
.modal select.input:focus{
  outline: none;
  border-color: rgba(34,211,238,0.55);
  box-shadow: 0 0 0 3px rgba(34,211,238,0.12);
}
.modal .formCard{
  background: #121724;
  border: 1px solid #1B2333;
}
.modal__header{ background: #0D1016; }

/* Difficulty picker coloring */
.field--diff .diffPick{ width:100%; }
.field--diff .diffPick .pill{ flex:1; justify-content:center; }
.field--diff .diffPick .pill.is-active{
  font-weight: 700;
  color: rgb(232,236,244);
  border-color: rgba(255,255,255,0.12);
}
.field--diff .diffPick .pill.is-active[data-diff="easy"]{
  background: rgba(34,211,238,0.18);
  border-color: rgba(34,211,238,0.55);
}
.field--diff .diffPick .pill.is-active[data-diff="medium"]{
  background: rgba(251,191,36,0.18);
  border-color: rgba(251,191,36,0.55);
}
.field--diff .diffPick .pill.is-active[data-diff="hard"]{
  background: rgba(248,113,113,0.18);
  border-color: rgba(248,113,113,0.55);
}

/* --- Modal: dificultad (más notorio + resiliente) --- */
#challengeModal .field--diff .diffPick{
  /* JS: data-active="easy|medium|hard" */
  --diff-bg: rgba(255,255,255,0.06);
  --diff-bd: rgba(255,255,255,0.14);
  --diff-tx: rgba(240,244,252,0.95);
}
#challengeModal .field--diff .diffPick .pill{
  transition: background .15s ease, border-color .15s ease, box-shadow .15s ease, color .15s ease;
}
#challengeModal .field--diff .diffPick .pill.is-active,
#challengeModal .field--diff .diffPick[data-active="easy"] .pill[data-diff="easy"],
#challengeModal .field--diff .diffPick[data-active="medium"] .pill[data-diff="medium"],
#challengeModal .field--diff .diffPick[data-active="hard"] .pill[data-diff="hard"]{
  color: var(--diff-tx) !important;
  background: var(--diff-bg) !important;
  border-color: var(--diff-bd) !important;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.06) inset, 0 10px 28px rgba(0,0,0,0.35);
}
#challengeModal .field--diff .diffPick[data-active="easy"]{
  --diff-bg: rgba(34,211,238,0.22);
  --diff-bd: rgba(34,211,238,0.65);
}
#challengeModal .field--diff .diffPick[data-active="medium"]{
  --diff-bg: rgba(251,191,36,0.22);
  --diff-bd: rgba(251,191,36,0.65);
}
#challengeModal .field--diff .diffPick[data-active="hard"]{
  --diff-bg: rgba(248,113,113,0.22);
  --diff-bd: rgba(248,113,113,0.68);
}


/* Eventos/Jefes: resalta cuando el héroe actual ya puede retar */
.evCard.is-eligible .evCard__media{
  box-shadow: 0 0 0 2px rgba(255,200,80,.18), 0 18px 50px rgba(0,0,0,.45);
  border-color: rgba(255,200,80,.22);
}

/* Level-up medal hint (shown near end of level) */
.medalGateHint{
  padding: 10px 12px;
  border-radius: 12px;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  color: rgba(255,255,255,0.92);
  font-size: 13px;
  line-height: 1.35;
  margin: 10px 0 10px 0;
}
.medalGateHint b{ color: rgba(255,255,255,0.98); }
.medalGateHint .ok{ color: rgba(180,255,200,0.98); }
.medalGateHint .warn{ color: rgba(255,220,150,0.98); }



/* === Boss/Event modal overrides (full-bleed, no top bar, brighter art) === */
.modal__card--event{ padding:0 !important; overflow:hidden; }
.evModalHead{
  background: transparent !important;
  border: 0 !important;
  padding: 0 !important;
}
.evModalHead__left{ display:none !important; }
#eventModalTitle, #eventModalSubtitle{ display:none !important; }

#btnEventClose.iconBtn{
  position:absolute;
  top: 14px;
  right: 14px;
  z-index: 10;
  background: rgba(10,12,16,.35);
  border: 1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(10px);
}

.eventModalGrid{
  position:relative;
  padding:0 !important;
  min-height: min(78vh, 720px);
}
.eventModalImgWrap{
  position:absolute;
  inset:0;
  border-radius: 24px;
  overflow:hidden;
}
.eventModalImg{
  position:absolute;
  inset:0;
  background-size: cover;
  background-position: center;
  /* brighten unlocked art */
  filter: brightness(1.20) contrast(1.06) saturate(1.06);
}
.eventModalImg.is-locked{
  filter: grayscale(1) contrast(1.12) brightness(.72);
}
.eventModalImgShade{
  position:absolute;
  inset:0;
  /* much lighter on top; readability only at bottom */
  background: linear-gradient(to bottom,
    rgba(0,0,0,0.00) 0%,
    rgba(0,0,0,0.10) 55%,
    rgba(0,0,0,0.48) 100%);
  pointer-events:none;
}
.eventModalInfo{
  position:absolute;
  left: 16px;
  right: 16px;
  bottom: 16px;
  z-index: 6;
}
.eventModalReqGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  max-width: 980px;
  margin: 0 auto;
}
.eventModalReqBox{
  background: rgba(10,12,16,.52) !important;
  border: 1px solid rgba(255,255,255,.10) !important;
  backdrop-filter: blur(14px);
}
@media (max-width: 820px){
  .eventModalReqGrid{ grid-template-columns: 1fr; }
  .eventModalGrid{ min-height: min(80vh, 760px); }

  /* Event cards: ajustar tamaño de título en arte */
  .evCard__title{ font-size: clamp(14px, 3.5vw, 18px); }
}

/* --- iPad mini y tablets pequeñas (≤ 768px) --- */
@media (max-width: 768px){
  /* Modal de evento: fullscreen para mejor aprovechamiento */
  .modal__card--event{
    width: 100%;
    max-width: 100%;
    height: 100vh;
    height: 100dvh;
    max-height: 100vh;
    max-height: 100dvh;
    border-radius: 0;
  }
  .eventModalImgWrap{
    border-radius: 0;
  }
  .eventModalGrid{
    min-height: 100vh;
    min-height: 100dvh;
  }

  /* Close button con espacio para safe-area */
  #btnEventClose.iconBtn{
    top: max(14px, env(safe-area-inset-top, 14px));
    right: max(14px, env(safe-area-inset-right, 14px));
    width: 44px;
    height: 44px;
  }

  /* Info panel en la parte inferior */
  .eventModalInfo{
    left: 12px;
    right: 12px;
    bottom: max(12px, env(safe-area-inset-bottom, 12px));
  }

  /* Req boxes más compactos */
  .eventModalReqBox{
    padding: 10px !important;
    border-radius: 14px;
  }
  .eventModalReqTitle{ font-size: 11px; }
  .eventModalReqText{ font-size: 12px; margin-top: 6px; }
  .eventModalMini{ font-size: 11px; margin-top: 6px; }
  .miniMeter{ margin-top: 6px; height: 8px; }

  /* Actions más compactas */
  .eventModalActions{
    gap: 8px;
    padding-top: 8px;
    padding-bottom: max(4px, env(safe-area-inset-bottom, 0px));
  }
  .eventModalActions .btnPrimary{
    min-width: 140px;
    padding: 10px 16px;
    font-size: 14px;
  }

  /* Shade más oscuro en la parte inferior para legibilidad */
  .eventModalImgShade{
    background: linear-gradient(to bottom,
      rgba(0,0,0,0.00) 0%,
      rgba(0,0,0,0.08) 40%,
      rgba(0,0,0,0.55) 75%,
      rgba(0,0,0,0.78) 100%);
  }
}

/* --- Teléfonos (≤ 560px) --- */
@media (max-width: 560px){
  /* evModalPills: solo mostrar los que quepan */
  .evModalPills{
    flex-wrap: wrap;
    gap: 6px;
  }
  .evModalPills .pill--mini{
    font-size: 10px;
    padding: 4px 8px;
    min-height: 24px;
  }

  /* Event cards: imagen con aspect-ratio más cuadrado en pantallas pequeñas */
  .evCard__img{
    aspect-ratio: 4/5;
  }

  /* Req grid: 1 columna, más compacto */
  .eventModalReqGrid{
    gap: 8px;
  }

  /* Modal actions: usar toda la anchura */
  .eventModalActions{
    justify-content: stretch;
  }
  .eventModalActions .btn{
    flex: 1;
    text-align: center;
    justify-content: center;
  }
}

/* --- Teléfonos muy pequeños (≤ 380px) --- */
@media (max-width: 380px){
  .evCard{ padding: 8px; gap: 8px; }
  .evCard__media{ border-radius: 12px; }
  .evCard__titleOnArt{
    left: 8px;
    right: 8px;
    bottom: 8px;
  }
  .evCard__title{ font-size: 13px; }
  .evCard__chev{ width: 24px; height: 24px; font-size: 14px; }
  .evReqText{ font-size: 12px; }
  .evReqIcon{ width: 22px; height: 22px; font-size: 11px; }

  /* Modal info: más compacto */
  .eventModalInfo{
    left: 8px;
    right: 8px;
    bottom: max(8px, env(safe-area-inset-bottom, 8px));
  }
  .eventModalReqBox{
    padding: 8px !important;
    border-radius: 12px;
  }
}

/* --- Landscape en móvil para el modal --- */
@media (max-height: 500px) and (orientation: landscape){
  .eventModalGrid{
    min-height: 100vh;
    min-height: 100dvh;
  }
  .eventModalInfo{
    bottom: 8px;
  }
  .eventModalReqGrid{
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }
  .eventModalReqBox{
    padding: 8px !important;
  }
  .eventModalActions .btnPrimary{
    min-width: 120px;
    padding: 8px 12px;
  }
}

/* Boss battle full-screen modal */
.bossBattle{
  position: fixed;
  inset: 0;
  /* Por encima de .topbar (z-index:20000) y .bottomNav (z-index:10000) */
  z-index: 25000;
  display: flex;
  overflow: hidden;
}

/* Layer 1: Scene Background (escenario) */
.bossBattle__sceneBg{
  position: absolute;
  inset: 0;
  background-size: cover;
  background-position: center;
  transform: scale(1.08);
  filter: saturate(1.1) contrast(1.05) brightness(.65);
  animation: bossBattlePan 14s ease-in-out infinite alternate;
}

/* Layer 2: Jefe (personaje) */
.bossBattle__jefe{
  position: absolute;
  bottom: 0;
  right: 5%;
  height: 75vh;
  max-height: 800px;
  object-fit: contain;
  object-position: bottom;
  z-index: 2;
  transition: opacity 0.3s, filter 0.3s, transform 0.3s;
  pointer-events: none;
}

/* Estados del jefe */
.bossBattle__jefe--idle{
  animation: bossIdle 3s ease-in-out infinite;
}

.bossBattle__jefe--mock{
  animation: bossMock 0.6s ease infinite;
}

.bossBattle__jefe--hit{
  /* bossHit   → sacudida lateral (0.5s)
     bossFlash → destello blanco RÁPIDO que desaparece a los ~120ms,
                 dejando ver los colores originales el resto de la animación */
  animation: bossHit 0.5s ease, bossFlash 0.30s ease forwards;
}

/* Animaciones del jefe */
@keyframes bossIdle {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

@keyframes bossMock {
  0%, 100% { transform: scale(1) rotate(0deg); }
  25% { transform: scale(1.03) rotate(-2deg); }
  75% { transform: scale(1.03) rotate(2deg); }
}

@keyframes bossHit {
  0% { transform: translateX(0) scale(1); }
  25% { transform: translateX(-20px) scale(0.98); }
  50% { transform: translateX(15px) scale(0.96); }
  75% { transform: translateX(-10px) scale(0.98); }
  100% { transform: translateX(0) scale(1); }
}

/* Destello de impacto: blanco total al inicio, colores normales a los ~120ms */
@keyframes bossFlash {
  0%   { filter: brightness(3) saturate(0) contrast(2); }
  40%  { filter: brightness(1.5) saturate(0.3); }
  100% { filter: brightness(1) saturate(1); }
}

/* Layer 3: Shade (oscurecimiento suave — la legibilidad viene del fondo propio de cada elemento) */
.bossBattle__shade{
  position: absolute;
  inset: 0;
  z-index: 3;
  background:
    radial-gradient(circle at center, rgba(12,16,24,.04), rgba(4,6,10,.48) 70%),
    linear-gradient(180deg, rgba(2,5,10,.08), rgba(2,5,10,.42));
  pointer-events: none;
}

/* Animación del fondo */
@keyframes bossBattlePan {
  from { transform: scale(1.08) translate3d(-1.5%, -1%, 0); }
  to { transform: scale(1.12) translate3d(1.5%, 1%, 0); }
}

/* Layer 4: HUD (interfaz de usuario) */
.bossBattle__hud{
  position: relative;
  z-index: 10;
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;
  padding: clamp(20px, 3vw, 40px);
  padding-bottom: clamp(30px, 5vh, 60px);
}

/* Botón cerrar */
.bossBattle__close{
  position: absolute;
  top: 20px;
  right: 20px;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,.4);
  background: rgba(7,12,18,.85);
  color: #fff;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.2s;
  z-index: 100;
}
.bossBattle__close:hover{
  background: rgba(255,50,50,.85);
  transform: scale(1.1);
}

/* ── Nameplate del héroe (esquina superior izquierda) ── */
.bossBattle__heroPlate{
  position: absolute;
  top: 20px;
  left: 20px;
  z-index: 50;
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px 6px 10px;
  background: rgba(13,16,22,0.78);
  border: 1px solid rgba(125,210,255,0.28);
  border-radius: 30px;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow: 0 4px 14px rgba(0,0,0,0.35);
}

.bossBattle__heroIcon{
  font-size: 15px;
  line-height: 1;
}

.bossBattle__heroName{
  font-size: 13px;
  font-weight: 800;
  color: #7dd2ff;
  letter-spacing: 0.3px;
  text-shadow: 0 1px 4px rgba(0,0,0,0.6);
  white-space: nowrap;
}

/* ── Info del jefe: nombre + HP, flotando cerca de la imagen ── */
.bossBattle__bossInfo{
  position: absolute;
  bottom: clamp(22px, 5vh, 60px);
  right: clamp(16px, 3vw, 36px);
  z-index: 20;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 10px;
}

.bossBattle__bossName{
  font-size: clamp(15px, 2vw, 22px);
  font-weight: 900;
  color: #fff;
  letter-spacing: 0.5px;
  text-shadow: 0 2px 10px rgba(0,0,0,.9), 0 0 18px rgba(255,80,60,.45);
  padding: 6px 18px;
  background: rgba(70,8,8,0.62);
  border: 1px solid rgba(255,100,70,0.38);
  border-radius: 20px;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  white-space: nowrap;
}

/* ── Barra de vida del jefe ── */
.bossBattle__health{
  display: flex;
  align-items: center;
  gap: 8px;
}

.bossBattle__healthLabel{
  font-size: 12px;
  font-weight: 900;
  color: #ff6b6b;
  text-shadow: 0 1px 3px rgba(0,0,0,.6);
  letter-spacing: 0.5px;
}

.bossBattle__healthBar{
  width: 200px;
  height: 18px;
  background: rgba(0,0,0,0.55);
  border-radius: 10px;
  border: 1.5px solid rgba(255,100,70,0.40);
  overflow: hidden;
  position: relative;
}

.bossBattle__healthFill{
  height: 100%;
  width: 100%;
  background: linear-gradient(90deg, #ff4444, #ff8040, #ffb649);
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: inset 0 0 8px rgba(255,255,255,.3);
  animation: healthPulse 1.5s ease-in-out infinite;
}

@keyframes healthPulse {
  0%, 100% { filter: brightness(1); }
  50% { filter: brightness(1.18); }
}

/* Caja de pregunta */
.bossBattle__questionBox{
  position: relative;
  flex: 0 0 auto;
  margin-bottom: clamp(20px, 3vh, 35px);
  margin-top: 14px; /* espacio para que el badge no quede pegado al elemento anterior */
  padding: clamp(28px, 3.5vw, 38px) clamp(20px, 3vw, 35px) clamp(20px, 3vw, 30px);
  background: rgba(6,10,18,0.82);
  border-radius: 18px;
  border: 1.5px solid rgba(255,255,255,.20);
  box-shadow: 0 8px 28px rgba(0,0,0,.50);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

/* Badge de número de pregunta: sale por arriba del borde del box */
.bossBattle__counter{
  position: absolute;
  top: -13px;
  left: 18px;
  font-size: 12px;
  font-weight: 800;
  color: #ffd89a;
  background: rgba(18,10,2,0.90);
  padding: 3px 12px;
  border-radius: 20px;
  border: 1px solid rgba(255,216,154,.32);
  letter-spacing: 0.4px;
  text-transform: uppercase;
  white-space: nowrap;
}

.bossBattle__question{
  font-size: clamp(18px, 2.2vw, 28px);
  line-height: 1.4;
  font-weight: 700;
  color: #f0f8ff;
  text-align: center;
  text-shadow: 0 1px 5px rgba(0,0,0,.5);
}

/* Opciones en 2 columnas */
.bossBattle__options{
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: clamp(12px, 2vw, 18px);
  flex: 1;
  align-content: center;
  max-width: 1100px;
  margin: 0 auto;
  width: 100%;
}

.bossBattle__option{
  min-height: clamp(70px, 10vh, 90px);
  border-radius: 16px;
  border: 3px solid rgba(125,210,255,.45);
  background: rgba(17,28,40,.85);
  color: #e8f6ff;
  text-align: center;
  padding: clamp(12px, 2vw, 18px);
  font-size: clamp(16px, 2vw, 20px);
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(0,0,0,.4);
}

.bossBattle__option:hover:not(:disabled){
  transform: scale(1.03);
  border-color: rgba(125,210,255,.85);
  background: rgba(30,45,65,.95);
  box-shadow: 0 6px 18px rgba(125,210,255,.4);
}

.bossBattle__option:disabled{
  cursor: default;
}

.bossBattle__option.is-correct{
  border-color: rgba(90,255,145,.95);
  background: rgba(28,106,59,.95);
  color: #eaffef;
  animation: correctPulse 0.6s ease;
}

.bossBattle__option.is-incorrect{
  border-color: rgba(255,114,114,.95);
  background: rgba(124,30,30,.95);
  color: #ffecec;
  animation: incorrectShake 0.5s ease;
}

@keyframes correctPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

@keyframes incorrectShake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
}

/* Botón siguiente — círculo compacto con flecha, alineado a la derecha */
.bossBattle__next{
  margin-top: clamp(12px, 1.8vh, 20px);
  margin-left: auto;
  width: 54px;
  height: 54px;
  flex-shrink: 0;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,.28);
  background: linear-gradient(135deg, #ffd25d, #ff9f3b 50%, #ff6a2a);
  color: #1a0e00;
  font-size: 22px;
  font-weight: 900;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 5px 18px rgba(255,130,40,.45);
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
}

.bossBattle__next:hover:not(:disabled){
  transform: scale(1.10);
  box-shadow: 0 7px 24px rgba(255,130,40,.70);
}

.bossBattle__next:disabled{
  opacity: .45;
  filter: grayscale(.5);
  cursor: not-allowed;
}

/* === Escritorio: contenido a la izquierda, jefe grande a la derecha === */
@media (min-width: 769px) {
  /* Fondo ligeramente más claro en desktop */
  .bossBattle__sceneBg {
    filter: saturate(1.1) contrast(1.05) brightness(.86);
  }

  /* Shade: izquierda con suficiente oscuridad para legibilidad, derecha casi transparente */
  .bossBattle__shade {
    background:
      /* Zona del jefe (derecha): casi sin oscurecimiento */
      radial-gradient(ellipse 55% 85% at 78% 55%, rgba(4,6,10,.0), rgba(4,6,10,.18) 90%),
      /* Lado izquierdo: oscuro para legibilidad, fade hacia la derecha */
      linear-gradient(100deg, rgba(2,5,10,.62) 0%, rgba(2,5,10,.18) 40%, rgba(2,5,10,.0) 58%),
      /* Vignette inferior muy suave */
      linear-gradient(180deg, rgba(2,5,10,.04) 0%, rgba(2,5,10,.22) 100%);
  }

  /* Reservar el lado derecho para el jefe */
  .bossBattle__hud {
    padding-right: clamp(320px, 44vw, 820px);
  }

  /* Jefe: más grande en escritorio, sin límite de max-height */
  .bossBattle__jefe {
    height: 90vh;
    max-height: none;
    right: 2%;
  }

  /* Opciones: alineadas a la izquierda */
  .bossBattle__options {
    margin: 0;
    max-width: 760px;
  }

  /* bossInfo: en desktop queda en el área del jefe (derecha).
     Ajustar left para que no invada la zona de texto */
  .bossBattle__bossInfo {
    right: clamp(14px, 2.5vw, 32px);
    bottom: clamp(24px, 5vh, 64px);
  }
}

/* Responsive: móviles */
@media (max-width: 768px) {
  /* === Jefe: centrado horizontalmente, top 50% de pantalla === */
  .bossBattle__jefe {
    left: 0;
    right: 0;
    width: 85%;
    margin: 0 auto;
    top: 0;        /* sin offset: el jefe arranca desde arriba */
    bottom: 50%;   /* pies anclados al centro exacto */
    height: auto;
    max-height: none;
    object-fit: contain;
    object-position: center bottom;
  }

  /* === Shade: muy ligero en móvil, el jefe debe verse luminoso === */
  .bossBattle__shade {
    background:
      radial-gradient(ellipse 90% 55% at 50% 30%, transparent, rgba(4,6,10,.22) 80%),
      linear-gradient(180deg, rgba(2,5,10,.0) 0%, rgba(2,5,10,.36) 100%);
  }

  /* === HUD: el contenido baja al fondo por margin-top:auto en questionBox === */
  .bossBattle__hud {
    padding: 0 14px max(24px, env(safe-area-inset-bottom, 24px));
    overflow-y: auto;
  }

  /* === HeroPlate: oculto en móvil para no saturar la pantalla === */
  .bossBattle__heroPlate {
    display: none;
  }

  /* === BossInfo: centrado en la zona del jefe, justo encima del área de contenido === */
  .bossBattle__bossInfo {
    bottom: auto;
    right: auto;
    top: 38%;              /* en la parte baja de la zona del jefe */
    left: 50%;
    transform: translateX(-50%);
    align-items: center;
    flex-direction: column;
    gap: 6px;
    width: max-content;
    max-width: calc(100% - 32px);
  }

  .bossBattle__bossName {
    font-size: 14px;
    padding: 4px 14px;
  }

  .bossBattle__healthBar {
    width: 150px;
    height: 13px;
  }

  .bossBattle__healthLabel {
    font-size: 12px;
  }

  /* === Pregunta: margin-top:auto la empuja a la mitad inferior === */
  .bossBattle__questionBox {
    margin-top: auto;
    margin-bottom: 10px;
    padding: 22px 16px 14px; /* extra top para el badge */
  }

  .bossBattle__question {
    font-size: clamp(15px, 4vw, 22px);
  }

  /* === Opciones: 1 columna en portrait (≤768px cubre iPad Mini 6 portrait en 744px y menores) === */
  .bossBattle__options {
    grid-template-columns: 1fr;
    gap: 10px;
    flex: 0 0 auto;
  }

  .bossBattle__option {
    min-height: 52px;
    padding: 10px 12px;
    font-size: clamp(13px, 3.5vw, 16px);
    border-radius: 12px;
    border-width: 2px;
  }

  /* === Botón siguiente: mantenemos el círculo compacto === */
  .bossBattle__next {
    margin-top: 8px;
    width: 48px;
    height: 48px;
    font-size: 20px;
  }
}


/* Teléfono en landscape: jefe a la derecha, contenido a la izquierda (igual que desktop) */
@media (max-width: 768px) and (orientation: landscape) {
  .bossBattle__jefe {
    left: auto;
    right: 2%;
    width: auto;
    margin: 0;
    top: 0;
    bottom: 0;
    height: 100%;
    max-height: none;
    object-position: right bottom;
  }

  .bossBattle__hud {
    padding: 8px clamp(260px, 40vw, 440px) max(10px, env(safe-area-inset-bottom, 10px)) 14px;
    overflow-y: auto;
  }

  /* Shade: similar al desktop, muy ligero */
  .bossBattle__shade {
    background:
      radial-gradient(ellipse 55% 90% at 78% 55%, rgba(4,6,10,.0), rgba(4,6,10,.18) 90%),
      linear-gradient(100deg, rgba(2,5,10,.60) 0%, rgba(2,5,10,.16) 45%, rgba(2,5,10,.0) 62%),
      linear-gradient(180deg, rgba(2,5,10,.04) 0%, rgba(2,5,10,.22) 100%);
  }

  /* HeroPlate: vuelve a ser visible en landscape */
  .bossBattle__heroPlate {
    display: flex;
  }

  /* BossInfo: restaurar layout vertical alineado a la derecha */
  .bossBattle__bossInfo {
    top: auto;
    left: auto;
    transform: none;
    align-items: flex-end;
    flex-direction: column;
    bottom: clamp(14px, 3vh, 40px);
    right: clamp(12px, 2vw, 28px);
  }

  .bossBattle__questionBox {
    margin-top: 0;
    margin-bottom: 8px;
    padding: 22px 14px 12px;
  }

  .bossBattle__question {
    font-size: clamp(13px, 2.5vw, 17px);
  }

  .bossBattle__options {
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .bossBattle__option {
    min-height: 40px;
    padding: 6px 10px;
    font-size: 13px;
  }

  .bossBattle__next {
    margin-top: 6px;
    width: 44px;
    height: 44px;
    font-size: 18px;
  }
}

/* Teléfonos cortos (iPhone SE, Android compactos): alto ≤ 720px en portrait.
   El jefe pasa a ocupar el 40% superior (en vez del 50%)
   para dar 60% de espacio al contenido sin necesidad de scroll. */
@media (max-width: 768px) and (max-height: 720px) and (orientation: portrait) {
  .bossBattle__jefe {
    bottom: 60%; /* jefe en top 40% */
  }

  .bossBattle__bossInfo {
    top: 30%; /* ajustar a la nueva zona del jefe */
  }

  .bossBattle__option {
    min-height: 44px;
    padding: 7px 12px;
  }

  .bossBattle__questionBox {
    padding: 18px 14px 10px;
    margin-bottom: 6px;
  }

  .bossBattle__next {
    width: 44px;
    height: 44px;
    margin-top: 6px;
    font-size: 18px;
  }
}

#btnEventFight{
  background: linear-gradient(135deg, #ffe48a 0%, #ffc13d 36%, #ff8d2b 72%, #ff622b 100%);
  color: #220d00;
  border: 1px solid rgba(255,255,255,.4);
  font-weight: 900;
  letter-spacing: .4px;
  box-shadow: 0 12px 30px rgba(255,130,40,.32), inset 0 1px 0 rgba(255,255,255,.4);
}
#btnEventFight:disabled{
  filter: grayscale(.35);
  box-shadow: none;
}

/* Challenge list actions aligned with difficulty/xp pills */
.challengeMetaRow{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:8px;
}
.challengeMetaRow .chItemActions{
  position: static;
  margin-left: auto;
  display:flex;
  gap:8px;
  opacity: 1;
  pointer-events: auto;
  transform: none;
}
html:not(.is-edit) .challengeMetaRow .chItemActions{
  display:none !important;
}

/* Challenge modal: allow scrolling/editing long instructions */
#challengeModal .modal__card{
  max-height: min(90vh, 860px);
  overflow-y: auto;
}
#challengeModal #inChBody{
  min-height: 200px;
  max-height: 52vh;
  overflow-y: auto;
  resize: vertical;
  -webkit-overflow-scrolling: touch;
}
