/* ============================================
   OPTIMIZACIONES MÓVIL
   ============================================ */

/* Asegurar tamaños táctiles mínimos de 44x44px */
@media (max-width: 768px) {
  
  /* BOTONES - Tamaño mínimo para tocar fácilmente */
  .pill,
  .bottomNav__btn,
  button {
    min-height: 44px;
    min-width: 44px;
    padding: 12px 20px;
    font-size: 16px; /* Evitar zoom en iOS */
  }
  
  .pill--small {
    min-height: 40px;
    padding: 10px 16px;
    font-size: 15px;
  }
  
  /* INPUTS - Evitar zoom en iOS */
  input,
  textarea,
  select {
    font-size: 16px !important;
    min-height: 44px;
    padding: 12px;
  }
  
  textarea {
    min-height: 100px;
  }
  
  /* TEXTOS - Más grandes para legibilidad */
  .heroCard__name {
    font-size: 18px !important;
  }
  
  .heroCard__level {
    font-size: 28px !important;
  }
  
  .challengeItem__title {
    font-size: 17px !important;
    line-height: 1.4;
  }
  
  .challengeItem__subtitle {
    font-size: 14px !important;
  }
  
  .statBadge {
    font-size: 15px !important;
    padding: 6px 10px !important;
  }
  
  /* MEDALLAS - Muy visible */
  #heroMedalsCount {
    font-size: 32px !important;
    font-weight: 900;
  }
  
  /* XP BAR - Más grande */
  .xpBar {
    height: 12px !important;
    border-radius: 12px;
  }
  
  /* CARDS - Más espacio */
  .heroCard {
    padding: 20px;
    margin-bottom: 16px;
  }
  
  .card {
    padding: 20px;
  }
  
  /* CHALLENGES LIST - Mejor espaciado */
  .challengeItem {
    padding: 16px !important;
    margin-bottom: 12px !important;
  }
  
  /* MODALS - Pantalla completa en móvil pequeño */
  @media (max-width: 480px) {
    .modal__card {
      width: 100% !important;
      height: 100% !important;
      max-width: none !important;
      max-height: none !important;
      border-radius: 0 !important;
    }
    /* Event modal: el grid ocupa todo el alto */
    .modal__card--event .eventModalGrid{
      min-height: 100vh;
    }
    .modal__card--event .eventModalImgWrap{
      border-radius: 0;
    }
  }
  
  /* STATS - Indicadores más grandes */
  .statRange {
    height: 10px;
  }
  
  .statSeg {
    min-width: 8px;
  }
  
  /* BADGES - Más visibles */
  .badge {
    font-size: 14px !important;
    padding: 6px 12px !important;
  }
  
  .badge--mini {
    font-size: 13px !important;
    padding: 4px 10px !important;
  }
  
  /* PILLS GROUP - Espaciado para dedos */
  .diffPills {
    gap: 12px !important;
  }
  
  .diffPills .pill {
    flex: 1;
    min-width: 0;
  }
  
  /* EVENT CARDS (maqueta) - 2 columnas cuando haya espacio; 1 columna en pantallas muy chicas */
  .gridCards--events{
    grid-template-columns: repeat(2, minmax(150px, 1fr)) !important;
    gap: 14px !important;
  }
  @media (max-width: 380px){
    .gridCards--events{ grid-template-columns: 1fr !important; }
  }
  
  /* HERO DETAIL - Mejor layout */
  .heroDetail {
    gap: 16px;
  }
  
  .heroDetail__section {
    padding: 16px;
  }
  
  /* FLOATING ACTION BUTTONS - Más grandes */
  .fab {
    width: 56px !important;
    height: 56px !important;
    font-size: 24px !important;
  }
  
  /* TOAST NOTIFICATIONS - Más legibles */
  .toast {
    font-size: 16px !important;
    padding: 16px 24px !important;
    min-height: 52px;
    border-radius: 12px;
  }
  
  /* NAVIGATION - Mejor accesibilidad táctil */
  .bottomNav {
    height: 60px;
  }
  
  .bottomNav__btn {
    font-size: 15px;
    padding: 8px 12px;
  }
  
  /* HEADERS - Más legibles */
  .h2 {
    font-size: 28px !important;
  }
  
  .h3 {
    font-size: 22px !important;
  }
  
  .pageIntro {
    padding: 20px;
  }
  
  /* DROPDOWN MENUS - Mejor espaciado */
  .dropdown__menu {
    max-height: 60vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .dropdown__item {
    padding: 14px 16px !important;
    font-size: 16px !important;
  }
  
  /* FORMS - Mejor UX */
  .field {
    margin-bottom: 20px;
  }
  
  .label {
    font-size: 15px !important;
    margin-bottom: 8px;
    font-weight: 600;
  }
  
  /* REWARDS LIST - Más espacio entre items */
  .rewardsList {
    gap: 12px;
  }
  
  .rewardItem {
    padding: 14px;
  }
  
  /* STATS SELECTOR - Más fácil de tocar */
  #statsBox .statRow {
    margin-bottom: 16px;
  }
  
  .statLabel {
    font-size: 15px !important;
  }
  
  /* CHALLENGE CHIPS - Más grandes */
  .chProgressChips {
    gap: 8px;
  }
  
  .chChip {
    min-width: 44px;
    min-height: 32px;
    font-size: 14px;
  }
  
  /* PHOTO BOX - Área de toque clara */
  .photoBox {
    min-height: 200px;
  }
  
  /* SAFE AREA para iPhones con notch */
  @supports (padding: max(0px)) {
    body {
      padding-top: max(0px, env(safe-area-inset-top));
      padding-bottom: max(0px, env(safe-area-inset-bottom));
    }
    
    .bottomNav {
      padding-bottom: max(8px, env(safe-area-inset-bottom));
    }
  }
  
  /* LANDSCAPE MODE - Ajustes */
  @media (orientation: landscape) and (max-height: 500px) {
    .luStage {
      height: 150px !important;
    }
    
    .luBadge {
      width: 80px !important;
      height: 80px !important;
    }
    
    .luNum {
      font-size: 40px !important;
    }
    
    .luKicker {
      font-size: 16px !important;
    }
  }
}

/* EXTRA SMALL SCREENS (iPhone SE, etc) */
@media (max-width: 375px) {
  .pill {
    font-size: 15px;
    padding: 10px 16px;
  }
  
  .heroCard__name {
    font-size: 16px !important;
  }
  
  .challengeItem__title {
    font-size: 16px !important;
  }
  
  .h2 {
    font-size: 24px !important;
  }
  
  .h3 {
    font-size: 20px !important;
  }
}

/* PREVENIR ZOOM ACCIDENTAL en inputs */
@media (max-width: 768px) {
  input:focus,
  textarea:focus,
  select:focus {
    font-size: 16px !important;
  }
}

/* SCROLL SUAVE EN MÓVIL */
@media (max-width: 768px) {
  * {
    -webkit-overflow-scrolling: touch;
  }
  
  body {
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
  }
}

/* CONTRASTE MEJORADO EN MÓVIL */
@media (max-width: 768px) {
  .muted {
    opacity: 0.8; /* Más visible que 0.6 */
  }

  /* Bordes más visibles */
  .card,
  .modal__card {
    border-width: 2px;
  }
}


/* ============================================
   iPhone 12 Pro / phones ~390px
   Fix: hero scene, challenges, tienda, events
   ============================================ */

/* --- FICHAS: Hero scene demasiado alto, empuja todo el contenido fuera --- */
@media (max-width: 430px) {
  /* Reducir la escena del héroe para que el formulario sea visible sin scroll excesivo */
  .heroScene {
    min-height: 340px !important;
    max-height: 46svh !important;
    height: 46svh !important;
  }

  /* FG layer: ajustar para que se vea bien en el contenedor más pequeño */
  .heroSceneLayer--fg {
    background-size: contain !important;
    background-position: 50% 100% !important;
    inset: -4% !important;
  }

  /* Nombre overlay: posición y tamaño para contenedor más corto */
  .heroName--overlay {
    font-size: 18px !important;
    letter-spacing: 3px !important;
    top: 10px !important;
    left: 12px !important;
  }

  /* cardGrid en modo columna: asegurar que todo sea scrollable */
  .cardGrid {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }

  /* Contenido principal: asegurar que las pages usen el espacio disponible */
  .content {
    padding: 10px !important;
  }

  /* Cards del formulario (Nombre, Edad, Rol, Stats): más compactas */
  .page[data-page="fichas"] .card:not(.card--avatar) {
    padding: 14px !important;
  }

  /* Fields layout: 2 columnas para Nombre+Edad, Rol ocupa toda la línea */
  .fields3 {
    grid-template-columns: 1fr 80px !important;
    gap: 10px !important;
    margin-bottom: 8px !important;
  }

  /* Medallas: que no tome mucho espacio vertical */
  .field--medals {
    margin-bottom: 4px !important;
  }

  .medalBadgeSmall {
    padding: 6px 12px !important;
  }

  /* Stats: más compactos en teléfono */
  .stats {
    margin-bottom: 8px !important;
  }

  .stat {
    padding: 6px 0 !important;
  }

  /* XP section: más compacta */
  .xpHeader {
    margin-top: 12px !important;
  }

  .xpCard {
    padding: 10px !important;
  }

  .xpFooter {
    gap: 8px !important;
  }

  /* Notas overlay: más pequeñas */
  .heroNotesOverlay {
    max-height: 26% !important;
  }

  .heroNotesOverlay .noteGrid--overlay {
    gap: 6px !important;
  }

  .heroNotesOverlay .textarea--short {
    min-height: 40px !important;
    max-height: 70px !important;
    font-size: 13px !important;
  }
}


/* --- DESAFÍOS: textos cortados por iconos, pills encimadas --- */
@media (max-width: 430px) {
  /* Challenge items: asegurar que los iconos de editar/borrar no corten el texto */
  .challengeItem {
    position: relative !important;
    padding: 14px 12px !important;
    padding-right: 14px !important;
  }

  /* Cuando está en modo edición, los botones de acción van inline, no absolutos */
  html.is-edit .chItemActions {
    position: static !important;
    transform: none !important;
    margin-top: 8px !important;
    justify-content: flex-start !important;
  }

  /* Challenge name: asegurar que no se desborde */
  .challengeName {
    font-size: 15px !important;
    line-height: 1.35 !important;
    word-break: break-word !important;
  }

  /* Challenge pills (dificultad + XP): más compactas */
  .challengeMetaRow {
    gap: 6px !important;
  }

  .chPill {
    padding: 5px 8px !important;
    font-size: 11px !important;
  }

  /* Desafíos cards: stack vertical sin problema */
  .cards2--ch {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }

  /* Challenge detail: header más compacto */
  .challengeDetailHead {
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 8px !important;
  }

  /* Challenge body: menos altura mínima */
  .challengeBody {
    min-height: 120px !important;
    font-size: 14px !important;
    padding: 12px !important;
  }

  /* Desafíos progress bar section */
  .cardHead--ch {
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 8px !important;
  }

  .chProgressChips {
    width: 100% !important;
    justify-items: start !important;
  }

  /* Filtros top: scroll horizontal si no caben */
  .challengeTop {
    gap: 8px !important;
    flex-wrap: wrap !important;
  }

  .diffPills {
    gap: 6px !important;
    width: 100% !important;
  }

  .diffPills .pill {
    padding: 8px 10px !important;
    font-size: 13px !important;
    min-height: 38px !important;
  }
}


/* --- TIENDA: botones admin cortados, tarjetas overflow --- */
@media (max-width: 430px) {
  /* Grid: una columna en móvil */
  .tiendaGrid {
    grid-template-columns: 1fr !important;
    gap: 14px !important;
  }

  /* Tienda items: hacer el layout vertical para que nada se corte */
  .tiendaItem {
    flex-direction: column !important;
    padding: 16px !important;
    overflow: visible !important;
  }

  /* Icon del item: más pequeño y centrado arriba */
  .tiendaItem__icon {
    width: 50px !important;
    height: 50px !important;
    font-size: 32px !important;
    align-self: flex-start !important;
  }

  /* Body: asegurar que el texto no se desborde */
  .tiendaItem__body {
    width: 100% !important;
  }

  .tiendaItem__name {
    font-size: 15px !important;
    word-break: break-word !important;
  }

  .tiendaItem__desc {
    font-size: 13px !important;
  }

  /* Footer: stack vertical si es necesario */
  .tiendaItem__footer {
    flex-wrap: wrap !important;
    gap: 8px !important;
  }

  /* Claim button: siempre visible, full width */
  .tiendaItem__claimBtn {
    position: static !important;
    width: 100% !important;
    margin-top: 10px !important;
  }

  /* Admin buttons: siempre visibles en mobile (no hover), posición estática */
  .tiendaItem__adminBtns {
    position: static !important;
    opacity: 1 !important;
    margin-top: 10px !important;
    justify-content: flex-start !important;
    gap: 10px !important;
  }

  /* Tienda header: más compacto */
  .tiendaHeader {
    padding: 14px !important;
    gap: 12px !important;
  }

  .medalBadgeLarge {
    padding: 8px 16px !important;
    gap: 8px !important;
  }

  .medalCount {
    font-size: 22px !important;
  }

  /* Page intro: menos espacio */
  .pageIntro {
    padding: 14px !important;
  }

  .pageIntro .h2 {
    font-size: 22px !important;
  }
}


/* --- EVENTOS: cards y modal en teléfono --- */
@media (max-width: 430px) {
  /* Event cards grid: 2 columnas apretadas o 1 en muy pequeño */
  .gridCards--events {
    grid-template-columns: repeat(2, minmax(140px, 1fr)) !important;
    gap: 10px !important;
  }

  /* Event card: más compacto */
  .evCard {
    padding: 8px !important;
    gap: 8px !important;
    border-radius: 16px !important;
  }

  .evCard__media {
    border-radius: 12px !important;
  }

  /* Título sobre la imagen: legible pero compacto */
  .evCard__title {
    font-size: clamp(12px, 3.2vw, 16px) !important;
  }

  .evCard__titleOnArt {
    left: 8px !important;
    right: 8px !important;
    bottom: 8px !important;
  }

  .evCard__chev {
    width: 24px !important;
    height: 24px !important;
  }

  /* Pills sobre la imagen */
  .evPill {
    height: 22px !important;
    padding: 0 8px !important;
    font-size: 10px !important;
  }

  /* Requirement line: más compacta */
  .evCard__req {
    gap: 6px !important;
  }

  .evReqText {
    font-size: 11px !important;
  }

  .evReqIcon {
    width: 22px !important;
    height: 22px !important;
  }

  /* Page intro for events: tighter */
  .pageIntro--events {
    padding: 10px 14px !important;
  }

  /* Event tabs */
  .eventTabs .pill {
    padding: 8px 14px !important;
    font-size: 13px !important;
  }
}

/* --- EVENTOS MODAL: fullscreen en teléfono --- */
@media (max-width: 430px) {
  .modal__card--event {
    width: 100vw !important;
    height: 100dvh !important;
    max-width: 100vw !important;
    max-height: 100dvh !important;
    border-radius: 0 !important;
  }

  .eventModalImgWrap {
    border-radius: 0 !important;
  }

  .eventModalGrid {
    min-height: 100dvh !important;
  }

  /* Close button: posición segura para safe areas */
  #btnEventClose.iconBtn {
    top: max(12px, env(safe-area-inset-top, 12px)) !important;
    right: 12px !important;
    width: 44px !important;
    height: 44px !important;
  }

  /* Info panel: compacto en bottom */
  .eventModalInfo {
    left: 10px !important;
    right: 10px !important;
    bottom: max(10px, env(safe-area-inset-bottom, 10px)) !important;
  }

  .eventModalReqGrid {
    grid-template-columns: 1fr !important;
    gap: 8px !important;
  }

  .eventModalReqBox {
    padding: 10px !important;
    border-radius: 12px !important;
  }

  .eventModalReqTitle {
    font-size: 11px !important;
  }

  .eventModalReqText {
    font-size: 12px !important;
  }

  /* Actions: full width */
  .eventModalActions {
    gap: 8px !important;
    padding-top: 8px !important;
  }

  .eventModalActions .btn {
    flex: 1 !important;
    text-align: center !important;
    justify-content: center !important;
    font-size: 13px !important;
    padding: 10px 12px !important;
  }
}


/* --- BOTTOM NAV: compacta para teléfono --- */
@media (max-width: 430px) {
  .bottomNav {
    gap: 6px !important;
    padding: 8px 8px calc(8px + env(safe-area-inset-bottom)) !important;
  }

  .bottomNav__btn {
    font-size: 13px !important;
    padding: 10px 6px !important;
    border-radius: 14px !important;
    min-width: 0 !important;
  }

  /* Páginas: dar espacio al bottom nav */
  .pages {
    padding-bottom: 80px !important;
  }
}


/* --- GENERAL: overflow prevention para teléfono --- */
@media (max-width: 430px) {
  /* Prevenir overflow horizontal en cualquier contenedor */
  .page {
    overflow-x: hidden !important;
  }

  /* App: padding lateral mínimo */
  .app {
    padding-left: calc(6px + var(--safe-left)) !important;
    padding-right: calc(6px + var(--safe-right)) !important;
  }

  /* Modals genéricos: full width y sheet style */
  .modal__card {
    width: calc(100vw - 16px) !important;
    max-height: 88vh !important;
    border-radius: 16px 16px 10px 10px !important;
    padding: 12px !important;
  }

  /* Modal header sticky */
  .modal__header {
    position: sticky !important;
    top: 0 !important;
    z-index: 2 !important;
    padding-bottom: 8px !important;
    margin-bottom: 6px !important;
  }

  /* Topbar: más compacta */
  .topbar {
    min-height: 52px !important;
    padding: 4px 8px !important;
    border-radius: 18px !important;
  }

  /* Brand logo: más pequeño */
  .brand__logo {
    width: 36px !important;
    height: 36px !important;
  }

  .brand__logo svg {
    width: 24px !important;
    height: 24px !important;
  }

  /* Override: botones inline pequeños NO necesitan 44px min-height */
  .chIconBtn,
  .iconBtn--small,
  .iconBtn--tiny,
  .chPill,
  .pill--status {
    min-height: auto !important;
    min-width: auto !important;
    padding: 6px 10px !important;
  }

  .chIconBtn {
    width: 34px !important;
    height: 34px !important;
    padding: 0 !important;
  }
}
